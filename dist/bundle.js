!function(t){function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}var e={};r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},r.p="",r(r.s=21)}([function(t,r,e){(function(t){!function(e){"use strict";var i={};i.exports=r,function(r){var e="undefined"==typeof window?t:window,i=e.GLMAT_EPSILON;null==i&&(i=1e-6);var n=e.GLMAT_ARRAY_TYPE||Array,a=e.GLMAT_RANDOM;a||(a=Math.random);var s={};s.setMatrixArrayType=function(t){n=t},void 0!==r&&(r.glMatrix=s);var o=Math.PI/180;s.toRadian=function(t){return t*o};var u={};u.create=function(){var t=new n(2);return t[0]=0,t[1]=0,t},u.clone=function(t){var r=new n(2);return r[0]=t[0],r[1]=t[1],r},u.fromValues=function(t,r){var e=new n(2);return e[0]=t,e[1]=r,e},u.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t},u.set=function(t,r,e){return t[0]=r,t[1]=e,t},u.add=function(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t},u.subtract=function(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t},u.sub=u.subtract,u.multiply=function(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t},u.mul=u.multiply,u.divide=function(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t},u.div=u.divide,u.min=function(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t},u.max=function(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t},u.scale=function(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t},u.scaleAndAdd=function(t,r,e,i){return t[0]=r[0]+e[0]*i,t[1]=r[1]+e[1]*i,t},u.distance=function(t,r){var e=r[0]-t[0],i=r[1]-t[1];return Math.sqrt(e*e+i*i)},u.dist=u.distance,u.squaredDistance=function(t,r){var e=r[0]-t[0],i=r[1]-t[1];return e*e+i*i},u.sqrDist=u.squaredDistance,u.length=function(t){var r=t[0],e=t[1];return Math.sqrt(r*r+e*e)},u.len=u.length,u.squaredLength=function(t){var r=t[0],e=t[1];return r*r+e*e},u.sqrLen=u.squaredLength,u.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t},u.inverse=function(t,r){return t[0]=1/r[0],t[1]=1/r[1],t},u.normalize=function(t,r){var e=r[0],i=r[1],n=e*e+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=r[0]*n,t[1]=r[1]*n),t},u.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]},u.cross=function(t,r,e){var i=r[0]*e[1]-r[1]*e[0];return t[0]=t[1]=0,t[2]=i,t},u.lerp=function(t,r,e,i){var n=r[0],a=r[1];return t[0]=n+i*(e[0]-n),t[1]=a+i*(e[1]-a),t},u.random=function(t,r){r=r||1;var e=2*a()*Math.PI;return t[0]=Math.cos(e)*r,t[1]=Math.sin(e)*r,t},u.transformMat2=function(t,r,e){var i=r[0],n=r[1];return t[0]=e[0]*i+e[2]*n,t[1]=e[1]*i+e[3]*n,t},u.transformMat2d=function(t,r,e){var i=r[0],n=r[1];return t[0]=e[0]*i+e[2]*n+e[4],t[1]=e[1]*i+e[3]*n+e[5],t},u.transformMat3=function(t,r,e){var i=r[0],n=r[1];return t[0]=e[0]*i+e[3]*n+e[6],t[1]=e[1]*i+e[4]*n+e[7],t},u.transformMat4=function(t,r,e){var i=r[0],n=r[1];return t[0]=e[0]*i+e[4]*n+e[12],t[1]=e[1]*i+e[5]*n+e[13],t},u.forEach=function(){var t=u.create();return function(r,e,i,n,a,s){var o,u;for(e||(e=2),i||(i=0),u=n?Math.min(n*e+i,r.length):r.length,o=i;o<u;o+=e)t[0]=r[o],t[1]=r[o+1],a(t,t,s),r[o]=t[0],r[o+1]=t[1];return r}}(),u.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},void 0!==r&&(r.vec2=u);var h={};h.create=function(){var t=new n(3);return t[0]=0,t[1]=0,t[2]=0,t},h.clone=function(t){var r=new n(3);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},h.fromValues=function(t,r,e){var i=new n(3);return i[0]=t,i[1]=r,i[2]=e,i},h.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},h.set=function(t,r,e,i){return t[0]=r,t[1]=e,t[2]=i,t},h.add=function(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t},h.subtract=function(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t},h.sub=h.subtract,h.multiply=function(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t},h.mul=h.multiply,h.divide=function(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t[2]=r[2]/e[2],t},h.div=h.divide,h.min=function(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t[2]=Math.min(r[2],e[2]),t},h.max=function(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t[2]=Math.max(r[2],e[2]),t},h.scale=function(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t},h.scaleAndAdd=function(t,r,e,i){return t[0]=r[0]+e[0]*i,t[1]=r[1]+e[1]*i,t[2]=r[2]+e[2]*i,t},h.distance=function(t,r){var e=r[0]-t[0],i=r[1]-t[1],n=r[2]-t[2];return Math.sqrt(e*e+i*i+n*n)},h.dist=h.distance,h.squaredDistance=function(t,r){var e=r[0]-t[0],i=r[1]-t[1],n=r[2]-t[2];return e*e+i*i+n*n},h.sqrDist=h.squaredDistance,h.length=function(t){var r=t[0],e=t[1],i=t[2];return Math.sqrt(r*r+e*e+i*i)},h.len=h.length,h.squaredLength=function(t){var r=t[0],e=t[1],i=t[2];return r*r+e*e+i*i},h.sqrLen=h.squaredLength,h.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t},h.inverse=function(t,r){return t[0]=1/r[0],t[1]=1/r[1],t[2]=1/r[2],t},h.normalize=function(t,r){var e=r[0],i=r[1],n=r[2],a=e*e+i*i+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=r[0]*a,t[1]=r[1]*a,t[2]=r[2]*a),t},h.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]},h.cross=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=e[0],o=e[1],u=e[2];return t[0]=n*u-a*o,t[1]=a*s-i*u,t[2]=i*o-n*s,t},h.lerp=function(t,r,e,i){var n=r[0],a=r[1],s=r[2];return t[0]=n+i*(e[0]-n),t[1]=a+i*(e[1]-a),t[2]=s+i*(e[2]-s),t},h.random=function(t,r){r=r||1;var e=2*a()*Math.PI,i=2*a()-1,n=Math.sqrt(1-i*i)*r;return t[0]=Math.cos(e)*n,t[1]=Math.sin(e)*n,t[2]=i*r,t},h.transformMat4=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=e[3]*i+e[7]*n+e[11]*a+e[15];return s=s||1,t[0]=(e[0]*i+e[4]*n+e[8]*a+e[12])/s,t[1]=(e[1]*i+e[5]*n+e[9]*a+e[13])/s,t[2]=(e[2]*i+e[6]*n+e[10]*a+e[14])/s,t},h.transformMat3=function(t,r,e){var i=r[0],n=r[1],a=r[2];return t[0]=i*e[0]+n*e[3]+a*e[6],t[1]=i*e[1]+n*e[4]+a*e[7],t[2]=i*e[2]+n*e[5]+a*e[8],t},h.transformQuat=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=e[0],o=e[1],u=e[2],h=e[3],c=h*i+o*a-u*n,f=h*n+u*i-s*a,l=h*a+s*n-o*i,_=-s*i-o*n-u*a;return t[0]=c*h+_*-s+f*-u-l*-o,t[1]=f*h+_*-o+l*-s-c*-u,t[2]=l*h+_*-u+c*-o-f*-s,t},h.rotateX=function(t,r,e,i){var n=[],a=[];return n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t},h.rotateY=function(t,r,e,i){var n=[],a=[];return n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t},h.rotateZ=function(t,r,e,i){var n=[],a=[];return n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t},h.forEach=function(){var t=h.create();return function(r,e,i,n,a,s){var o,u;for(e||(e=3),i||(i=0),u=n?Math.min(n*e+i,r.length):r.length,o=i;o<u;o+=e)t[0]=r[o],t[1]=r[o+1],t[2]=r[o+2],a(t,t,s),r[o]=t[0],r[o+1]=t[1],r[o+2]=t[2];return r}}(),h.angle=function(t,r){var e=h.fromValues(t[0],t[1],t[2]),i=h.fromValues(r[0],r[1],r[2]);h.normalize(e,e),h.normalize(i,i);var n=h.dot(e,i);return n>1?0:Math.acos(n)},h.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},void 0!==r&&(r.vec3=h);var c={};c.create=function(){var t=new n(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},c.clone=function(t){var r=new n(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},c.fromValues=function(t,r,e,i){var a=new n(4);return a[0]=t,a[1]=r,a[2]=e,a[3]=i,a},c.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},c.set=function(t,r,e,i,n){return t[0]=r,t[1]=e,t[2]=i,t[3]=n,t},c.add=function(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t[3]=r[3]+e[3],t},c.subtract=function(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t[3]=r[3]-e[3],t},c.sub=c.subtract,c.multiply=function(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t[3]=r[3]*e[3],t},c.mul=c.multiply,c.divide=function(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t[2]=r[2]/e[2],t[3]=r[3]/e[3],t},c.div=c.divide,c.min=function(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t[2]=Math.min(r[2],e[2]),t[3]=Math.min(r[3],e[3]),t},c.max=function(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t[2]=Math.max(r[2],e[2]),t[3]=Math.max(r[3],e[3]),t},c.scale=function(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t},c.scaleAndAdd=function(t,r,e,i){return t[0]=r[0]+e[0]*i,t[1]=r[1]+e[1]*i,t[2]=r[2]+e[2]*i,t[3]=r[3]+e[3]*i,t},c.distance=function(t,r){var e=r[0]-t[0],i=r[1]-t[1],n=r[2]-t[2],a=r[3]-t[3];return Math.sqrt(e*e+i*i+n*n+a*a)},c.dist=c.distance,c.squaredDistance=function(t,r){var e=r[0]-t[0],i=r[1]-t[1],n=r[2]-t[2],a=r[3]-t[3];return e*e+i*i+n*n+a*a},c.sqrDist=c.squaredDistance,c.length=function(t){var r=t[0],e=t[1],i=t[2],n=t[3];return Math.sqrt(r*r+e*e+i*i+n*n)},c.len=c.length,c.squaredLength=function(t){var r=t[0],e=t[1],i=t[2],n=t[3];return r*r+e*e+i*i+n*n},c.sqrLen=c.squaredLength,c.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=-r[3],t},c.inverse=function(t,r){return t[0]=1/r[0],t[1]=1/r[1],t[2]=1/r[2],t[3]=1/r[3],t},c.normalize=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=e*e+i*i+n*n+a*a;return s>0&&(s=1/Math.sqrt(s),t[0]=r[0]*s,t[1]=r[1]*s,t[2]=r[2]*s,t[3]=r[3]*s),t},c.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]},c.lerp=function(t,r,e,i){var n=r[0],a=r[1],s=r[2],o=r[3];return t[0]=n+i*(e[0]-n),t[1]=a+i*(e[1]-a),t[2]=s+i*(e[2]-s),t[3]=o+i*(e[3]-o),t},c.random=function(t,r){return r=r||1,t[0]=a(),t[1]=a(),t[2]=a(),t[3]=a(),c.normalize(t,t),c.scale(t,t,r),t},c.transformMat4=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3];return t[0]=e[0]*i+e[4]*n+e[8]*a+e[12]*s,t[1]=e[1]*i+e[5]*n+e[9]*a+e[13]*s,t[2]=e[2]*i+e[6]*n+e[10]*a+e[14]*s,t[3]=e[3]*i+e[7]*n+e[11]*a+e[15]*s,t},c.transformQuat=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=e[0],o=e[1],u=e[2],h=e[3],c=h*i+o*a-u*n,f=h*n+u*i-s*a,l=h*a+s*n-o*i,_=-s*i-o*n-u*a;return t[0]=c*h+_*-s+f*-u-l*-o,t[1]=f*h+_*-o+l*-s-c*-u,t[2]=l*h+_*-u+c*-o-f*-s,t},c.forEach=function(){var t=c.create();return function(r,e,i,n,a,s){var o,u;for(e||(e=4),i||(i=0),u=n?Math.min(n*e+i,r.length):r.length,o=i;o<u;o+=e)t[0]=r[o],t[1]=r[o+1],t[2]=r[o+2],t[3]=r[o+3],a(t,t,s),r[o]=t[0],r[o+1]=t[1],r[o+2]=t[2],r[o+3]=t[3];return r}}(),c.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},void 0!==r&&(r.vec4=c);var f={};f.create=function(){var t=new n(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},f.clone=function(t){var r=new n(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},f.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},f.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},f.transpose=function(t,r){if(t===r){var e=r[1];t[1]=r[2],t[2]=e}else t[0]=r[0],t[1]=r[2],t[2]=r[1],t[3]=r[3];return t},f.invert=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=e*a-n*i;return s?(s=1/s,t[0]=a*s,t[1]=-i*s,t[2]=-n*s,t[3]=e*s,t):null},f.adjoint=function(t,r){var e=r[0];return t[0]=r[3],t[1]=-r[1],t[2]=-r[2],t[3]=e,t},f.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},f.multiply=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=e[0],u=e[1],h=e[2],c=e[3];return t[0]=i*o+a*u,t[1]=n*o+s*u,t[2]=i*h+a*c,t[3]=n*h+s*c,t},f.mul=f.multiply,f.rotate=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=Math.sin(e),u=Math.cos(e);return t[0]=i*u+a*o,t[1]=n*u+s*o,t[2]=i*-o+a*u,t[3]=n*-o+s*u,t},f.scale=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=e[0],u=e[1];return t[0]=i*o,t[1]=n*o,t[2]=a*u,t[3]=s*u,t},f.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},f.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},f.LDU=function(t,r,e,i){return t[2]=i[2]/i[0],e[0]=i[0],e[1]=i[1],e[3]=i[3]-t[2]*e[1],[t,r,e]},void 0!==r&&(r.mat2=f);var l={};l.create=function(){var t=new n(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},l.clone=function(t){var r=new n(6);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r},l.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t},l.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},l.invert=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=r[4],o=r[5],u=e*a-i*n;return u?(u=1/u,t[0]=a*u,t[1]=-i*u,t[2]=-n*u,t[3]=e*u,t[4]=(n*o-a*s)*u,t[5]=(i*s-e*o)*u,t):null},l.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},l.multiply=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],u=r[5],h=e[0],c=e[1],f=e[2],l=e[3],_=e[4],d=e[5];return t[0]=i*h+a*c,t[1]=n*h+s*c,t[2]=i*f+a*l,t[3]=n*f+s*l,t[4]=i*_+a*d+o,t[5]=n*_+s*d+u,t},l.mul=l.multiply,l.rotate=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],u=r[5],h=Math.sin(e),c=Math.cos(e);return t[0]=i*c+a*h,t[1]=n*c+s*h,t[2]=i*-h+a*c,t[3]=n*-h+s*c,t[4]=o,t[5]=u,t},l.scale=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],u=r[5],h=e[0],c=e[1];return t[0]=i*h,t[1]=n*h,t[2]=a*c,t[3]=s*c,t[4]=o,t[5]=u,t},l.translate=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],u=r[5],h=e[0],c=e[1];return t[0]=i,t[1]=n,t[2]=a,t[3]=s,t[4]=i*h+a*c+o,t[5]=n*h+s*c+u,t},l.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},l.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},void 0!==r&&(r.mat2d=l);var _={};_.create=function(){var t=new n(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},_.fromMat4=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[4],t[4]=r[5],t[5]=r[6],t[6]=r[8],t[7]=r[9],t[8]=r[10],t},_.clone=function(t){var r=new n(9);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},_.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t},_.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},_.transpose=function(t,r){if(t===r){var e=r[1],i=r[2],n=r[5];t[1]=r[3],t[2]=r[6],t[3]=e,t[5]=r[7],t[6]=i,t[7]=n}else t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8];return t},_.invert=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=r[4],o=r[5],u=r[6],h=r[7],c=r[8],f=c*s-o*h,l=-c*a+o*u,_=h*a-s*u,d=e*f+i*l+n*_;return d?(d=1/d,t[0]=f*d,t[1]=(-c*i+n*h)*d,t[2]=(o*i-n*s)*d,t[3]=l*d,t[4]=(c*e-n*u)*d,t[5]=(-o*e+n*a)*d,t[6]=_*d,t[7]=(-h*e+i*u)*d,t[8]=(s*e-i*a)*d,t):null},_.adjoint=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=r[4],o=r[5],u=r[6],h=r[7],c=r[8];return t[0]=s*c-o*h,t[1]=n*h-i*c,t[2]=i*o-n*s,t[3]=o*u-a*c,t[4]=e*c-n*u,t[5]=n*a-e*o,t[6]=a*h-s*u,t[7]=i*u-e*h,t[8]=e*s-i*a,t},_.determinant=function(t){var r=t[0],e=t[1],i=t[2],n=t[3],a=t[4],s=t[5],o=t[6],u=t[7],h=t[8];return r*(h*a-s*u)+e*(-h*n+s*o)+i*(u*n-a*o)},_.multiply=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],u=r[5],h=r[6],c=r[7],f=r[8],l=e[0],_=e[1],d=e[2],m=e[3],p=e[4],y=e[5],v=e[6],E=e[7],T=e[8];return t[0]=l*i+_*s+d*h,t[1]=l*n+_*o+d*c,t[2]=l*a+_*u+d*f,t[3]=m*i+p*s+y*h,t[4]=m*n+p*o+y*c,t[5]=m*a+p*u+y*f,t[6]=v*i+E*s+T*h,t[7]=v*n+E*o+T*c,t[8]=v*a+E*u+T*f,t},_.mul=_.multiply,_.translate=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],u=r[5],h=r[6],c=r[7],f=r[8],l=e[0],_=e[1];return t[0]=i,t[1]=n,t[2]=a,t[3]=s,t[4]=o,t[5]=u,t[6]=l*i+_*s+h,t[7]=l*n+_*o+c,t[8]=l*a+_*u+f,t},_.rotate=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],u=r[5],h=r[6],c=r[7],f=r[8],l=Math.sin(e),_=Math.cos(e);return t[0]=_*i+l*s,t[1]=_*n+l*o,t[2]=_*a+l*u,t[3]=_*s-l*i,t[4]=_*o-l*n,t[5]=_*u-l*a,t[6]=h,t[7]=c,t[8]=f,t},_.scale=function(t,r,e){var i=e[0],n=e[1];return t[0]=i*r[0],t[1]=i*r[1],t[2]=i*r[2],t[3]=n*r[3],t[4]=n*r[4],t[5]=n*r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t},_.fromMat2d=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=0,t[3]=r[2],t[4]=r[3],t[5]=0,t[6]=r[4],t[7]=r[5],t[8]=1,t},_.fromQuat=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=e+e,o=i+i,u=n+n,h=e*s,c=i*s,f=i*o,l=n*s,_=n*o,d=n*u,m=a*s,p=a*o,y=a*u;return t[0]=1-f-d,t[3]=c-y,t[6]=l+p,t[1]=c+y,t[4]=1-h-d,t[7]=_-m,t[2]=l-p,t[5]=_+m,t[8]=1-h-f,t},_.normalFromMat4=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=r[4],o=r[5],u=r[6],h=r[7],c=r[8],f=r[9],l=r[10],_=r[11],d=r[12],m=r[13],p=r[14],y=r[15],v=e*o-i*s,E=e*u-n*s,T=e*h-a*s,g=i*u-n*o,x=i*h-a*o,A=n*h-a*u,R=c*m-f*d,b=c*p-l*d,M=c*y-_*d,I=f*p-l*m,S=f*y-_*m,N=l*y-_*p,O=v*N-E*S+T*I+g*M-x*b+A*R;return O?(O=1/O,t[0]=(o*N-u*S+h*I)*O,t[1]=(u*M-s*N-h*b)*O,t[2]=(s*S-o*M+h*R)*O,t[3]=(n*S-i*N-a*I)*O,t[4]=(e*N-n*M+a*b)*O,t[5]=(i*M-e*S-a*R)*O,t[6]=(m*A-p*x+y*g)*O,t[7]=(p*T-d*A-y*E)*O,t[8]=(d*x-m*T+y*v)*O,t):null},_.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},_.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},void 0!==r&&(r.mat3=_);var d={};d.create=function(){var t=new n(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},d.clone=function(t){var r=new n(16);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},d.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},d.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},d.transpose=function(t,r){if(t===r){var e=r[1],i=r[2],n=r[3],a=r[6],s=r[7],o=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=e,t[6]=r[9],t[7]=r[13],t[8]=i,t[9]=a,t[11]=r[14],t[12]=n,t[13]=s,t[14]=o}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t},d.invert=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=r[4],o=r[5],u=r[6],h=r[7],c=r[8],f=r[9],l=r[10],_=r[11],d=r[12],m=r[13],p=r[14],y=r[15],v=e*o-i*s,E=e*u-n*s,T=e*h-a*s,g=i*u-n*o,x=i*h-a*o,A=n*h-a*u,R=c*m-f*d,b=c*p-l*d,M=c*y-_*d,I=f*p-l*m,S=f*y-_*m,N=l*y-_*p,O=v*N-E*S+T*I+g*M-x*b+A*R;return O?(O=1/O,t[0]=(o*N-u*S+h*I)*O,t[1]=(n*S-i*N-a*I)*O,t[2]=(m*A-p*x+y*g)*O,t[3]=(l*x-f*A-_*g)*O,t[4]=(u*M-s*N-h*b)*O,t[5]=(e*N-n*M+a*b)*O,t[6]=(p*T-d*A-y*E)*O,t[7]=(c*A-l*T+_*E)*O,t[8]=(s*S-o*M+h*R)*O,t[9]=(i*M-e*S-a*R)*O,t[10]=(d*x-m*T+y*v)*O,t[11]=(f*T-c*x-_*v)*O,t[12]=(o*b-s*I-u*R)*O,t[13]=(e*I-i*b+n*R)*O,t[14]=(m*E-d*g-p*v)*O,t[15]=(c*g-f*E+l*v)*O,t):null},d.adjoint=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=r[4],o=r[5],u=r[6],h=r[7],c=r[8],f=r[9],l=r[10],_=r[11],d=r[12],m=r[13],p=r[14],y=r[15];return t[0]=o*(l*y-_*p)-f*(u*y-h*p)+m*(u*_-h*l),t[1]=-(i*(l*y-_*p)-f*(n*y-a*p)+m*(n*_-a*l)),t[2]=i*(u*y-h*p)-o*(n*y-a*p)+m*(n*h-a*u),t[3]=-(i*(u*_-h*l)-o*(n*_-a*l)+f*(n*h-a*u)),t[4]=-(s*(l*y-_*p)-c*(u*y-h*p)+d*(u*_-h*l)),t[5]=e*(l*y-_*p)-c*(n*y-a*p)+d*(n*_-a*l),t[6]=-(e*(u*y-h*p)-s*(n*y-a*p)+d*(n*h-a*u)),t[7]=e*(u*_-h*l)-s*(n*_-a*l)+c*(n*h-a*u),t[8]=s*(f*y-_*m)-c*(o*y-h*m)+d*(o*_-h*f),t[9]=-(e*(f*y-_*m)-c*(i*y-a*m)+d*(i*_-a*f)),t[10]=e*(o*y-h*m)-s*(i*y-a*m)+d*(i*h-a*o),t[11]=-(e*(o*_-h*f)-s*(i*_-a*f)+c*(i*h-a*o)),t[12]=-(s*(f*p-l*m)-c*(o*p-u*m)+d*(o*l-u*f)),t[13]=e*(f*p-l*m)-c*(i*p-n*m)+d*(i*l-n*f),t[14]=-(e*(o*p-u*m)-s*(i*p-n*m)+d*(i*u-n*o)),t[15]=e*(o*l-u*f)-s*(i*l-n*f)+c*(i*u-n*o),t},d.determinant=function(t){var r=t[0],e=t[1],i=t[2],n=t[3],a=t[4],s=t[5],o=t[6],u=t[7],h=t[8],c=t[9],f=t[10],l=t[11],_=t[12],d=t[13],m=t[14],p=t[15];return(r*s-e*a)*(f*p-l*m)-(r*o-i*a)*(c*p-l*d)+(r*u-n*a)*(c*m-f*d)+(e*o-i*s)*(h*p-l*_)-(e*u-n*s)*(h*m-f*_)+(i*u-n*o)*(h*d-c*_)},d.multiply=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],u=r[5],h=r[6],c=r[7],f=r[8],l=r[9],_=r[10],d=r[11],m=r[12],p=r[13],y=r[14],v=r[15],E=e[0],T=e[1],g=e[2],x=e[3];return t[0]=E*i+T*o+g*f+x*m,t[1]=E*n+T*u+g*l+x*p,t[2]=E*a+T*h+g*_+x*y,t[3]=E*s+T*c+g*d+x*v,E=e[4],T=e[5],g=e[6],x=e[7],t[4]=E*i+T*o+g*f+x*m,t[5]=E*n+T*u+g*l+x*p,t[6]=E*a+T*h+g*_+x*y,t[7]=E*s+T*c+g*d+x*v,E=e[8],T=e[9],g=e[10],x=e[11],t[8]=E*i+T*o+g*f+x*m,t[9]=E*n+T*u+g*l+x*p,t[10]=E*a+T*h+g*_+x*y,t[11]=E*s+T*c+g*d+x*v,E=e[12],T=e[13],g=e[14],x=e[15],t[12]=E*i+T*o+g*f+x*m,t[13]=E*n+T*u+g*l+x*p,t[14]=E*a+T*h+g*_+x*y,t[15]=E*s+T*c+g*d+x*v,t},d.multiplyAffine=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[4],o=r[5],u=r[6],h=r[8],c=r[9],f=r[10],l=r[12],_=r[13],d=r[14],m=e[0],p=e[1],y=e[2];return t[0]=m*i+p*s+y*h,t[1]=m*n+p*o+y*c,t[2]=m*a+p*u+y*f,m=e[4],p=e[5],y=e[6],t[4]=m*i+p*s+y*h,t[5]=m*n+p*o+y*c,t[6]=m*a+p*u+y*f,m=e[8],p=e[9],y=e[10],t[8]=m*i+p*s+y*h,t[9]=m*n+p*o+y*c,t[10]=m*a+p*u+y*f,m=e[12],p=e[13],y=e[14],t[12]=m*i+p*s+y*h+l,t[13]=m*n+p*o+y*c+_,t[14]=m*a+p*u+y*f+d,t},d.mul=d.multiply,d.mulAffine=d.multiplyAffine,d.translate=function(t,r,e){var i,n,a,s,o,u,h,c,f,l,_,d,m=e[0],p=e[1],y=e[2];return r===t?(t[12]=r[0]*m+r[4]*p+r[8]*y+r[12],t[13]=r[1]*m+r[5]*p+r[9]*y+r[13],t[14]=r[2]*m+r[6]*p+r[10]*y+r[14],t[15]=r[3]*m+r[7]*p+r[11]*y+r[15]):(i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],u=r[5],h=r[6],c=r[7],f=r[8],l=r[9],_=r[10],d=r[11],t[0]=i,t[1]=n,t[2]=a,t[3]=s,t[4]=o,t[5]=u,t[6]=h,t[7]=c,t[8]=f,t[9]=l,t[10]=_,t[11]=d,t[12]=i*m+o*p+f*y+r[12],t[13]=n*m+u*p+l*y+r[13],t[14]=a*m+h*p+_*y+r[14],t[15]=s*m+c*p+d*y+r[15]),t},d.scale=function(t,r,e){var i=e[0],n=e[1],a=e[2];return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=r[3]*i,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=r[7]*n,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},d.rotate=function(t,r,e,n){var a,s,o,u,h,c,f,l,_,d,m,p,y,v,E,T,g,x,A,R,b,M,I,S,N=n[0],O=n[1],w=n[2],P=Math.sqrt(N*N+O*O+w*w);return Math.abs(P)<i?null:(P=1/P,N*=P,O*=P,w*=P,a=Math.sin(e),s=Math.cos(e),o=1-s,u=r[0],h=r[1],c=r[2],f=r[3],l=r[4],_=r[5],d=r[6],m=r[7],p=r[8],y=r[9],v=r[10],E=r[11],T=N*N*o+s,g=O*N*o+w*a,x=w*N*o-O*a,A=N*O*o-w*a,R=O*O*o+s,b=w*O*o+N*a,M=N*w*o+O*a,I=O*w*o-N*a,S=w*w*o+s,t[0]=u*T+l*g+p*x,t[1]=h*T+_*g+y*x,t[2]=c*T+d*g+v*x,t[3]=f*T+m*g+E*x,t[4]=u*A+l*R+p*b,t[5]=h*A+_*R+y*b,t[6]=c*A+d*R+v*b,t[7]=f*A+m*R+E*b,t[8]=u*M+l*I+p*S,t[9]=h*M+_*I+y*S,t[10]=c*M+d*I+v*S,t[11]=f*M+m*I+E*S,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)},d.rotateX=function(t,r,e){var i=Math.sin(e),n=Math.cos(e),a=r[4],s=r[5],o=r[6],u=r[7],h=r[8],c=r[9],f=r[10],l=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=a*n+h*i,t[5]=s*n+c*i,t[6]=o*n+f*i,t[7]=u*n+l*i,t[8]=h*n-a*i,t[9]=c*n-s*i,t[10]=f*n-o*i,t[11]=l*n-u*i,t},d.rotateY=function(t,r,e){var i=Math.sin(e),n=Math.cos(e),a=r[0],s=r[1],o=r[2],u=r[3],h=r[8],c=r[9],f=r[10],l=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*n-h*i,t[1]=s*n-c*i,t[2]=o*n-f*i,t[3]=u*n-l*i,t[8]=a*i+h*n,t[9]=s*i+c*n,t[10]=o*i+f*n,t[11]=u*i+l*n,t},d.rotateZ=function(t,r,e){var i=Math.sin(e),n=Math.cos(e),a=r[0],s=r[1],o=r[2],u=r[3],h=r[4],c=r[5],f=r[6],l=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*n+h*i,t[1]=s*n+c*i,t[2]=o*n+f*i,t[3]=u*n+l*i,t[4]=h*n-a*i,t[5]=c*n-s*i,t[6]=f*n-o*i,t[7]=l*n-u*i,t},d.fromRotationTranslation=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=i+i,u=n+n,h=a+a,c=i*o,f=i*u,l=i*h,_=n*u,d=n*h,m=a*h,p=s*o,y=s*u,v=s*h;return t[0]=1-(_+m),t[1]=f+v,t[2]=l-y,t[3]=0,t[4]=f-v,t[5]=1-(c+m),t[6]=d+p,t[7]=0,t[8]=l+y,t[9]=d-p,t[10]=1-(c+_),t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},d.fromQuat=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=e+e,o=i+i,u=n+n,h=e*s,c=i*s,f=i*o,l=n*s,_=n*o,d=n*u,m=a*s,p=a*o,y=a*u;return t[0]=1-f-d,t[1]=c+y,t[2]=l-p,t[3]=0,t[4]=c-y,t[5]=1-h-d,t[6]=_+m,t[7]=0,t[8]=l+p,t[9]=_-m,t[10]=1-h-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},d.frustum=function(t,r,e,i,n,a,s){var o=1/(e-r),u=1/(n-i),h=1/(a-s);return t[0]=2*a*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(e+r)*o,t[9]=(n+i)*u,t[10]=(s+a)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*a*2*h,t[15]=0,t},d.perspective=function(t,r,e,i,n){var a=1/Math.tan(r/2),s=1/(i-n);return t[0]=a/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+i)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*i*s,t[15]=0,t},d.ortho=function(t,r,e,i,n,a,s){var o=1/(r-e),u=1/(i-n),h=1/(a-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(r+e)*o,t[13]=(n+i)*u,t[14]=(s+a)*h,t[15]=1,t},d.lookAt=function(t,r,e,n){var a,s,o,u,h,c,f,l,_,m,p=r[0],y=r[1],v=r[2],E=n[0],T=n[1],g=n[2],x=e[0],A=e[1],R=e[2];return Math.abs(p-x)<i&&Math.abs(y-A)<i&&Math.abs(v-R)<i?d.identity(t):(f=p-x,l=y-A,_=v-R,m=1/Math.sqrt(f*f+l*l+_*_),f*=m,l*=m,_*=m,a=T*_-g*l,s=g*f-E*_,o=E*l-T*f,m=Math.sqrt(a*a+s*s+o*o),m?(m=1/m,a*=m,s*=m,o*=m):(a=0,s=0,o=0),u=l*o-_*s,h=_*a-f*o,c=f*s-l*a,m=Math.sqrt(u*u+h*h+c*c),m?(m=1/m,u*=m,h*=m,c*=m):(u=0,h=0,c=0),t[0]=a,t[1]=u,t[2]=f,t[3]=0,t[4]=s,t[5]=h,t[6]=l,t[7]=0,t[8]=o,t[9]=c,t[10]=_,t[11]=0,t[12]=-(a*p+s*y+o*v),t[13]=-(u*p+h*y+c*v),t[14]=-(f*p+l*y+_*v),t[15]=1,t)},d.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},d.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},void 0!==r&&(r.mat4=d);var m={};m.create=function(){var t=new n(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},m.rotationTo=function(){var t=h.create(),r=h.fromValues(1,0,0),e=h.fromValues(0,1,0);return function(i,n,a){var s=h.dot(n,a);return s<-.999999?(h.cross(t,r,n),h.length(t)<1e-6&&h.cross(t,e,n),h.normalize(t,t),m.setAxisAngle(i,t,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(h.cross(t,n,a),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+s,m.normalize(i,i))}}(),m.setAxes=function(){var t=_.create();return function(r,e,i,n){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-e[0],t[5]=-e[1],t[8]=-e[2],m.normalize(r,m.fromMat3(r,t))}}(),m.clone=c.clone,m.fromValues=c.fromValues,m.copy=c.copy,m.set=c.set,m.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},m.setAxisAngle=function(t,r,e){e*=.5;var i=Math.sin(e);return t[0]=i*r[0],t[1]=i*r[1],t[2]=i*r[2],t[3]=Math.cos(e),t},m.add=c.add,m.multiply=function(t,r,e){var i=r[0],n=r[1],a=r[2],s=r[3],o=e[0],u=e[1],h=e[2],c=e[3];return t[0]=i*c+s*o+n*h-a*u,t[1]=n*c+s*u+a*o-i*h,t[2]=a*c+s*h+i*u-n*o,t[3]=s*c-i*o-n*u-a*h,t},m.mul=m.multiply,m.scale=c.scale,m.rotateX=function(t,r,e){e*=.5;var i=r[0],n=r[1],a=r[2],s=r[3],o=Math.sin(e),u=Math.cos(e);return t[0]=i*u+s*o,t[1]=n*u+a*o,t[2]=a*u-n*o,t[3]=s*u-i*o,t},m.rotateY=function(t,r,e){e*=.5;var i=r[0],n=r[1],a=r[2],s=r[3],o=Math.sin(e),u=Math.cos(e);return t[0]=i*u-a*o,t[1]=n*u+s*o,t[2]=a*u+i*o,t[3]=s*u-n*o,t},m.rotateZ=function(t,r,e){e*=.5;var i=r[0],n=r[1],a=r[2],s=r[3],o=Math.sin(e),u=Math.cos(e);return t[0]=i*u+n*o,t[1]=n*u-i*o,t[2]=a*u+s*o,t[3]=s*u-a*o,t},m.calculateW=function(t,r){var e=r[0],i=r[1],n=r[2];return t[0]=e,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-e*e-i*i-n*n)),t},m.dot=c.dot,m.lerp=c.lerp,m.slerp=function(t,r,e,i){var n,a,s,o,u,h=r[0],c=r[1],f=r[2],l=r[3],_=e[0],d=e[1],m=e[2],p=e[3];return a=h*_+c*d+f*m+l*p,a<0&&(a=-a,_=-_,d=-d,m=-m,p=-p),1-a>1e-6?(n=Math.acos(a),s=Math.sin(n),o=Math.sin((1-i)*n)/s,u=Math.sin(i*n)/s):(o=1-i,u=i),t[0]=o*h+u*_,t[1]=o*c+u*d,t[2]=o*f+u*m,t[3]=o*l+u*p,t},m.invert=function(t,r){var e=r[0],i=r[1],n=r[2],a=r[3],s=e*e+i*i+n*n+a*a,o=s?1/s:0;return t[0]=-e*o,t[1]=-i*o,t[2]=-n*o,t[3]=a*o,t},m.conjugate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=r[3],t},m.length=c.length,m.len=m.length,m.squaredLength=c.squaredLength,m.sqrLen=m.squaredLength,m.normalize=c.normalize,m.fromMat3=function(t,r){var e,i=r[0]+r[4]+r[8];if(i>0)e=Math.sqrt(i+1),t[3]=.5*e,e=.5/e,t[0]=(r[5]-r[7])*e,t[1]=(r[6]-r[2])*e,t[2]=(r[1]-r[3])*e;else{var n=0;r[4]>r[0]&&(n=1),r[8]>r[3*n+n]&&(n=2);var a=(n+1)%3,s=(n+2)%3;e=Math.sqrt(r[3*n+n]-r[3*a+a]-r[3*s+s]+1),t[n]=.5*e,e=.5/e,t[3]=(r[3*a+s]-r[3*s+a])*e,t[a]=(r[3*a+n]+r[3*n+a])*e,t[s]=(r[3*s+n]+r[3*n+s])*e}return t},m.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},void 0!==r&&(r.quat=m)}(i.exports)}()}).call(r,e(14))},function(t,r,e){"use strict";var i=e(24),n=e(25),a=e(4),s=function(){this.__uid__=a.a.genGUID()};s.__initializers__=[function(t){a.a.extend(this,t)}],a.a.extend(s,i.a),a.a.extend(s.prototype,n.a),r.a=s},function(t,r,e){"use strict";r.a={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444}},function(t,r,e){"use strict";function i(t,r,e){return t<r?r:t>e?e:t}var n=e(0),a=e.n(n),s=a.a.vec3,o=function(t,r,e){t=t||0,r=r||0,e=e||0,this.array=s.fromValues(t,r,e),this._dirty=!0};o.prototype={constructor:o,add:function(t){return s.add(this.array,this.array,t.array),this._dirty=!0,this},set:function(t,r,e){return this.array[0]=t,this.array[1]=r,this.array[2]=e,this._dirty=!0,this},setArray:function(t){return this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2],this._dirty=!0,this},clone:function(){return new o(this.x,this.y,this.z)},copy:function(t){return s.copy(this.array,t.array),this._dirty=!0,this},cross:function(t,r){return s.cross(this.array,t.array,r.array),this._dirty=!0,this},dist:function(t){return s.dist(this.array,t.array)},distance:function(t){return s.distance(this.array,t.array)},div:function(t){return s.div(this.array,this.array,t.array),this._dirty=!0,this},divide:function(t){return s.divide(this.array,this.array,t.array),this._dirty=!0,this},dot:function(t){return s.dot(this.array,t.array)},len:function(){return s.len(this.array)},length:function(){return s.length(this.array)},lerp:function(t,r,e){return s.lerp(this.array,t.array,r.array,e),this._dirty=!0,this},min:function(t){return s.min(this.array,this.array,t.array),this._dirty=!0,this},max:function(t){return s.max(this.array,this.array,t.array),this._dirty=!0,this},mul:function(t){return s.mul(this.array,this.array,t.array),this._dirty=!0,this},multiply:function(t){return s.multiply(this.array,this.array,t.array),this._dirty=!0,this},negate:function(){return s.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return s.normalize(this.array,this.array),this._dirty=!0,this},random:function(t){return s.random(this.array,t),this._dirty=!0,this},scale:function(t){return s.scale(this.array,this.array,t),this._dirty=!0,this},scaleAndAdd:function(t,r){return s.scaleAndAdd(this.array,this.array,t.array,r),this._dirty=!0,this},sqrDist:function(t){return s.sqrDist(this.array,t.array)},squaredDistance:function(t){return s.squaredDistance(this.array,t.array)},sqrLen:function(){return s.sqrLen(this.array)},squaredLength:function(){return s.squaredLength(this.array)},sub:function(t){return s.sub(this.array,this.array,t.array),this._dirty=!0,this},subtract:function(t){return s.subtract(this.array,this.array,t.array),this._dirty=!0,this},transformMat3:function(t){return s.transformMat3(this.array,this.array,t.array),this._dirty=!0,this},transformMat4:function(t){return s.transformMat4(this.array,this.array,t.array),this._dirty=!0,this},transformQuat:function(t){return s.transformQuat(this.array,this.array,t.array),this._dirty=!0,this},applyProjection:function(t){var r=this.array;if(t=t.array,0===t[15]){var e=-1/r[2];r[0]=t[0]*r[0]*e,r[1]=t[5]*r[1]*e,r[2]=(t[10]*r[2]+t[14])*e}else r[0]=t[0]*r[0]+t[12],r[1]=t[5]*r[1]+t[13],r[2]=t[10]*r[2]+t[14];return this._dirty=!0,this},eulerFromQuat:function(t,r){o.eulerFromQuat(this,t,r)},eulerFromMat3:function(t,r){o.eulerFromMat3(this,t,r)},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var u=Object.defineProperty;if(u){var h=o.prototype;u(h,"x",{get:function(){return this.array[0]},set:function(t){this.array[0]=t,this._dirty=!0}}),u(h,"y",{get:function(){return this.array[1]},set:function(t){this.array[1]=t,this._dirty=!0}}),u(h,"z",{get:function(){return this.array[2]},set:function(t){this.array[2]=t,this._dirty=!0}})}o.add=function(t,r,e){return s.add(t.array,r.array,e.array),t._dirty=!0,t},o.set=function(t,r,e,i){s.set(t.array,r,e,i),t._dirty=!0},o.copy=function(t,r){return s.copy(t.array,r.array),t._dirty=!0,t},o.cross=function(t,r,e){return s.cross(t.array,r.array,e.array),t._dirty=!0,t},o.dist=function(t,r){return s.distance(t.array,r.array)},o.distance=o.dist,o.div=function(t,r,e){return s.divide(t.array,r.array,e.array),t._dirty=!0,t},o.divide=o.div,o.dot=function(t,r){return s.dot(t.array,r.array)},o.len=function(t){return s.length(t.array)},o.lerp=function(t,r,e,i){return s.lerp(t.array,r.array,e.array,i),t._dirty=!0,t},o.min=function(t,r,e){return s.min(t.array,r.array,e.array),t._dirty=!0,t},o.max=function(t,r,e){return s.max(t.array,r.array,e.array),t._dirty=!0,t},o.mul=function(t,r,e){return s.multiply(t.array,r.array,e.array),t._dirty=!0,t},o.multiply=o.mul,o.negate=function(t,r){return s.negate(t.array,r.array),t._dirty=!0,t},o.normalize=function(t,r){return s.normalize(t.array,r.array),t._dirty=!0,t},o.random=function(t,r){return s.random(t.array,r),t._dirty=!0,t},o.scale=function(t,r,e){return s.scale(t.array,r.array,e),t._dirty=!0,t},o.scaleAndAdd=function(t,r,e,i){return s.scaleAndAdd(t.array,r.array,e.array,i),t._dirty=!0,t},o.sqrDist=function(t,r){return s.sqrDist(t.array,r.array)},o.squaredDistance=o.sqrDist,o.sqrLen=function(t){return s.sqrLen(t.array)},o.squaredLength=o.sqrLen,o.sub=function(t,r,e){return s.subtract(t.array,r.array,e.array),t._dirty=!0,t},o.subtract=o.sub,o.transformMat3=function(t,r,e){return s.transformMat3(t.array,r.array,e.array),t._dirty=!0,t},o.transformMat4=function(t,r,e){return s.transformMat4(t.array,r.array,e.array),t._dirty=!0,t},o.transformQuat=function(t,r,e){return s.transformQuat(t.array,r.array,e.array),t._dirty=!0,t};var c=Math.atan2,f=Math.asin,l=Math.abs;o.eulerFromQuat=function(t,r,e){t._dirty=!0,r=r.array;var n=t.array,a=r[0],s=r[1],o=r[2],u=r[3],h=a*a,l=s*s,_=o*o,d=u*u,e=(e||"XYZ").toUpperCase();switch(e){case"XYZ":n[0]=c(2*(a*u-s*o),d-h-l+_),n[1]=f(i(2*(a*o+s*u),-1,1)),n[2]=c(2*(o*u-a*s),d+h-l-_);break;case"YXZ":n[0]=f(i(2*(a*u-s*o),-1,1)),n[1]=c(2*(a*o+s*u),d-h-l+_),n[2]=c(2*(a*s+o*u),d-h+l-_);break;case"ZXY":n[0]=f(i(2*(a*u+s*o),-1,1)),n[1]=c(2*(s*u-o*a),d-h-l+_),n[2]=c(2*(o*u-a*s),d-h+l-_);break;case"ZYX":n[0]=c(2*(a*u+o*s),d-h-l+_),n[1]=f(i(2*(s*u-a*o),-1,1)),n[2]=c(2*(a*s+o*u),d+h-l-_);break;case"YZX":n[0]=c(2*(a*u-o*s),d-h+l-_),n[1]=c(2*(s*u-a*o),d+h-l-_),n[2]=f(i(2*(a*s+o*u),-1,1));break;case"XZY":n[0]=c(2*(a*u+s*o),d-h+l-_),n[1]=c(2*(a*o+s*u),d+h-l-_),n[2]=f(i(2*(o*u-a*s),-1,1));break;default:console.warn("Unkown order: "+e)}return t},o.eulerFromMat3=function(t,r,e){var n=r.array,a=n[0],s=n[3],o=n[6],u=n[1],h=n[4],_=n[7],d=n[2],m=n[5],p=n[8],y=t.array,e=(e||"XYZ").toUpperCase();switch(e){case"XYZ":y[1]=f(i(o,-1,1)),l(o)<.99999?(y[0]=c(-_,p),y[2]=c(-s,a)):(y[0]=c(m,h),y[2]=0);break;case"YXZ":y[0]=f(-i(_,-1,1)),l(_)<.99999?(y[1]=c(o,p),y[2]=c(u,h)):(y[1]=c(-d,a),y[2]=0);break;case"ZXY":y[0]=f(i(m,-1,1)),l(m)<.99999?(y[1]=c(-d,p),y[2]=c(-s,h)):(y[1]=0,y[2]=c(u,a));break;case"ZYX":y[1]=f(-i(d,-1,1)),l(d)<.99999?(y[0]=c(m,p),y[2]=c(u,a)):(y[0]=0,y[2]=c(-s,h));break;case"YZX":y[2]=f(i(u,-1,1)),l(u)<.99999?(y[0]=c(-_,h),y[1]=c(-d,a)):(y[0]=0,y[1]=c(o,p));break;case"XZY":y[2]=f(-i(s,-1,1)),l(s)<.99999?(y[0]=c(m,h),y[1]=c(o,a)):(y[0]=c(-_,p),y[1]=0);break;default:console.warn("Unkown order: "+e)}return t._dirty=!0,t},Object.defineProperties(o,{POSITIVE_X:{get:function(){return new o(1,0,0)}},NEGATIVE_X:{get:function(){return new o(-1,0,0)}},POSITIVE_Y:{get:function(){return new o(0,1,0)}},NEGATIVE_Y:{get:function(){return new o(0,-1,0)}},POSITIVE_Z:{get:function(){return new o(0,0,1)}},NEGATIVE_Z:{get:function(){return new o(0,0,-1)}},UP:{get:function(){return new o(0,1,0)}},ZERO:{get:function(){return new o}}}),r.a=o},function(t,r,e){"use strict";var i=0,n=Array.prototype,a=n.forEach,s={genGUID:function(){return++i},relative2absolute:function(t,r){if(!r||t.match(/^\//))return t;for(var e=t.split("/"),i=r.split("/"),n=e[0];"."===n||".."===n;)".."===n&&i.pop(),e.shift(),n=e[0];return i.join("/")+"/"+e.join("/")},extend:function(t,r){if(r)for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);return t},defaults:function(t,r){if(r)for(var e in r)void 0===t[e]&&(t[e]=r[e]);return t},extendWithPropList:function(t,r,e){if(r)for(var i=0;i<e.length;i++){var n=e[i];t[n]=r[n]}return t},defaultsWithPropList:function(t,r,e){if(r)for(var i=0;i<e.length;i++){var n=e[i];null==t[n]&&(t[n]=r[n])}return t},each:function(t,r,e){if(t&&r)if(t.forEach&&t.forEach===a)t.forEach(r,e);else if(t.length===+t.length)for(var i=0,n=t.length;i<n;i++)r.call(e,t[i],i,t);else for(var s in t)t.hasOwnProperty(s)&&r.call(e,t[s],s,t)},isObject:function(t){return t===Object(t)},isArray:function(t){return Array.isArray(t)},isArrayLike:function(t){return!!t&&t.length===+t.length},clone:function(t){if(s.isObject(t)){if(s.isArray(t))return t.slice();if(s.isArrayLike(t)){for(var r=new t.constructor(t.length),e=0;e<t.length;e++)r[e]=t[e];return r}return s.extend({},t)}return t}};r.a=s},function(t,r,e){"use strict";var i=e(3),n=e(0),a=e.n(n),s=a.a.vec3,o=s.copy,u=s.set,h=function(t,r){this.min=t||new i.a(1/0,1/0,1/0),this.max=r||new i.a(-1/0,-1/0,-1/0),this.vertices=null};h.prototype={constructor:h,updateFromVertices:function(t){if(t.length>0){var r=this.min,e=this.max,i=r.array,n=e.array;o(i,t[0]),o(n,t[0]);for(var a=1;a<t.length;a++){var s=t[a];s[0]<i[0]&&(i[0]=s[0]),s[1]<i[1]&&(i[1]=s[1]),s[2]<i[2]&&(i[2]=s[2]),s[0]>n[0]&&(n[0]=s[0]),s[1]>n[1]&&(n[1]=s[1]),s[2]>n[2]&&(n[2]=s[2])}r._dirty=!0,e._dirty=!0}},union:function(t){var r=this.min,e=this.max;return s.min(r.array,r.array,t.min.array),s.max(e.array,e.array,t.max.array),r._dirty=!0,e._dirty=!0,this},intersection:function(t){var r=this.min,e=this.max;return s.max(r.array,r.array,t.min.array),s.min(e.array,e.array,t.max.array),r._dirty=!0,e._dirty=!0,this},intersectBoundingBox:function(t){var r=this.min.array,e=this.max.array,i=t.min.array,n=t.max.array;return!(r[0]>n[0]||r[1]>n[1]||r[2]>n[2]||e[0]<i[0]||e[1]<i[1]||e[2]<i[2])},containBoundingBox:function(t){var r=this.min.array,e=this.max.array,i=t.min.array,n=t.max.array;return r[0]<=i[0]&&r[1]<=i[1]&&r[2]<=i[2]&&e[0]>=n[0]&&e[1]>=n[1]&&e[2]>=n[2]},containPoint:function(t){var r=this.min.array,e=this.max.array,i=t.array;return r[0]<=i[0]&&r[1]<=i[1]&&r[2]<=i[2]&&e[0]>=i[0]&&e[1]>=i[1]&&e[2]>=i[2]},isFinite:function(){var t=this.min.array,r=this.max.array;return isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2])&&isFinite(r[0])&&isFinite(r[1])&&isFinite(r[2])},applyTransform:function(t){this.transformFrom(this,t)},transformFrom:function(){var t=s.create(),r=s.create(),e=s.create(),i=s.create(),n=s.create(),a=s.create();return function(s,o){var u=s.min.array,h=s.max.array,c=o.array;return t[0]=c[0]*u[0],t[1]=c[1]*u[0],t[2]=c[2]*u[0],r[0]=c[0]*h[0],r[1]=c[1]*h[0],r[2]=c[2]*h[0],e[0]=c[4]*u[1],e[1]=c[5]*u[1],e[2]=c[6]*u[1],i[0]=c[4]*h[1],i[1]=c[5]*h[1],i[2]=c[6]*h[1],n[0]=c[8]*u[2],n[1]=c[9]*u[2],n[2]=c[10]*u[2],a[0]=c[8]*h[2],a[1]=c[9]*h[2],a[2]=c[10]*h[2],u=this.min.array,h=this.max.array,u[0]=Math.min(t[0],r[0])+Math.min(e[0],i[0])+Math.min(n[0],a[0])+c[12],u[1]=Math.min(t[1],r[1])+Math.min(e[1],i[1])+Math.min(n[1],a[1])+c[13],u[2]=Math.min(t[2],r[2])+Math.min(e[2],i[2])+Math.min(n[2],a[2])+c[14],h[0]=Math.max(t[0],r[0])+Math.max(e[0],i[0])+Math.max(n[0],a[0])+c[12],h[1]=Math.max(t[1],r[1])+Math.max(e[1],i[1])+Math.max(n[1],a[1])+c[13],h[2]=Math.max(t[2],r[2])+Math.max(e[2],i[2])+Math.max(n[2],a[2])+c[14],this.min._dirty=!0,this.max._dirty=!0,this}}(),applyProjection:function(t){var r=this.min.array,e=this.max.array,i=t.array,n=r[0],a=r[1],s=r[2],o=e[0],u=e[1],h=r[2],c=e[0],f=e[1],l=e[2];if(1===i[15])r[0]=i[0]*n+i[12],r[1]=i[5]*a+i[13],e[2]=i[10]*s+i[14],e[0]=i[0]*c+i[12],e[1]=i[5]*f+i[13],r[2]=i[10]*l+i[14];else{var _=-1/s;r[0]=i[0]*n*_,r[1]=i[5]*a*_,e[2]=(i[10]*s+i[14])*_,_=-1/h,e[0]=i[0]*o*_,e[1]=i[5]*u*_,_=-1/l,r[2]=(i[10]*l+i[14])*_}return this.min._dirty=!0,this.max._dirty=!0,this},updateVertices:function(){var t=this.vertices;if(!t){t=[];for(var r=0;r<8;r++)t[r]=s.fromValues(0,0,0);this.vertices=t}var e=this.min.array,i=this.max.array;return u(t[0],e[0],e[1],e[2]),u(t[1],e[0],i[1],e[2]),u(t[2],i[0],e[1],e[2]),u(t[3],i[0],i[1],e[2]),u(t[4],e[0],e[1],i[2]),u(t[5],e[0],i[1],i[2]),u(t[6],i[0],e[1],i[2]),u(t[7],i[0],i[1],i[2]),this},copy:function(t){var r=this.min,e=this.max;return o(r.array,t.min.array),o(e.array,t.max.array),r._dirty=!0,e._dirty=!0,this},clone:function(){var t=new h;return t.copy(this),t}},r.a=h},function(t,r,e){"use strict";var i=e(1),n=e(2),a=e(7),s=i.a.extend({width:512,height:512,type:n.a.UNSIGNED_BYTE,format:n.a.RGBA,wrapS:n.a.REPEAT,wrapT:n.a.REPEAT,minFilter:n.a.LINEAR_MIPMAP_LINEAR,magFilter:n.a.LINEAR,useMipmap:!0,anisotropic:1,flipY:!0,sRGB:!0,unpackAlignment:4,premultiplyAlpha:!1,dynamic:!1,NPOT:!1,__used:0},function(){this._cache=new a.a},{getWebGLTexture:function(t){var r=t.gl,e=this._cache;return e.use(t.__uid__),e.miss("webgl_texture")&&e.put("webgl_texture",r.createTexture()),this.dynamic?this.update(t):e.isDirty()&&(this.update(t),e.fresh()),e.get("webgl_texture")},bind:function(){},unbind:function(){},dirty:function(){this._cache&&this._cache.dirtyAll()},update:function(t){},updateCommon:function(t){var r=t.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,this.unpackAlignment),this.format===n.a.DEPTH_COMPONENT&&(this.useMipmap=!1);var e=t.getGLExtension("EXT_sRGB");this.format!==s.SRGB||e||(this.format=s.RGB),this.format!==s.SRGB_ALPHA||e||(this.format=s.RGBA),this.NPOT=!this.isPowerOfTwo()},getAvailableWrapS:function(){return this.NPOT?n.a.CLAMP_TO_EDGE:this.wrapS},getAvailableWrapT:function(){return this.NPOT?n.a.CLAMP_TO_EDGE:this.wrapT},getAvailableMinFilter:function(){var t=this.minFilter;return this.NPOT||!this.useMipmap?t===n.a.NEAREST_MIPMAP_NEAREST||t===n.a.NEAREST_MIPMAP_LINEAR?n.a.NEAREST:t===n.a.LINEAR_MIPMAP_LINEAR||t===n.a.LINEAR_MIPMAP_NEAREST?n.a.LINEAR:t:t},getAvailableMagFilter:function(){return this.magFilter},nextHighestPowerOfTwo:function(t){--t;for(var r=1;r<32;r<<=1)t|=t>>r;return t+1},dispose:function(t){var r=this._cache;r.use(t.__uid__);var e=r.get("webgl_texture");e&&t.gl.deleteTexture(e),r.deleteContext(t.__uid__)},isRenderable:function(){},isPowerOfTwo:function(){}});Object.defineProperty(s.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(s.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),s.BYTE=n.a.BYTE,s.UNSIGNED_BYTE=n.a.UNSIGNED_BYTE,s.SHORT=n.a.SHORT,s.UNSIGNED_SHORT=n.a.UNSIGNED_SHORT,s.INT=n.a.INT,s.UNSIGNED_INT=n.a.UNSIGNED_INT,s.FLOAT=n.a.FLOAT,s.HALF_FLOAT=36193,s.UNSIGNED_INT_24_8_WEBGL=34042,s.DEPTH_COMPONENT=n.a.DEPTH_COMPONENT,s.DEPTH_STENCIL=n.a.DEPTH_STENCIL,s.ALPHA=n.a.ALPHA,s.RGB=n.a.RGB,s.RGBA=n.a.RGBA,s.LUMINANCE=n.a.LUMINANCE,s.LUMINANCE_ALPHA=n.a.LUMINANCE_ALPHA,s.SRGB=35904,s.SRGB_ALPHA=35906,s.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,s.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,s.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,s.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,s.NEAREST=n.a.NEAREST,s.LINEAR=n.a.LINEAR,s.NEAREST_MIPMAP_NEAREST=n.a.NEAREST_MIPMAP_NEAREST,s.LINEAR_MIPMAP_NEAREST=n.a.LINEAR_MIPMAP_NEAREST,s.NEAREST_MIPMAP_LINEAR=n.a.NEAREST_MIPMAP_LINEAR,s.LINEAR_MIPMAP_LINEAR=n.a.LINEAR_MIPMAP_LINEAR,s.REPEAT=n.a.REPEAT,s.CLAMP_TO_EDGE=n.a.CLAMP_TO_EDGE,s.MIRRORED_REPEAT=n.a.MIRRORED_REPEAT,r.a=s},function(t,r,e){"use strict";var i=function(){this._contextId=0,this._caches=[],this._context={}};i.prototype={use:function(t,r){var e=this._caches;e[t]||(e[t]={},r&&(e[t]=r())),this._contextId=t,this._context=e[t]},put:function(t,r){this._context[t]=r},get:function(t){return this._context[t]},dirty:function(t){t=t||"";var r="__dt__"+t;this.put(r,!0)},dirtyAll:function(t){t=t||"";for(var r="__dt__"+t,e=this._caches,i=0;i<e.length;i++)e[i]&&(e[i][r]=!0)},fresh:function(t){t=t||"";var r="__dt__"+t;this.put(r,!1)},freshAll:function(t){t=t||"";for(var r="__dt__"+t,e=this._caches,i=0;i<e.length;i++)e[i]&&(e[i][r]=!1)},isDirty:function(t){t=t||"";var r="__dt__"+t,e=this._context;return!e.hasOwnProperty(r)||!0===e[r]},deleteContext:function(t){delete this._caches[t],this._context={}},delete:function(t){delete this._context[t]},clearAll:function(){this._caches={}},getContext:function(){return this._context},eachContext:function(t,r){Object.keys(this._caches).forEach(function(e){t&&t.call(r,e)})},miss:function(t){return!this._context.hasOwnProperty(t)}},i.prototype.constructor=i,r.a=i},function(t,r,e){"use strict";var i=!0;try{var n=document.createElement("canvas");if(!(n.getContext("webgl")||n.getContext("experimental-webgl")))throw new Error}catch(t){i=!1}var a={};a.supportWebGL=function(){return i},a.Int8Array="undefined"==typeof Int8Array?Array:Int8Array,a.Uint8Array="undefined"==typeof Uint8Array?Array:Uint8Array,a.Uint16Array="undefined"==typeof Uint16Array?Array:Uint16Array,a.Uint32Array="undefined"==typeof Uint32Array?Array:Uint32Array,a.Int16Array="undefined"==typeof Int16Array?Array:Int16Array,a.Float32Array="undefined"==typeof Float32Array?Array:Float32Array,a.Float64Array="undefined"==typeof Float64Array?Array:Float64Array,r.a=a},function(t,r,e){"use strict";function i(t,r){var e="vertex:"+t+"fragment:"+r;if(R[e])return R[e];var i=u.a.genGUID();return R[e]=i,b[i]={vertex:t,fragment:r},i}function n(t){return t.replace(/[ \t]*\/\/.*\n/g,"").replace(/[ \t]*\/\*[\s\S]*?\*\//g,"")}function a(){console.error("Wrong uniform/attributes syntax")}function s(t,r){function e(t){t||a();var r=t.match(/\[(.*?)\]/);u=t.replace(/\[(.*?)\]/,""),f[u]={},r&&(f[u].isArray=!0,f[u].arraySize=r[1])}for(var i=/[,=\(\):]/,n=r.replace(/:\s*\[\s*(.*)\s*\]/g,"="+t+"($1)").replace(/\s+/g,"").split(/(?=[,=\(\):])/g),s=[],o=0;o<n.length;o++)n[o].match(i)?s.push(n[o].charAt(0),n[o].slice(1)):s.push(n[o]);n=s;var u,c=0,f={},l=null;e(n[0]);for(var o=1;o<n.length;o++){var _=n[o];if(_)if("="!==_)if(":"!==_)if(","!==_)if(")"!==_)if("("!==_)if(_.indexOf("vec")>=0){if(1!==c&&4!==c){a();break}c=2,l=[]}else if(1!==c)if(4!==c)e(_),c=0;else{var d=_;T.indexOf(d)>=0||g.indexOf(d)>=0||x.indexOf(d)>=0?f[u].semantic=d:"ignore"===d||"unconfigurable"===d?f[u].ignore=!0:f[u].value="bool"===t?"true"===d:parseFloat(d)}else f[u].value="bool"===t?"true"===_:parseFloat(_),l=null;else{if(2!==c){a();break}if(!(l instanceof Array)){a();break}l.push(+n[++o])}else f[u].value=new h.a.Float32Array(l),l=null,c=5;else if(2===c){if(!(l instanceof Array)){a();break}l.push(+n[++o])}else c=5;else c=4;else{if(0!==c&&3!==c){a();break}c=1}}return f}function o(t,r){"object"==typeof t&&(r=t.fragment,t=t.vertex),t=n(t),r=n(r),this._shaderID=i(t,r),this._vertexCode=o.parseImport(t),this._fragmentCode=o.parseImport(r),this.attributeSemantics={},this.matrixSemantics={},this.uniformSemantics={},this.matrixSemanticKeys=[],this.uniformTemplates={},this.attributes={},this.textures={},this.vertexDefines={},this.fragmentDefines={},this._parseAttributes(),this._parseUniforms(),this._parseDefines()}var u=e(4),h=e(8),c=e(0),f=e.n(c),l=f.a.mat2,_=f.a.mat3,d=f.a.mat4,m=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g,p=/attribute\s+(float|int|vec2|vec3|vec4)\s+([\s\S]*?);/g,y=/#define\s+(\w+)?(\s+[\w-.]+)?\s*;?\s*\n/g,v={bool:"1i",int:"1i",sampler2D:"t",samplerCube:"t",float:"1f",vec2:"2f",vec3:"3f",vec4:"4f",ivec2:"2i",ivec3:"3i",ivec4:"4i",mat2:"m2",mat3:"m3",mat4:"m4"},E={bool:function(){return!0},int:function(){return 0},float:function(){return 0},sampler2D:function(){return null},samplerCube:function(){return null},vec2:function(){return[0,0]},vec3:function(){return[0,0,0]},vec4:function(){return[0,0,0,0]},ivec2:function(){return[0,0]},ivec3:function(){return[0,0,0]},ivec4:function(){return[0,0,0,0]},mat2:function(){return l.create()},mat3:function(){return _.create()},mat4:function(){return d.create()},array:function(){return[]}},T=["POSITION","NORMAL","BINORMAL","TANGENT","TEXCOORD","TEXCOORD_0","TEXCOORD_1","COLOR","JOINT","WEIGHT"],g=["SKIN_MATRIX","VIEWPORT_SIZE","VIEWPORT","DEVICEPIXELRATIO","WINDOW_SIZE","NEAR","FAR","TIME"],x=["WORLD","VIEW","PROJECTION","WORLDVIEW","VIEWPROJECTION","WORLDVIEWPROJECTION","WORLDINVERSE","VIEWINVERSE","PROJECTIONINVERSE","WORLDVIEWINVERSE","VIEWPROJECTIONINVERSE","WORLDVIEWPROJECTIONINVERSE","WORLDTRANSPOSE","VIEWTRANSPOSE","PROJECTIONTRANSPOSE","WORLDVIEWTRANSPOSE","VIEWPROJECTIONTRANSPOSE","WORLDVIEWPROJECTIONTRANSPOSE","WORLDINVERSETRANSPOSE","VIEWINVERSETRANSPOSE","PROJECTIONINVERSETRANSPOSE","WORLDVIEWINVERSETRANSPOSE","VIEWPROJECTIONINVERSETRANSPOSE","WORLDVIEWPROJECTIONINVERSETRANSPOSE"],A={vec4:4,vec3:3,vec2:2,float:1},R={},b={};o.prototype={constructor:o,createUniforms:function(){var t={};for(var r in this.uniformTemplates){var e=this.uniformTemplates[r];t[r]={type:e.type,value:e.value()}}return t},_parseImport:function(){this._vertexCode=o.parseImport(this.vertex),this._fragmentCode=o.parseImport(this.fragment)},_addSemanticUniform:function(t,r,e){if(T.indexOf(e)>=0)this.attributeSemantics[e]={symbol:t,type:r};else if(x.indexOf(e)>=0){var i=!1,n=e;e.match(/TRANSPOSE$/)&&(i=!0,n=e.slice(0,-9)),this.matrixSemantics[e]={symbol:t,type:r,isTranspose:i,semanticNoTranspose:n}}else g.indexOf(e)>=0&&(this.uniformSemantics[e]={symbol:t,type:r})},_addMaterialUniform:function(t,r,e,i,n,a){a[t]={type:e,value:n?E.array:i||E[r],semantic:null}},_parseUniforms:function(){function t(t){return null!=t?function(){return t}:null}function r(r,a,o){var u=s(a,o),h=[];for(var c in u){var f=u[c],l=f.semantic,_=c,d=v[a],m=t(u[c].value);u[c].isArray&&(_+="["+u[c].arraySize+"]",d+="v"),h.push(_),i._uniformList.push(c),f.ignore||("sampler2D"!==a&&"samplerCube"!==a||(i.textures[c]={shaderType:n,type:a}),l?i._addSemanticUniform(c,d,l):i._addMaterialUniform(c,a,d,m,u[c].isArray,e))}return h.length>0?"uniform "+a+" "+h.join(",")+";\n":""}var e={},i=this,n="vertex";this._uniformList=[],this._vertexCode=this._vertexCode.replace(m,r),n="fragment",this._fragmentCode=this._fragmentCode.replace(m,r),i.matrixSemanticKeys=Object.keys(this.matrixSemantics),this.uniformTemplates=e},_parseAttributes:function(){function t(t,i,n){var a=s(i,n),o=A[i]||1,u=[];for(var h in a){var c=a[h].semantic;if(r[h]={type:"float",size:o,semantic:c||null},c){if(T.indexOf(c)<0)throw new Error('Unkown semantic "'+c+'"');e.attributeSemantics[c]={symbol:h,type:i}}u.push(h)}return"attribute "+i+" "+u.join(",")+";\n"}var r={},e=this;this._vertexCode=this._vertexCode.replace(p,t),this.attributes=r},_parseDefines:function(){function t(t,i,n){var a="vertex"===e?r.vertexDefines:r.fragmentDefines;return a[i]||(a[i]="false"!==n&&("true"===n||(n?isNaN(parseFloat(n))?n.trim():parseFloat(n):null))),""}var r=this,e="vertex";this._vertexCode=this._vertexCode.replace(y,t),e="fragment",this._fragmentCode=this._fragmentCode.replace(y,t)},clone:function(){var t=b[this._shaderID];return new o(t.vertex,t.fragment)}},Object.defineProperty&&(Object.defineProperty(o.prototype,"shaderID",{get:function(){return this._shaderID}}),Object.defineProperty(o.prototype,"vertex",{get:function(){return this._vertexCode}}),Object.defineProperty(o.prototype,"fragment",{get:function(){return this._fragmentCode}}),Object.defineProperty(o.prototype,"uniforms",{get:function(){return this._uniformList}}));var M=/(@import)\s*([0-9a-zA-Z_\-\.]*)/g;o.parseImport=function(t){return t=t.replace(M,function(t,r,e){var t=o.source(e);return t?o.parseImport(t):(console.error('Shader chunk "'+e+'" not existed in library'),"")})};var I=/(@export)\s*([0-9a-zA-Z_\-\.]*)\s*\n([\s\S]*?)@end/g;o.import=function(t){t.replace(I,function(t,r,e,i){var i=i.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+\x24)/g,"");if(i){for(var n,a=e.split("."),s=o.codes,u=0;u<a.length-1;)n=a[u++],s[n]||(s[n]={}),s=s[n];n=a[u],s[n]=i}return i})},o.codes={},o.source=function(t){for(var r=t.split("."),e=o.codes,i=0;e&&i<r.length;){e=e[r[i++]]}return"string"!=typeof e?(console.error('Shader "'+t+'" not existed in library'),""):e},r.a=o},function(t,r,e){"use strict";function i(t){var r=Object.keys(t);r.sort();for(var e=[],i=0;i<r.length;i++){var n=r[i],a=t[n];null===a?e.push(n):e.push(n+" "+a.toString())}return e.join("\n")}function n(t,r,e){e.sort();for(var n=[],a=0;a<e.length;a++){var o=e[a];n.push(o)}var u=i(t)+"\n"+i(r)+"\n"+n.join("\n");if(h[u])return h[u];var c=s.a.genGUID();return h[u]=c,c}var a=e(1),s=e(4),o=e(31),u=o.a.parseToFloat,h={},c=a.a.extend(function(){return{name:"",depthTest:!0,depthMask:!0,transparent:!1,blend:null,autoUpdateTextureStatus:!0,uniforms:{},vertexDefines:{},fragmentDefines:{},_textureStatus:{},_enabledUniforms:null}},function(){this.name||(this.name="MATERIAL_"+this.__uid__),this.shader&&this.attachShader(this.shader,!0)},{precision:"highp",setUniform:function(t,r){void 0===r&&console.warn('Uniform value "'+t+'" is undefined');var e=this.uniforms[t];e&&("string"==typeof r&&(r=u(r)||r),e.value=r,this.autoUpdateTextureStatus&&"t"===e.type&&(r?this.enableTexture(t):this.disableTexture(t)))},setUniforms:function(t){for(var r in t){var e=t[r];this.setUniform(r,e)}},isUniformEnabled:function(t){return this._enabledUniforms.indexOf(t)>=0},getEnabledUniforms:function(){return this._enabledUniforms},getTextureUniforms:function(){return this._textureUniforms},set:function(t,r){if("object"==typeof t)for(var e in t){var i=t[e];this.setUniform(e,i)}else this.setUniform(t,r)},get:function(t){var r=this.uniforms[t];if(r)return r.value},attachShader:function(t,r){var e=this.uniforms;this.uniforms=t.createUniforms(),this.shader=t;var i=this.uniforms;this._enabledUniforms=Object.keys(i),this._enabledUniforms.sort(),this._textureUniforms=this._enabledUniforms.filter(function(t){var r=this.uniforms[t].type;return"t"===r||"tv"===r},this);var n=this.vertexDefines,a=this.fragmentDefines;if(this.vertexDefines=s.a.clone(t.vertexDefines),this.fragmentDefines=s.a.clone(t.fragmentDefines),r){for(var o in e)i[o]&&(i[o].value=e[o].value);s.a.defaults(this.vertexDefines,n),s.a.defaults(this.fragmentDefines,a)}var u={};for(var h in t.textures)u[h]={shaderType:t.textures[h].shaderType,type:t.textures[h].type,enabled:!(!r||!this._textureStatus[h])&&this._textureStatus[h].enabled};this._textureStatus=u,this._programKey=""},clone:function(){var t=new this.constructor({name:this.name,shader:this.shader});for(var r in this.uniforms)t.uniforms[r].value=this.uniforms[r].value;return t.depthTest=this.depthTest,t.depthMask=this.depthMask,t.transparent=this.transparent,t.blend=this.blend,t.vertexDefines=s.a.clone(this.vertexDefines),t.fragmentDefines=s.a.clone(this.fragmentDefines),t.enableTexture(this.getEnabledTextures()),t.precision=this.precision,t},define:function(t,r,e){var i=this.vertexDefines,n=this.fragmentDefines;"vertex"!==t&&"fragment"!==t&&"both"!==t&&arguments.length<3&&(e=r,r=t,t="both"),e=null!=e?e:null,"vertex"!==t&&"both"!==t||i[r]!==e&&(i[r]=e,this._programKey=""),"fragment"!==t&&"both"!==t||n[r]!==e&&(n[r]=e,"both"!==t&&(this._programKey=""))},undefine:function(t,r){"vertex"!==t&&"fragment"!==t&&"both"!==t&&arguments.length<2&&(r=t,t="both"),"vertex"!==t&&"both"!==t||this.isDefined("vertex",r)&&(delete this.vertexDefines[r],this._programKey=""),"fragment"!==t&&"both"!==t||this.isDefined("fragment",r)&&(delete this.fragmentDefines[r],"both"!==t&&(this._programKey=""))},isDefined:function(t,r){switch(t){case"vertex":return void 0!==this.vertexDefines[r];case"fragment":return void 0!==this.fragmentDefines[r]}},getDefine:function(t,r){switch(t){case"vertex":return this.vertexDefines[r];case"fragment":return this.fragmentDefines[r]}},enableTexture:function(t){if(Array.isArray(t))for(var r=0;r<t.length;r++)this.enableTexture(t[r]);else{var e=this._textureStatus[t];if(e){e.enabled||(e.enabled=!0,this._programKey="")}}},enableTexturesAll:function(){var t=this._textureStatus;for(var r in t)t[r].enabled=!0;this._programKey=""},disableTexture:function(t){if(Array.isArray(t))for(var r=0;r<t.length;r++)this.disableTexture(t[r]);else{var e=this._textureStatus[t];if(e){!e.enabled||(e.enabled=!1,this._programKey="")}}},disableTexturesAll:function(){var t=this._textureStatus;for(var r in t)t[r].enabled=!1;this._programKey=""},isTextureEnabled:function(t){var r=this._textureStatus;return!!r[t]&&r[t].enabled},getEnabledTextures:function(){var t=[],r=this._textureStatus;for(var e in r)r[e].enabled&&t.push(e);return t},dirtyDefines:function(){this._programKey=""},getProgramKey:function(){return this._programKey||(this._programKey=n(this.vertexDefines,this.fragmentDefines,this.getEnabledTextures())),this._programKey}});r.a=c},function(t,r,e){"use strict";function i(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}function n(t,r){var e=i(t.width),n=i(t.height);return r=r||document.createElement("canvas"),r.width=e,r.height=n,r.getContext("2d").drawImage(t.image,0,0,e,n),r}var a=e(6),s=e(2),o=e(19),u=o.a.isPowerOfTwo,h=a.a.extend(function(){return{image:null,pixels:null,mipmaps:[],convertToPOT:!1}},{textureType:"texture2D",update:function(t){var r=t.gl;r.bindTexture(r.TEXTURE_2D,this._cache.get("webgl_texture")),this.updateCommon(t);var e=this.format,i=this.type,n=!(!this.convertToPOT||this.mipmaps.length||!this.image||this.wrapS!==a.a.REPEAT&&this.wrapT!==a.a.REPEAT||!this.NPOT);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,n?this.wrapS:this.getAvailableWrapS()),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,n?this.wrapT:this.getAvailableWrapT()),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n?this.magFilter:this.getAvailableMagFilter()),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n?this.minFilter:this.getAvailableMinFilter());var o=t.getGLExtension("EXT_texture_filter_anisotropic");if(o&&this.anisotropic>1&&r.texParameterf(r.TEXTURE_2D,o.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),36193===i){t.getGLExtension("OES_texture_half_float")||(i=s.a.FLOAT)}if(this.mipmaps.length)for(var u=this.width,h=this.height,c=0;c<this.mipmaps.length;c++){var f=this.mipmaps[c];this._updateTextureData(r,f,c,u,h,e,i,!1),u/=2,h/=2}else this._updateTextureData(r,this,0,this.width,this.height,e,i,n),!this.useMipmap||this.NPOT&&!n||r.generateMipmap(r.TEXTURE_2D);r.bindTexture(r.TEXTURE_2D,null)},_updateTextureData:function(t,r,e,i,s,o,u,h){if(r.image){var c=r.image;h&&(this._potCanvas=n(this,this._potCanvas),c=this._potCanvas),t.texImage2D(t.TEXTURE_2D,e,o,o,u,c)}else o<=a.a.COMPRESSED_RGBA_S3TC_DXT5_EXT&&o>=a.a.COMPRESSED_RGB_S3TC_DXT1_EXT?t.compressedTexImage2D(t.TEXTURE_2D,e,o,i,s,0,r.pixels):t.texImage2D(t.TEXTURE_2D,e,o,i,s,0,o,u,r.pixels)},generateMipmap:function(t){var r=t.gl;this.useMipmap&&!this.NPOT&&(r.bindTexture(r.TEXTURE_2D,this._cache.get("webgl_texture")),r.generateMipmap(r.TEXTURE_2D))},isPowerOfTwo:function(){return u(this.width)&&u(this.height)},isRenderable:function(){return this.image?"CANVAS"===this.image.nodeName||"VIDEO"===this.image.nodeName||this.image.complete:!(!this.width||!this.height)},bind:function(t){t.gl.bindTexture(t.gl.TEXTURE_2D,this.getWebGLTexture(t))},unbind:function(t){t.gl.bindTexture(t.gl.TEXTURE_2D,null)},load:function(t,r){var e=new Image;r&&(e.crossOrigin=r);var i=this;return e.onload=function(){i.dirty(),i.trigger("success",i),e.onload=null},e.onerror=function(){i.trigger("error",i),e.onerror=null},e.src=t,this.image=e,this}});Object.defineProperty(h.prototype,"width",{get:function(){return this.image?this.image.width:this._width},set:function(t){this.image?console.warn("Texture from image can't set width"):(this._width!==t&&this.dirty(),this._width=t)}}),Object.defineProperty(h.prototype,"height",{get:function(){return this.image?this.image.height:this._height},set:function(t){this.image?console.warn("Texture from image can't set height"):(this._height!==t&&this.dirty(),this._height=t)}}),r.a=h},function(t,r,e){"use strict";var i=e(26),n=i.a.extend({left:-1,right:1,near:-1,far:1,top:1,bottom:-1},{updateProjectionMatrix:function(){this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far)},decomposeProjectionMatrix:function(){var t=this.projectionMatrix.array;this.left=(-1-t[12])/t[0],this.right=(1-t[12])/t[0],this.top=(1-t[13])/t[5],this.bottom=(-1-t[13])/t[5],this.near=-(-1-t[14])/t[10],this.far=-(1-t[14])/t[10]},clone:function(){var t=i.a.prototype.clone.call(this);return t.left=this.left,t.right=this.right,t.near=this.near,t.far=this.far,t.top=this.top,t.bottom=this.bottom,t}});r.a=n},function(t,r,e){"use strict";var i=e(1),n=e(3),a=e(27),s=e(15),o=e(0),u=e.n(o),h=e(5),c=u.a.mat4,f=0,l=i.a.extend({name:"",position:null,rotation:null,scale:null,worldTransform:null,localTransform:null,autoUpdateLocalTransform:!0,_parent:null,_scene:null,_needsUpdateWorldTransform:!0,_inIterating:!1,__depth:0},function(){this.name||(this.name=(this.type||"NODE")+"_"+f++),this.position||(this.position=new n.a),this.rotation||(this.rotation=new a.a),this.scale||(this.scale=new n.a(1,1,1)),this.worldTransform=new s.a,this.localTransform=new s.a,this._children=[]},{target:null,invisible:!1,isSkinnedMesh:function(){return!1},isRenderable:function(){return!1},setName:function(t){var r=this._scene;if(r){var e=r._nodeRepository;delete e[this.name],e[t]=this}this.name=t},add:function(t){var r=t._parent;if(r!==this){r&&r.remove(t),t._parent=this,this._children.push(t);var e=this._scene;e&&e!==t.scene&&t.traverse(this._addSelfToScene,this),t._needsUpdateWorldTransform=!0}},remove:function(t){var r=this._children,e=r.indexOf(t);e<0||(r.splice(e,1),t._parent=null,this._scene&&t.traverse(this._removeSelfFromScene,this))},removeAll:function(){for(var t=this._children,r=0;r<t.length;r++)t[r]._parent=null,this._scene&&t[r].traverse(this._removeSelfFromScene,this);this._children=[]},getScene:function(){return this._scene},getParent:function(){return this._parent},_removeSelfFromScene:function(t){t._scene.removeFromScene(t),t._scene=null},_addSelfToScene:function(t){this._scene.addToScene(t),t._scene=this._scene},isAncestor:function(t){for(var r=t._parent;r;){if(r===this)return!0;r=r._parent}return!1},children:function(){return this._children.slice()},childAt:function(t){return this._children[t]},getChildByName:function(t){for(var r=this._children,e=0;e<r.length;e++)if(r[e].name===t)return r[e]},getDescendantByName:function(t){for(var r=this._children,e=0;e<r.length;e++){var i=r[e];if(i.name===t)return i;var n=i.getDescendantByName(t);if(n)return n}},queryNode:function(t){if(t){for(var r=t.split("/"),e=this,i=0;i<r.length;i++){var n=r[i];if(n){for(var a=!1,s=e._children,o=0;o<s.length;o++){var u=s[o];if(u.name===n){e=u,a=!0;break}}if(!a)return}}return e}},getPath:function(t){if(!this._parent)return"/";for(var r=this._parent,e=this.name;r._parent&&(e=r.name+"/"+e,r._parent!=t);)r=r._parent;return!r._parent&&t?null:e},traverse:function(t,r){t.call(r,this);for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].traverse(t,r)},eachChild:function(t,r){for(var e=this._children,i=0,n=e.length;i<n;i++){var a=e[i];t.call(r,a,i)}},setLocalTransform:function(t){c.copy(this.localTransform.array,t.array),this.decomposeLocalTransform()},decomposeLocalTransform:function(t){var r=t?null:this.scale;this.localTransform.decomposeMatrix(r,this.rotation,this.position)},setWorldTransform:function(t){c.copy(this.worldTransform.array,t.array),this.decomposeWorldTransform()},decomposeWorldTransform:function(){var t=c.create();return function(r){var e=this.localTransform,i=this.worldTransform;this._parent?(c.invert(t,this._parent.worldTransform.array),c.multiply(e.array,t,i.array)):c.copy(e.array,i.array);var n=r?null:this.scale;e.decomposeMatrix(n,this.rotation,this.position)}}(),transformNeedsUpdate:function(){return this.position._dirty||this.rotation._dirty||this.scale._dirty},updateLocalTransform:function(){var t=this.position,r=this.rotation,e=this.scale;if(this.transformNeedsUpdate()){var i=this.localTransform.array;c.fromRotationTranslation(i,r.array,t.array),c.scale(i,i,e.array),r._dirty=!1,e._dirty=!1,t._dirty=!1,this._needsUpdateWorldTransform=!0}},_updateWorldTransformTopDown:function(){var t=this.localTransform.array,r=this.worldTransform.array;this._parent?c.multiplyAffine(r,this._parent.worldTransform.array,t):c.copy(r,t)},updateWorldTransform:function(){for(var t=this;t&&t.getParent()&&t.getParent().transformNeedsUpdate();)t=t.getParent();t.update()},update:function(t){this.autoUpdateLocalTransform?this.updateLocalTransform():t=!0,(t||this._needsUpdateWorldTransform)&&(this._updateWorldTransformTopDown(),t=!0,this._needsUpdateWorldTransform=!1);for(var r=this._children,e=0,i=r.length;e<i;e++)r[e].update(t)},getBoundingBox:function(){function t(t){return!t.invisible&&t.geometry}var r=new h.a,e=new s.a,i=new s.a;return function(n,a){return a=a||new h.a,n=n||t,this._parent?s.a.invert(i,this._parent.worldTransform):s.a.identity(i),this.traverse(function(t){t.geometry&&t.geometry.boundingBox&&(r.copy(t.geometry.boundingBox),s.a.multiply(e,i,t.worldTransform),r.applyTransform(e),a.union(r))},this,t),a}}(),getWorldPosition:function(t){this.transformNeedsUpdate()&&this.updateWorldTransform();var r=this.worldTransform.array;if(t){var e=t.array;return e[0]=r[12],e[1]=r[13],e[2]=r[14],t}return new n.a(r[12],r[13],r[14])},clone:function(){var t=new this.constructor,r=this._children;t.setName(this.name),t.position.copy(this.position),t.rotation.copy(this.rotation),t.scale.copy(this.scale);for(var e=0;e<r.length;e++)t.add(r[e].clone());return t},rotateAround:function(){var t=new n.a,r=new s.a;return function(e,i,n){t.copy(this.position).subtract(e);var a=this.localTransform;a.identity(),a.translate(e),a.rotate(n,i),r.fromRotationTranslation(this.rotation,t),a.multiply(r),a.scale(this.scale),this.decomposeLocalTransform(),this._needsUpdateWorldTransform=!0}}(),lookAt:function(){var t=new s.a;return function(r,e){t.lookAt(this.position,r,e||this.localTransform.y).invert(),this.setLocalTransform(t),this.target=r}}()});r.a=l},function(t,r){var e;e=function(){return this}();try{e=e||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,r,e){"use strict";var i=e(0),n=e.n(i),a=e(3),s=n.a.mat4,o=n.a.vec3,u=n.a.mat3,h=n.a.quat,c=function(){this._axisX=new a.a,this._axisY=new a.a,this._axisZ=new a.a,this.array=s.create(),this._dirty=!0};c.prototype={constructor:c,setArray:function(t){for(var r=0;r<this.array.length;r++)this.array[r]=t[r];return this._dirty=!0,this},adjoint:function(){return s.adjoint(this.array,this.array),this._dirty=!0,this},clone:function(){return(new c).copy(this)},copy:function(t){return s.copy(this.array,t.array),this._dirty=!0,this},determinant:function(){return s.determinant(this.array)},fromQuat:function(t){return s.fromQuat(this.array,t.array),this._dirty=!0,this},fromRotationTranslation:function(t,r){return s.fromRotationTranslation(this.array,t.array,r.array),this._dirty=!0,this},fromMat2d:function(t){return c.fromMat2d(this,t),this},frustum:function(t,r,e,i,n,a){return s.frustum(this.array,t,r,e,i,n,a),this._dirty=!0,this},identity:function(){return s.identity(this.array),this._dirty=!0,this},invert:function(){return s.invert(this.array,this.array),this._dirty=!0,this},lookAt:function(t,r,e){return s.lookAt(this.array,t.array,r.array,e.array),this._dirty=!0,this},mul:function(t){return s.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return s.mul(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return s.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return s.multiply(this.array,t.array,this.array),this._dirty=!0,this},ortho:function(t,r,e,i,n,a){return s.ortho(this.array,t,r,e,i,n,a),this._dirty=!0,this},perspective:function(t,r,e,i){return s.perspective(this.array,t,r,e,i),this._dirty=!0,this},rotate:function(t,r){return s.rotate(this.array,this.array,t,r.array),this._dirty=!0,this},rotateX:function(t){return s.rotateX(this.array,this.array,t),this._dirty=!0,this},rotateY:function(t){return s.rotateY(this.array,this.array,t),this._dirty=!0,this},rotateZ:function(t){return s.rotateZ(this.array,this.array,t),this._dirty=!0,this},scale:function(t){return s.scale(this.array,this.array,t.array),this._dirty=!0,this},translate:function(t){return s.translate(this.array,this.array,t.array),this._dirty=!0,this},transpose:function(){return s.transpose(this.array,this.array),this._dirty=!0,this},decomposeMatrix:function(){var t=o.create(),r=o.create(),e=o.create(),i=u.create();return function(n,a,s){var c=this.array;o.set(t,c[0],c[1],c[2]),o.set(r,c[4],c[5],c[6]),o.set(e,c[8],c[9],c[10]);var f=o.length(t),l=o.length(r),_=o.length(e);this.determinant()<0&&(f=-f),n&&n.set(f,l,_),s.set(c[12],c[13],c[14]),u.fromMat4(i,c),i[0]/=f,i[1]/=f,i[2]/=f,i[3]/=l,i[4]/=l,i[5]/=l,i[6]/=_,i[7]/=_,i[8]/=_,h.fromMat3(a.array,i),h.normalize(a.array,a.array),a._dirty=!0,s._dirty=!0}}(),toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var f=Object.defineProperty;if(f){var l=c.prototype;f(l,"z",{get:function(){var t=this.array;return this._axisZ.set(t[8],t[9],t[10]),this._axisZ},set:function(t){var r=this.array;t=t.array,r[8]=t[0],r[9]=t[1],r[10]=t[2],this._dirty=!0}}),f(l,"y",{get:function(){var t=this.array;return this._axisY.set(t[4],t[5],t[6]),this._axisY},set:function(t){var r=this.array;t=t.array,r[4]=t[0],r[5]=t[1],r[6]=t[2],this._dirty=!0}}),f(l,"x",{get:function(){var t=this.array;return this._axisX.set(t[0],t[1],t[2]),this._axisX},set:function(t){var r=this.array;t=t.array,r[0]=t[0],r[1]=t[1],r[2]=t[2],this._dirty=!0}})}c.adjoint=function(t,r){return s.adjoint(t.array,r.array),t._dirty=!0,t},c.copy=function(t,r){return s.copy(t.array,r.array),t._dirty=!0,t},c.determinant=function(t){return s.determinant(t.array)},c.identity=function(t){return s.identity(t.array),t._dirty=!0,t},c.ortho=function(t,r,e,i,n,a,o){return s.ortho(t.array,r,e,i,n,a,o),t._dirty=!0,t},c.perspective=function(t,r,e,i,n){return s.perspective(t.array,r,e,i,n),t._dirty=!0,t},c.lookAt=function(t,r,e,i){return s.lookAt(t.array,r.array,e.array,i.array),t._dirty=!0,t},c.invert=function(t,r){return s.invert(t.array,r.array),t._dirty=!0,t},c.mul=function(t,r,e){return s.mul(t.array,r.array,e.array),t._dirty=!0,t},c.multiply=c.mul,c.fromQuat=function(t,r){return s.fromQuat(t.array,r.array),t._dirty=!0,t},c.fromRotationTranslation=function(t,r,e){return s.fromRotationTranslation(t.array,r.array,e.array),t._dirty=!0,t},c.fromMat2d=function(t,r){t._dirty=!0;var r=r.array,t=t.array;return t[0]=r[0],t[4]=r[2],t[12]=r[4],t[1]=r[1],t[5]=r[3],t[13]=r[5],t},c.rotate=function(t,r,e,i){return s.rotate(t.array,r.array,e,i.array),t._dirty=!0,t},c.rotateX=function(t,r,e){return s.rotateX(t.array,r.array,e),t._dirty=!0,t},c.rotateY=function(t,r,e){return s.rotateY(t.array,r.array,e),t._dirty=!0,t},c.rotateZ=function(t,r,e){return s.rotateZ(t.array,r.array,e),t._dirty=!0,t},c.scale=function(t,r,e){return s.scale(t.array,r.array,e.array),t._dirty=!0,t},c.transpose=function(t,r){return s.transpose(t.array,r.array),t._dirty=!0,t},c.translate=function(t,r,e){return s.translate(t.array,r.array,e.array),t._dirty=!0,t},r.a=c},function(t,r,e){"use strict";var i=e(17),n=e(5),a=i.a.extend({dynamic:!1,widthSegments:1,heightSegments:1},function(){this.build()},{build:function(){for(var t=this.heightSegments,r=this.widthSegments,e=this.attributes,i=[],a=[],s=[],o=[],u=0;u<=t;u++)for(var h=u/t,c=0;c<=r;c++){var f=c/r;if(i.push([2*f-1,2*h-1,0]),a&&a.push([f,h]),s&&s.push([0,0,1]),c<r&&u<t){var l=c+u*(r+1);o.push([l,l+1,l+r+1]),o.push([l+r+1,l+1,l+r+2])}}e.position.fromArray(i),e.texcoord0.fromArray(a),e.normal.fromArray(s),this.initIndicesFromArray(o),this.boundingBox=new n.a,this.boundingBox.min.set(-1,-1,0),this.boundingBox.max.set(1,1,0)}});r.a=a},function(t,r,e){"use strict";function i(t){return{byte:f.a.Int8Array,ubyte:f.a.Uint8Array,short:f.a.Int16Array,ushort:f.a.Uint16Array}[t]||f.a.Float32Array}function n(t){return"attr_"+t}function a(t,r,e,i){switch(this.name=t,this.type=r,this.size=e,this.semantic=i||"",this.value=null,e){case 1:this.get=function(t){return this.value[t]},this.set=function(t,r){this.value[t]=r},this.copy=function(t,r){this.value[t]=this.value[t]};break;case 2:this.get=function(t,r){var e=this.value;return r[0]=e[2*t],r[1]=e[2*t+1],r},this.set=function(t,r){var e=this.value;e[2*t]=r[0],e[2*t+1]=r[1]},this.copy=function(t,r){var e=this.value;r*=2,t*=2,e[t]=e[r],e[t+1]=e[r+1]};break;case 3:this.get=function(t,r){var e=3*t,i=this.value;return r[0]=i[e],r[1]=i[e+1],r[2]=i[e+2],r},this.set=function(t,r){var e=3*t,i=this.value;i[e]=r[0],i[e+1]=r[1],i[e+2]=r[2]},this.copy=function(t,r){var e=this.value;r*=3,t*=3,e[t]=e[r],e[t+1]=e[r+1],e[t+2]=e[r+2]};break;case 4:this.get=function(t,r){var e=this.value,i=4*t;return r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],r[3]=e[i+3],r},this.set=function(t,r){var e=this.value,i=4*t;e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3]},this.copy=function(t,r){var e=this.value;r*=4,t*=4,e[t]=e[r],e[t+1]=e[r+1],e[t+2]=e[r+2],e[t+3]=e[r+3]}}}function s(t,r,e,i,n){this.name=t,this.type=r,this.buffer=e,this.size=i,this.semantic=n,this.symbol="",this.needsRemove=!1}function o(t){this.buffer=t,this.count=0}var u=e(1),h=e(2),c=e(7),f=e(8),l=e(0),_=e.n(l),d=e(5),m=_.a.vec3,p=_.a.mat4,y=m.create,v=m.add,E=m.set;a.prototype.init=function(t){if(!this.value||this.value.length!=t*this.size){var r=i(this.type);this.value=new r(t*this.size)}},a.prototype.fromArray=function(t){var r,e=i(this.type);if(t[0]&&t[0].length){var n=0,a=this.size;r=new e(t.length*a);for(var s=0;s<t.length;s++)for(var o=0;o<a;o++)r[n++]=t[s][o]}else r=new e(t);this.value=r},a.prototype.clone=function(t){var r=new a(this.name,this.type,this.size,this.semantic);return t&&console.warn("todo"),r};var T=u.a.extend(function(){return{attributes:{position:new a("position","float",3,"POSITION"),texcoord0:new a("texcoord0","float",2,"TEXCOORD_0"),texcoord1:new a("texcoord1","float",2,"TEXCOORD_1"),normal:new a("normal","float",3,"NORMAL"),tangent:new a("tangent","float",4,"TANGENT"),color:new a("color","float",4,"COLOR"),weight:new a("weight","float",3,"WEIGHT"),joint:new a("joint","float",4,"JOINT"),barycentric:new a("barycentric","float",3,null)},boundingBox:null,indices:null,dynamic:!0,_enabledAttributes:null,__used:0}},function(){this._cache=new c.a,this._attributeList=Object.keys(this.attributes),this.__vaoCache={}},{mainAttribute:"position",pick:null,pickByRay:null,updateBoundingBox:function(){var t=this.boundingBox;t||(t=this.boundingBox=new d.a);var r=this.attributes.position.value;if(r&&r.length){var e=t.min,i=t.max,n=e.array,a=i.array;m.set(n,r[0],r[1],r[2]),m.set(a,r[0],r[1],r[2]);for(var s=3;s<r.length;){var o=r[s++],u=r[s++],h=r[s++];o<n[0]&&(n[0]=o),u<n[1]&&(n[1]=u),h<n[2]&&(n[2]=h),o>a[0]&&(a[0]=o),u>a[1]&&(a[1]=u),h>a[2]&&(a[2]=h)}e._dirty=!0,i._dirty=!0}},dirty:function(){for(var t=this.getEnabledAttributes(),r=0;r<t.length;r++)this.dirtyAttribute(t[r]);this.dirtyIndices(),this._enabledAttributes=null,this._cache.dirty("any")},dirtyIndices:function(){this._cache.dirtyAll("indices")},dirtyAttribute:function(t){this._cache.dirtyAll(n(t)),this._cache.dirtyAll("attributes")},getTriangleIndices:function(t,r){if(t<this.triangleCount&&t>=0){r||(r=y());var e=this.indices;return r[0]=e[3*t],r[1]=e[3*t+1],r[2]=e[3*t+2],r}},setTriangleIndices:function(t,r){var e=this.indices;e[3*t]=r[0],e[3*t+1]=r[1],e[3*t+2]=r[2]},isUseIndices:function(){return!!this.indices},initIndicesFromArray:function(t){var r,e=this.vertexCount>65535?f.a.Uint32Array:f.a.Uint16Array;if(t[0]&&t[0].length){var i=0;r=new e(3*t.length);for(var n=0;n<t.length;n++)for(var a=0;a<3;a++)r[i++]=t[n][a]}else r=new e(t);this.indices=r},createAttribute:function(t,r,e,i){var n=new a(t,r,e,i);return this.attributes[t]&&this.removeAttribute(t),this.attributes[t]=n,this._attributeList.push(t),n},removeAttribute:function(t){var r=this._attributeList,e=r.indexOf(t);return e>=0&&(r.splice(e,1),delete this.attributes[t],!0)},getAttribute:function(t){return this.attributes[t]},getEnabledAttributes:function(){var t=this._enabledAttributes,r=this._attributeList;if(t)return t;for(var e=[],i=this.vertexCount,n=0;n<r.length;n++){var a=r[n],s=this.attributes[a];s.value&&s.value.length===i*s.size&&e.push(a)}return this._enabledAttributes=e,e},getBufferChunks:function(t){var r=this._cache;r.use(t.__uid__);var e=r.isDirty("attributes"),i=r.isDirty("indices");if(e||i){this._updateBuffer(t.gl,e,i);for(var a=this.getEnabledAttributes(),s=0;s<a.length;s++)r.fresh(n(a[s]));r.fresh("attributes"),r.fresh("indices")}return r.fresh("any"),r.get("chunks")},_updateBuffer:function(t,r,e){var i=this._cache,a=i.get("chunks"),u=!1;a||(a=[],a[0]={attributeBuffers:[],indicesBuffer:null},i.put("chunks",a),u=!0);var c=a[0],f=c.attributeBuffers,l=c.indicesBuffer;if(r||u){var _=this.getEnabledAttributes(),d={};if(!u)for(var m=0;m<f.length;m++)d[f[m].name]=f[m];for(var p=0;p<_.length;p++){var y,v=_[p],E=this.attributes[v];u||(y=d[v]);var T;T=y?y.buffer:t.createBuffer(),i.isDirty(n(v))&&(t.bindBuffer(t.ARRAY_BUFFER,T),t.bufferData(t.ARRAY_BUFFER,E.value,this.dynamic?h.a.DYNAMIC_DRAW:h.a.STATIC_DRAW)),f[p]=new s(v,E.type,T,E.size,E.semantic)}for(var m=p;m<f.length;m++)t.deleteBuffer(f[m].buffer);f.length=p}this.isUseIndices()&&(e||u)&&(l||(l=new o(t.createBuffer()),c.indicesBuffer=l),l.count=this.indices.length,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,l.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,this.dynamic?h.a.DYNAMIC_DRAW:h.a.STATIC_DRAW))},generateVertexNormals:function(){if(this.vertexCount){var t=this.indices,r=this.attributes,e=r.position.value,i=r.normal.value;if(i&&i.length===e.length)for(var n=0;n<i.length;n++)i[n]=0;else i=r.normal.value=new f.a.Float32Array(e.length);for(var a,s,o,u=y(),h=y(),c=y(),l=y(),_=y(),d=y(),p=t?t.length:this.vertexCount,v=0;v<p;){t?(a=t[v++],s=t[v++],o=t[v++]):(a=v++,s=v++,o=v++),E(u,e[3*a],e[3*a+1],e[3*a+2]),E(h,e[3*s],e[3*s+1],e[3*s+2]),E(c,e[3*o],e[3*o+1],e[3*o+2]),m.sub(l,u,h),m.sub(_,h,c),m.cross(d,l,_);for(var n=0;n<3;n++)i[3*a+n]=i[3*a+n]+d[n],i[3*s+n]=i[3*s+n]+d[n],i[3*o+n]=i[3*o+n]+d[n]}for(var n=0;n<i.length;)E(d,i[n],i[n+1],i[n+2]),m.normalize(d,d),i[n++]=d[0],i[n++]=d[1],i[n++]=d[2];this.dirty()}},generateFaceNormals:function(){if(this.vertexCount){this.isUniqueVertex()||this.generateUniqueVertex();var t=this.indices,r=this.attributes,e=r.position.value,i=r.normal.value,n=y(),a=y(),s=y(),o=y(),u=y(),h=y();i||(i=r.normal.value=new Float32Array(e.length));for(var c,f,l,_=t?t.length:this.vertexCount,d=0;d<_;){t?(c=t[d++],f=t[d++],l=t[d++]):(c=d++,f=d++,l=d++),E(n,e[3*c],e[3*c+1],e[3*c+2]),E(a,e[3*f],e[3*f+1],e[3*f+2]),E(s,e[3*l],e[3*l+1],e[3*l+2]),m.sub(o,n,a),m.sub(u,a,s),m.cross(h,o,u),m.normalize(h,h);for(var p=0;p<3;p++)i[3*c+p]=h[p],i[3*f+p]=h[p],i[3*l+p]=h[p]}this.dirty()}},generateTangents:function(){if(this.vertexCount){var t=this.vertexCount,r=this.attributes;r.tangent.value||(r.tangent.value=new Float32Array(4*t));var e=r.texcoord0.value,i=r.position.value,n=r.tangent.value,a=r.normal.value;if(!e)return void console.warn("Geometry without texcoords can't generate tangents.");for(var s=[],o=[],u=0;u<t;u++)s[u]=[0,0,0],o[u]=[0,0,0];for(var h,c,f,l=[0,0,0],_=[0,0,0],d=this.indices,p=d?d.length:this.vertexCount,u=0;u<p;){d?(h=d[u++],c=d[u++],f=d[u++]):(h=u++,c=u++,f=u++);var E=e[2*h],T=e[2*c],g=e[2*f],x=e[2*h+1],A=e[2*c+1],R=e[2*f+1],b=i[3*h],M=i[3*c],I=i[3*f],S=i[3*h+1],N=i[3*c+1],O=i[3*f+1],w=i[3*h+2],P=i[3*c+2],L=i[3*f+2],C=M-b,D=I-b,U=N-S,F=O-S,B=P-w,V=L-w,X=T-E,k=g-E,W=A-x,G=R-x,z=1/(X*G-W*k);l[0]=(G*C-W*D)*z,l[1]=(G*U-W*F)*z,l[2]=(G*B-W*V)*z,_[0]=(X*D-k*C)*z,_[1]=(X*F-k*U)*z,_[2]=(X*V-k*B)*z,v(s[h],s[h],l),v(s[c],s[c],l),v(s[f],s[f],l),v(o[h],o[h],_),v(o[c],o[c],_),v(o[f],o[f],_)}for(var q=y(),H=y(),j=y(),u=0;u<t;u++){j[0]=a[3*u],j[1]=a[3*u+1],j[2]=a[3*u+2];var Y=s[u];m.scale(q,j,m.dot(j,Y)),m.sub(q,Y,q),m.normalize(q,q),m.cross(H,j,Y),n[4*u]=q[0],n[4*u+1]=q[1],n[4*u+2]=q[2],n[4*u+3]=m.dot(H,o[u])<0?-1:1}this.dirty()}},isUniqueVertex:function(){return!this.isUseIndices()||this.vertexCount===this.indices.length},generateUniqueVertex:function(){if(this.vertexCount&&this.indices){this.indices.length>65535&&(this.indices=new f.a.Uint32Array(this.indices));for(var t=this.attributes,r=this.indices,e=this.getEnabledAttributes(),i={},n=0;n<e.length;n++){var a=e[n];i[a]=t[a].value,t[a].init(this.indices.length)}for(var s=0,o=0;o<r.length;o++){for(var u=r[o],n=0;n<e.length;n++)for(var a=e[n],h=t[a].value,c=t[a].size,l=0;l<c;l++)h[s*c+l]=i[a][u*c+l];r[o]=s,s++}this.dirty()}},generateBarycentric:function(){if(this.vertexCount){this.isUniqueVertex()||this.generateUniqueVertex();var t=this.attributes,r=t.barycentric.value,e=this.indices;if(!r||r.length!==3*e.length){r=t.barycentric.value=new Float32Array(3*e.length);for(var i=0;i<(e?e.length:this.vertexCount/3);)for(var n=0;n<3;n++){var a=e?e[i++]:3*i+n;r[3*a+n]=1}this.dirty()}}},applyTransform:function(t){var r=this.attributes,e=r.position.value,i=r.normal.value,n=r.tangent.value;t=t.array;var a=p.create();p.invert(a,t),p.transpose(a,a);var s=m.transformMat4,o=m.forEach;o(e,3,0,null,s,t),i&&o(i,3,0,null,s,a),n&&o(n,4,0,null,s,a),this.boundingBox&&this.updateBoundingBox()},dispose:function(t){var r=this._cache;r.use(t.__uid__);var e=r.get("chunks");if(e)for(var i=0;i<e.length;i++){for(var n=e[i],a=0;a<n.attributeBuffers.length;a++){var s=n.attributeBuffers[a];t.gl.deleteBuffer(s.buffer)}n.indicesBuffer&&t.gl.deleteBuffer(n.indicesBuffer.buffer)}if(this.__vaoCache){var o=t.getGLExtension("OES_vertex_array_object");for(var u in this.__vaoCache){var h=this.__vaoCache[u].vao;h&&o.deleteVertexArrayOES(h)}}this.__vaoCache={},r.deleteContext(t.__uid__)}});Object.defineProperty&&(Object.defineProperty(T.prototype,"vertexCount",{enumerable:!1,get:function(){var t=this.attributes[this.mainAttribute];return t&&t.value?t.value.length/t.size:0}}),Object.defineProperty(T.prototype,"triangleCount",{enumerable:!1,get:function(){var t=this.indices;return t?t.length/3:0}})),T.STATIC_DRAW=h.a.STATIC_DRAW,T.DYNAMIC_DRAW=h.a.DYNAMIC_DRAW,T.STREAM_DRAW=h.a.STREAM_DRAW,T.AttributeBuffer=s,T.IndicesBuffer=o,T.Attribute=a,r.a=T},function(t,r,e){"use strict";var i=e(34),n=e(2),a=(e(11),i.a.extend({skeleton:null,joints:null,useSkinMatricesTexture:!1},function(){this.joints||(this.joints=[])},{isSkinnedMesh:function(){return!!(this.skeleton&&this.joints&&this.joints.length>0)},clone:function(){var t=i.a.prototype.clone.call(this);return t.skeleton=this.skeleton,this.joints&&(t.joints=this.joints.slice()),t}}));a.POINTS=n.a.POINTS,a.LINES=n.a.LINES,a.LINE_LOOP=n.a.LINE_LOOP,a.LINE_STRIP=n.a.LINE_STRIP,a.TRIANGLES=n.a.TRIANGLES,a.TRIANGLE_STRIP=n.a.TRIANGLE_STRIP,a.TRIANGLE_FAN=n.a.TRIANGLE_FAN,a.BACK=n.a.BACK,a.FRONT=n.a.FRONT,a.FRONT_AND_BACK=n.a.FRONT_AND_BACK,a.CW=n.a.CW,a.CCW=n.a.CCW,r.a=a},function(t,r,e){"use strict";var i={};i.isPowerOfTwo=function(t){return 0==(t&t-1)},i.nextPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},i.nearestPowerOfTwo=function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))},r.a=i},function(t,r,e){"use strict";var i={linear:function(t){return t},quadraticIn:function(t){return t*t},quadraticOut:function(t){return t*(2-t)},quadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quarticIn:function(t){return t*t*t*t},quarticOut:function(t){return 1- --t*t*t*t},quarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quinticIn:function(t){return t*t*t*t*t},quinticOut:function(t){return--t*t*t*t*t+1},quinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sinusoidalIn:function(t){return 1-Math.cos(t*Math.PI/2)},sinusoidalOut:function(t){return Math.sin(t*Math.PI/2)},sinusoidalInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},exponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},exponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},exponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circularIn:function(t){return 1-Math.sqrt(1-t*t)},circularOut:function(t){return Math.sqrt(1- --t*t)},circularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var r,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,r=.1):r=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-r)*(2*Math.PI)/.4))},elasticOut:function(t){var r,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,r=.1):r=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-r)*(2*Math.PI)/.4)+1)},elasticInOut:function(t){var r,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,r=.1):r=.4*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-r)*(2*Math.PI)/.4)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-r)*(2*Math.PI)/.4)*.5+1)},backIn:function(t){var r=1.70158;return t*t*((r+1)*t-r)},backOut:function(t){var r=1.70158;return--t*t*((r+1)*t+r)+1},backInOut:function(t){var r=2.5949095;return(t*=2)<1?t*t*((r+1)*t-r)*.5:.5*((t-=2)*t*((r+1)*t+r)+2)},bounceIn:function(t){return 1-i.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?.5*i.bounceIn(2*t):.5*i.bounceOut(2*t-1)+.5}};r.a=i},function(t,r,e){"use strict";function i(){u.resize(document.body.clientWidth,document.body.clientHeight)}Object.defineProperty(r,"__esModule",{value:!0});var n=e(22),a=e(41),s=e(47),o=e(11),u=new a.a({canvas:document.getElementById("main")}),h=new s.a;h.start();var c=["rgb(255, 255, 217)","rgb(237, 248, 186)","rgb(205, 235, 180)","rgb(151, 215, 185)","rgb(93, 192, 192)","rgb(50, 165, 194)","rgb(33, 127, 183)","rgb(34, 85, 164)","rgb(30, 52, 137)","rgb(8, 29, 88)"],f=new n.a;f.setSupersampling(2),f.setParticleDensity(256),f.setParticleSize(2),f.setGradientTexture(new o.a({image:function(){var t=document.createElement("canvas");t.width=32,t.height=6;for(var r=t.getContext("2d"),e=r.createLinearGradient(0,t.height/2,t.width,t.height/2),i=0;i<c.length;i++)e.addColorStop(i/(c.length-1),c[i]);return r.fillStyle=e,r.fillRect(0,0,t.width,t.height),t}()})),f.generateSpawnTexture(256),h.on("frame",function(t){t=Math.min(t,20),f.update(u,t),f.output(u)}),window.addEventListener("resize",i),i()},function(t,r,e){"use strict";function i(t){var r=document.createElement("canvas");r.width=r.height=t;var e=r.getContext("2d");return e.fillStyle="#fff",e.arc(t/2,t/2,t/2,0,2*Math.PI),e.fill(),r}function n(){this.motionBlurFactor=.995,this.particleLife=[5,15],this.particleSpeedScaling=1,this.particleColor=[1,1,1,1];var t={type:m.a?c.a.HALF_FLOAT:c.a.FLOAT,minFilter:c.a.NEAREST,magFilter:c.a.NEAREST,useMipmap:!1};this.spawnTexture=new h.a(t),this.spawnTexture.type=c.a.FLOAT,this.noiseTexture=new h.a(Object.assign({width:256,height:256,wrapS:c.a.CLAMP_TO_EDGE,wrapT:c.a.CLAMP_TO_EDGE},t)),this._posTexture0=new h.a(t),this._posTexture1=new h.a(t),this._frameBuffer=new d.a({depthBuffer:!1}),this._noisePass=new a.a({fragment:u.a.source("curl.noise")}),this._particlePass=new a.a({fragment:u.a.source("curl.updateParticle")}),this._downsamplePass=new a.a({fragment:u.a.source("curl.downsample")}),this._outputPass=new a.a({fragment:u.a.source("curl.output"),blendWithPrevious:!0});var r=new s.a({renderOrder:10,material:new o.a({shader:new u.a(u.a.source("curl.renderLines.vertex"),u.a.source("curl.renderLines.fragment"))}),geometry:new _.a,culling:!1}),e=new u.a(u.a.source("clay.compositor.vertex"),u.a.source("curl.output")),i=new s.a({material:new o.a({shader:e}),geometry:new l.a});this._particleLinesMesh=r,this._lastFrameFullQuadMesh=i,this._camera=new f.a,this._thisFrameTexture=new h.a,this._lastFrameTexture=new h.a,this._frame=0,this._elapsedTime=0,this._downsampleTextures=[]}var a=e(23),s=e(18),o=e(10),u=e(9),h=e(11),c=e(6),f=e(12),l=e(16),_=e(36),d=e(37),m=e(39),p=e(40),y=e.n(p);u.a.import(y.a),n.prototype={constructor:n,setParticleDensity:function(t){this._setLineGeometry(t,t),this._posTexture0.width=this._posTexture1.width=t,this._posTexture0.height=this._posTexture1.height=t,this._noisePass.setUniform("textureSize",[t,t])},generateSpawnTexture:function(t){var r=t*t,e=new Float32Array(4*r),i=0,n=this.particleLife;"number"==typeof n&&(n=[n,n]);for(var a=0;a<t;a++)for(var s=0;s<t;s++,i++){e[4*i]=Math.random(),e[4*i+1]=Math.random(),e[4*i+2]=0;var o=(n[1]-n[0])*Math.random()+n[0];e[4*i+3]=o}var u=this.spawnTexture;u.width=t,u.height=t,u.pixels=e,u.dirty()},_setLineGeometry:function(t,r){var e=t*r,i=this._getParticleMesh().geometry;i.setLineCount(e),i.resetOffset();for(var n=0;n<t;n++)for(var a=0;a<r;a++)i.addLine([n/t,a/r]);i.dirty()},_getParticleMesh:function(){return this._particleLinesMesh},update:function(t,r){r/=1e3,this._elapsedTime+=r;var e=this._frame;this._frame++,this.resize(t.getWidth(),t.getHeight());var i=this._getParticleMesh(),n=this._frameBuffer,a=this._noisePass,s=this._particlePass,o=0===e;o&&this._updateDownsampleTextures(t),n.bind(t),n.attach(this.noiseTexture),a.setUniform("elapsedTime",this._elapsedTime),a.render(t),n.attach(this._posTexture1),s.setUniform("speedScaling",this.particleSpeedScaling),s.setUniform("posTexture",this._posTexture0),s.setUniform("noiseTexture",this.noiseTexture),s.setUniform("spawnTexture",this.spawnTexture),s.setUniform("deltaTime",r),s.setUniform("firstFrame",o),s.setUniform("noiseTextureSize",this.noiseTexture.width),s.render(t),n.attach(this._thisFrameTexture),t.gl.clear(t.gl.DEPTH_BUFFER_BIT|t.gl.COLOR_BUFFER_BIT),this._camera.update(!0);var u=this._lastFrameFullQuadMesh;u.material.set("texture",this._lastFrameTexture),u.material.set("color",[1,1,1,this.motionBlurFactor]),i.material.set("size",this._particleSize*this._supersampling),i.material.set("color",this.particleColor),i.material.set("posTexture",this._posTexture1),i.material.set("prevPosTexture",this._posTexture0),t.renderPass([u,i],this._camera),n.unbind(t),this._downsample(t),this._swapTexture(),this._elapsedTime+=r},output:function(t){this._outputPass.setUniform("texture",this.getSurfaceTexture()),this._outputPass.render(t)},_downsample:function(t){var r=this._downsampleTextures;if(0!==r.length)for(var e=0,i=this._thisFrameTexture,n=r[e];n;)this._frameBuffer.attach(n),this._downsamplePass.setUniform("texture",i),this._downsamplePass.setUniform("textureSize",[i.width,i.height]),this._downsamplePass.render(t,this._frameBuffer),i=n,n=r[++e]},getSurfaceTexture:function(){var t=this._downsampleTextures;return t.length>0?t[t.length-1]:this._lastFrameTexture},resize:function(t,r){this._lastFrameTexture.width=t*this._supersampling,this._lastFrameTexture.height=r*this._supersampling,this._thisFrameTexture.width=t*this._supersampling,this._thisFrameTexture.height=r*this._supersampling,this._width=t,this._height=r},setParticleSize:function(t){var r=this._getParticleMesh();if(this._particleSize=t,t<=2)return r.material.disableTexture("spriteTexture"),void(r.material.transparent=!1);this._spriteTexture||(this._spriteTexture=new h.a),this._spriteTexture.image&&this._spriteTexture.image.width===t||(this._spriteTexture.image=i(t),this._spriteTexture.dirty()),r.material.transparent=!0,r.material.enableTexture("spriteTexture"),r.material.set("spriteTexture",this._spriteTexture)},setGradientTexture:function(t){this._getParticleMesh().material.setUniform("gradientTexture",t)},clearFrame:function(t){this._frame=0;var r=this._frameBuffer;r.attach(this._lastFrameTexture),r.bind(t),t.gl.clear(t.gl.DEPTH_BUFFER_BIT|t.gl.COLOR_BUFFER_BIT),r.unbind(t)},setSupersampling:function(t){this._supersampling=t,this.resize(this._width,this._height)},_updateDownsampleTextures:function(t){for(var r=this._downsampleTextures,e=Math.max(Math.floor(Math.log(this._supersampling/t.getDevicePixelRatio())/Math.log(2)),0),i=2,n=this._width*this._supersampling,a=this._height*this._supersampling,s=0;s<e;s++)r[s]=r[s]||new h.a,r[s].width=n/i,r[s].height=a/i,i*=2;for(;s<r.length;s++)r[s].dispose(t);r.length=e},_swapTexture:function(){var t=this._posTexture0;this._posTexture0=this._posTexture1,this._posTexture1=t;var t=this._thisFrameTexture;this._thisFrameTexture=this._lastFrameTexture,this._lastFrameTexture=t},dispose:function(t){t.disposeFrameBuffer(this._frameBuffer),t.disposeTexture(this.forceFieldTexture),t.disposeTexture(this.spawnTexture),t.disposeTexture(this._posTexture0),t.disposeTexture(this._posTexture1),t.disposeTexture(this._thisFrameTexture),t.disposeTexture(this._lastFrameTexture),t.disposeGeometry(this._particleLinesMesh.geometry),t.disposeGeometry(this._lastFrameFullQuadMesh.geometry),this._spriteTexture&&t.disposeTexture(this._spriteTexture),this._downsamplePass.dispose(t),this._downsampleTextures.forEach(function(r){r.dispose(t)})}},r.a=n},function(t,r,e){"use strict";var i=e(1),n=e(12),a=e(16),s=e(9),o=e(10),u=e(18),h=e(2),c=e(35);s.a.import(c.a);var f=new a.a,l=new u.a({geometry:f,frustumCulling:!1}),_=new n.a,d=i.a.extend(function(){return{fragment:"",outputs:null,material:null,blendWithPrevious:!1,clearColor:!1,clearDepth:!0}},function(){var t=new s.a(s.a.source("clay.compositor.vertex"),this.fragment),r=new o.a({shader:t});r.enableTexturesAll(),this.material=r},{setUniform:function(t,r){this.material.setUniform(t,r)},getUniform:function(t){var r=this.material.uniforms[t];if(r)return r.value},attachOutput:function(t,r){this.outputs||(this.outputs={}),r=r||h.a.COLOR_ATTACHMENT0,this.outputs[r]=t},detachOutput:function(t){for(var r in this.outputs)this.outputs[r]===t&&(this.outputs[r]=null)},bind:function(t,r){if(this.outputs)for(var e in this.outputs){var i=this.outputs[e];i&&r.attach(i,e)}r&&r.bind(t)},unbind:function(t,r){r.unbind(t)},render:function(t,r){var e=t.gl;if(r){this.bind(t,r);var i=t.getGLExtension("EXT_draw_buffers");if(i&&this.outputs){var n=[];for(var a in this.outputs)(a=+a)>=e.COLOR_ATTACHMENT0&&a<=e.COLOR_ATTACHMENT0+8&&n.push(a);i.drawBuffersEXT(n)}}this.trigger("beforerender",this,t);var s=this.clearDepth?e.DEPTH_BUFFER_BIT:0;if(e.depthMask(!0),this.clearColor){s|=e.COLOR_BUFFER_BIT,e.colorMask(!0,!0,!0,!0);var o=this.clearColor;Array.isArray(o)&&e.clearColor(o[0],o[1],o[2],o[3])}e.clear(s),this.blendWithPrevious?(e.enable(e.BLEND),this.material.transparent=!0):(e.disable(e.BLEND),this.material.transparent=!1),this.renderQuad(t),this.trigger("afterrender",this,t),r&&this.unbind(t,r)},renderQuad:function(t){l.material=this.material,t.renderPass([l],_)},dispose:function(t){}});r.a=d},function(t,r,e){"use strict";function i(t,r,e){"object"==typeof r&&(e=r,r=null);var i,s=this;if(!(t instanceof Function)){i=[];for(var o in t)t.hasOwnProperty(o)&&i.push(o)}var u=function(r){if(s.apply(this,arguments),t instanceof Function?n(this,t.call(this,r)):a(this,t,i),this.constructor===u)for(var e=u.__initializers__,o=0;o<e.length;o++)e[o].apply(this,arguments)};u.__super__=s,s.__initializers__?u.__initializers__=s.__initializers__.slice():u.__initializers__=[],r&&u.__initializers__.push(r);var h=function(){};return h.prototype=s.prototype,u.prototype=new h,u.prototype.constructor=u,n(u.prototype,e),u.extend=s.extend,u.derive=s.extend,u}function n(t,r){if(r)for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])}function a(t,r,e){for(var i=0;i<e.length;i++){var n=e[i];t[n]=r[n]}}r.a={extend:i,derive:i}},function(t,r,e){"use strict";function i(t,r){this.action=t,this.context=r}var n={trigger:function(t){if(this.hasOwnProperty("__handlers__")&&this.__handlers__.hasOwnProperty(t)){var r=this.__handlers__[t],e=r.length,i=-1,n=arguments;switch(n.length){case 1:for(;++i<e;)r[i].action.call(r[i].context);return;case 2:for(;++i<e;)r[i].action.call(r[i].context,n[1]);return;case 3:for(;++i<e;)r[i].action.call(r[i].context,n[1],n[2]);return;case 4:for(;++i<e;)r[i].action.call(r[i].context,n[1],n[2],n[3]);return;case 5:for(;++i<e;)r[i].action.call(r[i].context,n[1],n[2],n[3],n[4]);return;default:for(;++i<e;)r[i].action.apply(r[i].context,Array.prototype.slice.call(n,1));return}}},on:function(t,r,e){if(t&&r){var n=this.__handlers__||(this.__handlers__={});if(n[t]){if(this.has(t,r))return}else n[t]=[];var a=new i(r,e||this);return n[t].push(a),this}},once:function(t,r,e){function i(){n.off(t,i),r.apply(this,arguments)}if(t&&r){var n=this;return this.on(t,i,e)}},before:function(t,r,e){if(t&&r)return t="before"+t,this.on(t,r,e)},after:function(t,r,e){if(t&&r)return t="after"+t,this.on(t,r,e)},success:function(t,r){return this.once("success",t,r)},error:function(t,r){return this.once("error",t,r)},off:function(t,r){var e=this.__handlers__||(this.__handlers__={});if(!r)return void(e[t]=[]);if(e[t]){for(var i=e[t],n=[],a=0;a<i.length;a++)r&&i[a].action!==r&&n.push(i[a]);e[t]=n}return this},has:function(t,r){var e=this.__handlers__;if(!e||!e[t])return!1;for(var i=e[t],n=0;n<i.length;n++)if(i[n].action===r)return!0}};r.a=n},function(t,r,e){"use strict";var i=e(13),n=e(15),a=e(28),s=e(30),o=e(0),u=e.n(o),h=u.a.vec3,c=u.a.vec4,f=i.a.extend(function(){return{projectionMatrix:new n.a,invProjectionMatrix:new n.a,viewMatrix:new n.a,frustum:new a.a}},function(){this.update(!0)},{update:function(t){i.a.prototype.update.call(this,t),n.a.invert(this.viewMatrix,this.worldTransform),this.updateProjectionMatrix(),n.a.invert(this.invProjectionMatrix,this.projectionMatrix),this.frustum.setFromProjection(this.projectionMatrix)},setViewMatrix:function(t){n.a.copy(this.viewMatrix,t),n.a.invert(this.worldTransform,t),this.decomposeWorldTransform()},decomposeProjectionMatrix:function(){},setProjectionMatrix:function(t){n.a.copy(this.projectionMatrix,t),n.a.invert(this.invProjectionMatrix,t),this.decomposeProjectionMatrix()},updateProjectionMatrix:function(){},castRay:function(){var t=c.create();return function(r,e){var i=void 0!==e?e:new s.a,n=r.array[0],a=r.array[1];return c.set(t,n,a,-1,1),c.transformMat4(t,t,this.invProjectionMatrix.array),c.transformMat4(t,t,this.worldTransform.array),h.scale(i.origin.array,t,1/t[3]),c.set(t,n,a,1,1),c.transformMat4(t,t,this.invProjectionMatrix.array),c.transformMat4(t,t,this.worldTransform.array),h.scale(t,t,1/t[3]),h.sub(i.direction.array,t,i.origin.array),h.normalize(i.direction.array,i.direction.array),i.direction._dirty=!0,i.origin._dirty=!0,i}}()});r.a=f},function(t,r,e){"use strict";var i=e(0),n=e.n(i),a=n.a.quat,s=function(t,r,e,i){t=t||0,r=r||0,e=e||0,i=void 0===i?1:i,this.array=a.fromValues(t,r,e,i),this._dirty=!0};s.prototype={constructor:s,add:function(t){return a.add(this.array,this.array,t.array),this._dirty=!0,this},calculateW:function(){return a.calculateW(this.array,this.array),this._dirty=!0,this},set:function(t,r,e,i){return this.array[0]=t,this.array[1]=r,this.array[2]=e,this.array[3]=i,this._dirty=!0,this},setArray:function(t){return this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2],this.array[3]=t[3],this._dirty=!0,this},clone:function(){return new s(this.x,this.y,this.z,this.w)},conjugate:function(){return a.conjugate(this.array,this.array),this._dirty=!0,this},copy:function(t){return a.copy(this.array,t.array),this._dirty=!0,this},dot:function(t){return a.dot(this.array,t.array)},fromMat3:function(t){return a.fromMat3(this.array,t.array),this._dirty=!0,this},fromMat4:function(){var t=n.a.mat3,r=t.create();return function(e){return t.fromMat4(r,e.array),t.transpose(r,r),a.fromMat3(this.array,r),this._dirty=!0,this}}(),identity:function(){return a.identity(this.array),this._dirty=!0,this},invert:function(){return a.invert(this.array,this.array),this._dirty=!0,this},len:function(){return a.len(this.array)},length:function(){return a.length(this.array)},lerp:function(t,r,e){return a.lerp(this.array,t.array,r.array,e),this._dirty=!0,this},mul:function(t){return a.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return a.multiply(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return a.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return a.multiply(this.array,t.array,this.array),this._dirty=!0,this},normalize:function(){return a.normalize(this.array,this.array),this._dirty=!0,this},rotateX:function(t){return a.rotateX(this.array,this.array,t),this._dirty=!0,this},rotateY:function(t){return a.rotateY(this.array,this.array,t),this._dirty=!0,this},rotateZ:function(t){return a.rotateZ(this.array,this.array,t),this._dirty=!0,this},rotationTo:function(t,r){return a.rotationTo(this.array,t.array,r.array),this._dirty=!0,this},setAxes:function(t,r,e){return a.setAxes(this.array,t.array,r.array,e.array),this._dirty=!0,this},setAxisAngle:function(t,r){return a.setAxisAngle(this.array,t.array,r),this._dirty=!0,this},slerp:function(t,r,e){return a.slerp(this.array,t.array,r.array,e),this._dirty=!0,this},sqrLen:function(){return a.sqrLen(this.array)},squaredLength:function(){return a.squaredLength(this.array)},fromEuler:function(t,r){return s.fromEuler(this,t,r)},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var o=Object.defineProperty;if(o){var u=s.prototype;o(u,"x",{get:function(){return this.array[0]},set:function(t){this.array[0]=t,this._dirty=!0}}),o(u,"y",{get:function(){return this.array[1]},set:function(t){this.array[1]=t,this._dirty=!0}}),o(u,"z",{get:function(){return this.array[2]},set:function(t){this.array[2]=t,this._dirty=!0}}),o(u,"w",{get:function(){return this.array[3]},set:function(t){this.array[3]=t,this._dirty=!0}})}s.add=function(t,r,e){return a.add(t.array,r.array,e.array),t._dirty=!0,t},s.set=function(t,r,e,i,n){a.set(t.array,r,e,i,n),t._dirty=!0},s.copy=function(t,r){return a.copy(t.array,r.array),t._dirty=!0,t},s.calculateW=function(t,r){return a.calculateW(t.array,r.array),t._dirty=!0,t},s.conjugate=function(t,r){return a.conjugate(t.array,r.array),t._dirty=!0,t},s.identity=function(t){return a.identity(t.array),t._dirty=!0,t},s.invert=function(t,r){return a.invert(t.array,r.array),t._dirty=!0,t},s.dot=function(t,r){return a.dot(t.array,r.array)},s.len=function(t){return a.length(t.array)},s.lerp=function(t,r,e,i){return a.lerp(t.array,r.array,e.array,i),t._dirty=!0,t},s.slerp=function(t,r,e,i){return a.slerp(t.array,r.array,e.array,i),t._dirty=!0,t},s.mul=function(t,r,e){return a.multiply(t.array,r.array,e.array),t._dirty=!0,t},s.multiply=s.mul,s.rotateX=function(t,r,e){return a.rotateX(t.array,r.array,e),t._dirty=!0,t},s.rotateY=function(t,r,e){return a.rotateY(t.array,r.array,e),t._dirty=!0,t},s.rotateZ=function(t,r,e){return a.rotateZ(t.array,r.array,e),t._dirty=!0,t},s.setAxisAngle=function(t,r,e){return a.setAxisAngle(t.array,r.array,e),t._dirty=!0,t},s.normalize=function(t,r){return a.normalize(t.array,r.array),t._dirty=!0,t},s.sqrLen=function(t){return a.sqrLen(t.array)},s.squaredLength=s.sqrLen,s.fromMat3=function(t,r){return a.fromMat3(t.array,r.array),t._dirty=!0,t},s.setAxes=function(t,r,e,i){return a.setAxes(t.array,r.array,e.array,i.array),t._dirty=!0,t},s.rotationTo=function(t,r,e){return a.rotationTo(t.array,r.array,e.array),t._dirty=!0,t},s.fromEuler=function(t,r,e){t._dirty=!0,r=r.array;var i=t.array,n=Math.cos(r[0]/2),a=Math.cos(r[1]/2),s=Math.cos(r[2]/2),o=Math.sin(r[0]/2),u=Math.sin(r[1]/2),h=Math.sin(r[2]/2),e=(e||"XYZ").toUpperCase();switch(e){case"XYZ":i[0]=o*a*s+n*u*h,i[1]=n*u*s-o*a*h,i[2]=n*a*h+o*u*s,i[3]=n*a*s-o*u*h;break;case"YXZ":i[0]=o*a*s+n*u*h,i[1]=n*u*s-o*a*h,i[2]=n*a*h-o*u*s,i[3]=n*a*s+o*u*h;break;case"ZXY":i[0]=o*a*s-n*u*h,i[1]=n*u*s+o*a*h,i[2]=n*a*h+o*u*s,i[3]=n*a*s-o*u*h;break;case"ZYX":i[0]=o*a*s-n*u*h,i[1]=n*u*s+o*a*h,i[2]=n*a*h-o*u*s,i[3]=n*a*s+o*u*h;break;case"YZX":i[0]=o*a*s+n*u*h,i[1]=n*u*s+o*a*h,i[2]=n*a*h-o*u*s,i[3]=n*a*s-o*u*h;break;case"XZY":i[0]=o*a*s-n*u*h,i[1]=n*u*s-o*a*h,i[2]=n*a*h+o*u*s,i[3]=n*a*s+o*u*h}},r.a=s},function(t,r,e){"use strict";var i=(e(3),e(5)),n=e(29),a=e(0),s=e.n(a),o=s.a.vec3,u=o.set,h=o.copy,c=o.transformMat4,f=Math.min,l=Math.max,_=function(){this.planes=[];for(var t=0;t<6;t++)this.planes.push(new n.a);this.boundingBox=new i.a,this.vertices=[];for(var t=0;t<8;t++)this.vertices[t]=o.fromValues(0,0,0)};_.prototype={setFromProjection:function(t){var r=this.planes,e=t.array,i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],c=e[6],f=e[7],l=e[8],_=e[9],d=e[10],m=e[11],p=e[12],y=e[13],v=e[14],E=e[15];u(r[0].normal.array,s-i,f-o,m-l),r[0].distance=-(E-p),r[0].normalize(),u(r[1].normal.array,s+i,f+o,m+l),r[1].distance=-(E+p),r[1].normalize(),u(r[2].normal.array,s+n,f+h,m+_),r[2].distance=-(E+y),r[2].normalize(),u(r[3].normal.array,s-n,f-h,m-_),r[3].distance=-(E-y),r[3].normalize(),u(r[4].normal.array,s-a,f-c,m-d),r[4].distance=-(E-v),r[4].normalize(),u(r[5].normal.array,s+a,f+c,m+d),r[5].distance=-(E+v),r[5].normalize();var T=this.boundingBox,g=this.vertices;if(0===E){var x=h/i,A=-v/(d-1),R=-v/(d+1),b=-R/h,M=-A/h;T.min.set(-b*x,-b,R),T.max.set(b*x,b,A),u(g[0],-b*x,-b,R),u(g[1],-b*x,b,R),u(g[2],b*x,-b,R),u(g[3],b*x,b,R),u(g[4],-M*x,-M,A),u(g[5],-M*x,M,A),u(g[6],M*x,-M,A),u(g[7],M*x,M,A)}else{var I=(-1-p)/i,S=(1-p)/i,N=(1-y)/h,O=(-1-y)/h,w=(-1-v)/d,P=(1-v)/d;T.min.set(Math.min(I,S),Math.min(O,N),Math.min(P,w)),T.max.set(Math.max(S,I),Math.max(N,O),Math.max(w,P));var L=T.min.array,C=T.max.array;u(g[0],L[0],L[1],L[2]),u(g[1],L[0],C[1],L[2]),u(g[2],C[0],L[1],L[2]),u(g[3],C[0],C[1],L[2]),u(g[4],L[0],L[1],C[2]),u(g[5],L[0],C[1],C[2]),u(g[6],C[0],L[1],C[2]),u(g[7],C[0],C[1],C[2])}},getTransformedBoundingBox:function(){var t=o.create();return function(r,e){var i=this.vertices,n=e.array,a=r.min,s=r.max,o=a.array,u=s.array,_=i[0];c(t,_,n),h(o,t),h(u,t);for(var d=1;d<8;d++)_=i[d],c(t,_,n),o[0]=f(t[0],o[0]),o[1]=f(t[1],o[1]),o[2]=f(t[2],o[2]),u[0]=l(t[0],u[0]),u[1]=l(t[1],u[1]),u[2]=l(t[2],u[2]);return a._dirty=!0,s._dirty=!0,r}}()},r.a=_},function(t,r,e){"use strict";var i=e(3),n=e(0),a=e.n(n),s=a.a.vec3,o=a.a.mat4,u=a.a.vec4,h=function(t,r){this.normal=t||new i.a(0,1,0),this.distance=r||0};h.prototype={constructor:h,distanceToPoint:function(t){return s.dot(t.array,this.normal.array)-this.distance},projectPoint:function(t,r){r||(r=new i.a);var e=this.distanceToPoint(t);return s.scaleAndAdd(r.array,t.array,this.normal.array,-e),r._dirty=!0,r},normalize:function(){var t=1/s.len(this.normal.array);s.scale(this.normal.array,t),this.distance*=t},intersectFrustum:function(t){for(var r=t.vertices,e=this.normal.array,i=s.dot(r[0].array,e)>this.distance,n=1;n<8;n++)if(s.dot(r[n].array,e)>this.distance!=i)return!0},intersectLine:function(){var t=s.create();return function(r,e,n){var a=this.distanceToPoint(r),o=this.distanceToPoint(e);if(a>0&&o>0||a<0&&o<0)return null;var u=this.normal.array,h=this.distance,c=r.array;s.sub(t,e.array,r.array),s.normalize(t,t);var f=s.dot(u,t);if(0===f)return null;n||(n=new i.a);var l=(s.dot(u,c)-h)/f;return s.scaleAndAdd(n.array,c,t,-l),n._dirty=!0,n}}(),applyTransform:function(){var t=o.create(),r=u.create(),e=u.create();return e[3]=1,function(i){i=i.array,s.scale(e,this.normal.array,this.distance),u.transformMat4(e,e,i),this.distance=s.dot(e,this.normal.array),o.invert(t,i),o.transpose(t,t),r[3]=0,s.copy(r,this.normal.array),u.transformMat4(r,r,t),s.copy(this.normal.array,r)}}(),copy:function(t){s.copy(this.normal.array,t.normal.array),this.normal._dirty=!0,this.distance=t.distance},clone:function(){var t=new h;return t.copy(this),t}},r.a=h},function(t,r,e){"use strict";var i=e(3),n=e(0),a=e.n(n),s=a.a.vec3,o=function(t,r){this.origin=t||new i.a,this.direction=r||new i.a};o.prototype={constructor:o,intersectPlane:function(t,r){var e=t.normal.array,n=t.distance,a=this.origin.array,o=this.direction.array,u=s.dot(e,o);if(0===u)return null;r||(r=new i.a);var h=(s.dot(e,a)-n)/u;return s.scaleAndAdd(r.array,a,o,-h),r._dirty=!0,r},mirrorAgainstPlane:function(t){var r=s.dot(t.normal.array,this.direction.array);s.scaleAndAdd(this.direction.array,this.direction.array,t.normal.array,2*-r),this.direction._dirty=!0},distanceToPoint:function(){var t=s.create();return function(r){s.sub(t,r,this.origin.array);var e=s.dot(t,this.direction.array);if(e<0)return s.distance(this.origin.array,r);var i=s.lenSquared(t);return Math.sqrt(i-e*e)}}(),intersectSphere:function(){var t=s.create();return function(r,e,n){var a=this.origin.array,o=this.direction.array;r=r.array,s.sub(t,r,a);var u=s.dot(t,o),h=s.squaredLength(t),c=h-u*u,f=e*e;if(!(c>f)){var l=Math.sqrt(f-c),_=u-l,d=u+l;return n||(n=new i.a),_<0?d<0?null:(s.scaleAndAdd(n.array,a,o,d),n):(s.scaleAndAdd(n.array,a,o,_),n)}}}(),intersectBoundingBox:function(t,r){var e,n,a,o,u,h,c=this.direction.array,f=this.origin.array,l=t.min.array,_=t.max.array,d=1/c[0],m=1/c[1],p=1/c[2];if(d>=0?(e=(l[0]-f[0])*d,n=(_[0]-f[0])*d):(n=(l[0]-f[0])*d,e=(_[0]-f[0])*d),m>=0?(a=(l[1]-f[1])*m,o=(_[1]-f[1])*m):(o=(l[1]-f[1])*m,a=(_[1]-f[1])*m),e>o||a>n)return null;if((a>e||e!==e)&&(e=a),(o<n||n!==n)&&(n=o),p>=0?(u=(l[2]-f[2])*p,h=(_[2]-f[2])*p):(h=(l[2]-f[2])*p,u=(_[2]-f[2])*p),e>h||u>n)return null;if((u>e||e!==e)&&(e=u),(h<n||n!==n)&&(n=h),n<0)return null;var y=e>=0?e:n;return r||(r=new i.a),s.scaleAndAdd(r.array,f,c,y),r},intersectTriangle:function(){var t=s.create(),r=s.create(),e=s.create(),n=s.create();return function(a,o,u,h,c,f){var l=this.direction.array,_=this.origin.array;a=a.array,o=o.array,u=u.array,s.sub(t,o,a),s.sub(r,u,a),s.cross(n,r,l);var d=s.dot(t,n);if(h){if(d>-1e-5)return null}else if(d>-1e-5&&d<1e-5)return null;s.sub(e,_,a);var m=s.dot(n,e)/d;if(m<0||m>1)return null;s.cross(n,t,e);var p=s.dot(l,n)/d;if(p<0||p>1||m+p>1)return null;s.cross(n,t,r);var y=-s.dot(e,n)/d;return y<0?null:(c||(c=new i.a),f&&i.a.set(f,1-m-p,m,p),s.scaleAndAdd(c.array,_,l,y),c)}}(),applyTransform:function(t){i.a.add(this.direction,this.direction,this.origin),i.a.transformMat4(this.origin,this.origin,t),i.a.transformMat4(this.direction,this.direction,t),i.a.sub(this.direction,this.direction,this.origin),i.a.normalize(this.direction,this.direction)},copy:function(t){i.a.copy(this.origin,t.origin),i.a.copy(this.direction,t.direction)},clone:function(){var t=new o;return t.copy(this),t}},r.a=o},function(t,r,e){"use strict";function i(t){return t=Math.round(t),t<0?0:t>255?255:t}function n(t){return t=Math.round(t),t<0?0:t>360?360:t}function a(t){return t<0?0:t>1?1:t}function s(t){return i(t.length&&"%"===t.charAt(t.length-1)?parseFloat(t)/100*255:parseInt(t,10))}function o(t){return a(t.length&&"%"===t.charAt(t.length-1)?parseFloat(t)/100:parseFloat(t))}function u(t,r,e){return e<0?e+=1:e>1&&(e-=1),6*e<1?t+(r-t)*e*6:2*e<1?r:3*e<2?t+(r-t)*(2/3-e)*6:t}function h(t,r,e){return t+(r-t)*e}function c(t,r,e,i,n){return t[0]=r,t[1]=e,t[2]=i,t[3]=n,t}function f(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}function l(t,r){E&&f(E,r),E=v.put(t,E||r.slice())}function _(t,r){var e=(parseFloat(t[0])%360+360)%360/360,n=o(t[1]),a=o(t[2]),s=a<=.5?a*(n+1):a+n-a*n,h=2*a-s;return r=r||[],c(r,i(255*u(h,s,e+1/3)),i(255*u(h,s,e)),i(255*u(h,s,e-1/3)),1),4===t.length&&(r[3]=t[3]),r}function d(t){if(t){var r,e,i=t[0]/255,n=t[1]/255,a=t[2]/255,s=Math.min(i,n,a),o=Math.max(i,n,a),u=o-s,h=(o+s)/2;if(0===u)r=0,e=0;else{e=h<.5?u/(o+s):u/(2-o-s);var c=((o-i)/6+u/2)/u,f=((o-n)/6+u/2)/u,l=((o-a)/6+u/2)/u;i===o?r=l-f:n===o?r=1/3+c-l:a===o&&(r=2/3+f-c),r<0&&(r+=1),r>1&&(r-=1)}var _=[360*r,e,h];return null!=t[3]&&_.push(t[3]),_}}var m=e(32),p={},y={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},v=new m.a(20),E=null;p.parse=function(t,r){if(t){r=r||[];var e=v.get(t);if(e)return f(r,e);t+="";var i=t.replace(/ /g,"").toLowerCase();if(i in y)return f(r,y[i]),l(t,r),r;if("#"!==i.charAt(0)){var n=i.indexOf("("),a=i.indexOf(")");if(-1!==n&&a+1===i.length){var u=i.substr(0,n),h=i.substr(n+1,a-(n+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return void c(r,0,0,0,1);d=o(h.pop());case"rgb":return 3!==h.length?void c(r,0,0,0,1):(c(r,s(h[0]),s(h[1]),s(h[2]),d),l(t,r),r);case"hsla":return 4!==h.length?void c(r,0,0,0,1):(h[3]=o(h[3]),_(h,r),l(t,r),r);case"hsl":return 3!==h.length?void c(r,0,0,0,1):(_(h,r),l(t,r),r);default:return}}c(r,0,0,0,1)}else{if(4===i.length){var m=parseInt(i.substr(1),16);return m>=0&&m<=4095?(c(r,(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1),l(t,r),r):void c(r,0,0,0,1)}if(7===i.length){var m=parseInt(i.substr(1),16);return m>=0&&m<=16777215?(c(r,(16711680&m)>>16,(65280&m)>>8,255&m,1),l(t,r),r):void c(r,0,0,0,1)}}}},p.parseToFloat=function(t,r){if(r=p.parse(t,r))return r[0]/=255,r[1]/=255,r[2]/=255,r},p.lift=function(t,r){var e=p.parse(t);if(e){for(var i=0;i<3;i++)e[i]=r<0?e[i]*(1-r)|0:(255-e[i])*r+e[i]|0;return p.stringify(e,4===e.length?"rgba":"rgb")}},p.toHex=function(t){var r=p.parse(t);if(r)return((1<<24)+(r[0]<<16)+(r[1]<<8)+ +r[2]).toString(16).slice(1)},p.fastLerp=function(t,r,e){if(r&&r.length&&t>=0&&t<=1){e=e||[];var n=t*(r.length-1),s=Math.floor(n),o=Math.ceil(n),u=r[s],c=r[o],f=n-s;return e[0]=i(h(u[0],c[0],f)),e[1]=i(h(u[1],c[1],f)),e[2]=i(h(u[2],c[2],f)),e[3]=a(h(u[3],c[3],f)),e}},p.fastMapToColor=p.fastLerp,p.lerp=function(t,r,e){if(r&&r.length&&t>=0&&t<=1){var n=t*(r.length-1),s=Math.floor(n),o=Math.ceil(n),u=p.parse(r[s]),c=p.parse(r[o]),f=n-s,l=p.stringify([i(h(u[0],c[0],f)),i(h(u[1],c[1],f)),i(h(u[2],c[2],f)),a(h(u[3],c[3],f))],"rgba");return e?{color:l,leftIndex:s,rightIndex:o,value:n}:l}},p.mapToColor=p.lerp,p.modifyHSL=function(t,r,e,i){if(t=p.parse(t))return t=d(t),null!=r&&(t[0]=n(r)),null!=e&&(t[1]=o(e)),null!=i&&(t[2]=o(i)),p.stringify(_(t),"rgba")},p.modifyAlpha=function(t,r){if((t=p.parse(t))&&null!=r)return t[3]=a(r),p.stringify(t,"rgba")},p.stringify=function(t,r){if(t&&t.length){var e=t[0]+","+t[1]+","+t[2];return"rgba"!==r&&"hsva"!==r&&"hsla"!==r||(e+=","+t[3]),r+"("+e+")"}},r.a=p},function(t,r,e){"use strict";var i=e(33),n=function(t){this._list=new i.a,this._map={},this._maxSize=t||10};n.prototype.setMaxSize=function(t){this._maxSize=t},n.prototype.put=function(t,r){if(!this._map.hasOwnProperty(t)){var e=this._list.length();if(e>=this._maxSize&&e>0){var i=this._list.head;this._list.remove(i),delete this._map[i.key]}var n=this._list.insert(r);n.key=t,this._map[t]=n}},n.prototype.get=function(t){var r=this._map[t];if(this._map.hasOwnProperty(t))return r!==this._list.tail&&(this._list.remove(r),this._list.insertEntry(r)),r.value},n.prototype.remove=function(t){var r=this._map[t];void 0!==r&&(delete this._map[t],this._list.remove(r))},n.prototype.clear=function(){this._list.clear(),this._map={}},r.a=n},function(t,r,e){"use strict";var i=function(){this.head=null,this.tail=null,this._length=0};i.prototype.insert=function(t){var r=new i.Entry(t);return this.insertEntry(r),r},i.prototype.insertAt=function(t,r){if(!(t<0)){for(var e=this.head,n=0;e&&n!=t;)e=e.next,n++;if(e){var a=new i.Entry(r),s=e.prev;s?(s.next=a,a.prev=s):this.head=a,a.next=e,e.prev=a}else this.insert(r)}},i.prototype.insertBeforeEntry=function(t,r){var e=new i.Entry(t),n=r.prev;n?(n.next=e,e.prev=n):this.head=e,e.next=r,r.prev=e,this._length++},i.prototype.insertEntry=function(t){this.head?(this.tail.next=t,t.prev=this.tail,this.tail=t):this.head=this.tail=t,this._length++},i.prototype.remove=function(t){var r=t.prev,e=t.next;r?r.next=e:this.head=e,e?e.prev=r:this.tail=r,t.next=t.prev=null,this._length--},i.prototype.removeAt=function(t){if(!(t<0)){for(var r=this.head,e=0;r&&e!=t;)r=r.next,e++;return r?(this.remove(r),r.value):void 0}},i.prototype.getHead=function(){if(this.head)return this.head.value},i.prototype.getTail=function(){if(this.tail)return this.tail.value},i.prototype.getAt=function(t){if(!(t<0)){for(var r=this.head,e=0;r&&e!=t;)r=r.next,e++;return r.value}},i.prototype.indexOf=function(t){for(var r=this.head,e=0;r;){if(r.value===t)return e;r=r.next,e++}},i.prototype.length=function(){return this._length},i.prototype.isEmpty=function(){return 0===this._length},i.prototype.forEach=function(t,r){for(var e=this.head,i=0,n=void 0!==r;e;)n?t.call(r,e.value,i):t(e.value,i),e=e.next,i++},i.prototype.clear=function(){this.tail=this.head=null,this._length=0},i.Entry=function(t){this.value=t,this.next=null,this.prev=null},r.a=i},function(t,r,e){"use strict";var i=e(13),n=e(2),a=i.a.extend({material:null,geometry:null,mode:n.a.TRIANGLES,_renderInfo:null},{__program:null,lightGroup:0,renderOrder:0,culling:!0,cullFace:n.a.BACK,frontFace:n.a.CCW,frustumCulling:!0,receiveShadow:!0,castShadow:!0,ignorePicking:!1,ignorePreZ:!1,ignoreGBuffer:!1,isRenderable:function(){return this.geometry&&this.material&&this.material.shader&&!this.invisible&&this.geometry.vertexCount>0},beforeRender:function(t){},afterRender:function(t,r){},getBoundingBox:function(t,r){return r=i.a.prototype.getBoundingBox.call(this,t,r),this.geometry&&this.geometry.boundingBox&&r.union(this.geometry.boundingBox),r},clone:function(){var t=["castShadow","receiveShadow","mode","culling","cullFace","frontFace","frustumCulling","renderOrder","lineWidth","ignorePicking","ignorePreZ","ignoreGBuffer"];return function(){var r=i.a.prototype.clone.call(this);r.geometry=this.geometry,r.material=this.material;for(var e=0;e<t.length;e++){var n=t[e];r[n]!==this[n]&&(r[n]=this[n])}return r}}()});a.POINTS=n.a.POINTS,a.LINES=n.a.LINES,a.LINE_LOOP=n.a.LINE_LOOP,a.LINE_STRIP=n.a.LINE_STRIP,a.TRIANGLES=n.a.TRIANGLES,a.TRIANGLE_STRIP=n.a.TRIANGLE_STRIP,a.TRIANGLE_FAN=n.a.TRIANGLE_FAN,a.BACK=n.a.BACK,a.FRONT=n.a.FRONT,a.FRONT_AND_BACK=n.a.FRONT_AND_BACK,a.CW=n.a.CW,a.CCW=n.a.CCW,r.a=a},function(t,r,e){"use strict";r.a="\n@export clay.compositor.vertex\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\nvarying vec2 v_Texcoord;\nvoid main()\n{\n v_Texcoord = texcoord;\n gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n@end"},function(t,r,e){"use strict";var i=e(17),n=i.a.extend(function(){return{dynamic:!0,attributes:{position:new i.a.Attribute("position","float",3,"POSITION")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0},setLineCount:function(t){var r=this.attributes,e=4*t,i=2*t;this.vertexCount!==e&&r.position.init(e),this.triangleCount!==i&&(this.indices=0===i?null:this.vertexCount>65535?new Uint32Array(3*i):new Uint16Array(3*i))},addLine:function(t){var r=this._vertexOffset,e=this.attributes;e.position.set(r,[t[0],t[1],1]),e.position.set(r+1,[t[0],t[1],-1]),e.position.set(r+2,[t[0],t[1],2]),e.position.set(r+3,[t[0],t[1],-2]),this.setTriangleIndices(this._faceOffset++,[r,r+1,r+2]),this.setTriangleIndices(this._faceOffset++,[r+1,r+2,r+3]),this._vertexOffset+=4}});r.a=n},function(t,r,e){"use strict";var i=e(1),n=e(6),a=(e(38),e(2)),s=e(7),o=a.a.FRAMEBUFFER,u=a.a.RENDERBUFFER,h=a.a.DEPTH_ATTACHMENT,c=a.a.COLOR_ATTACHMENT0,f=i.a.extend({depthBuffer:!0,viewport:null,_width:0,_height:0,_textures:null,_boundRenderer:null},function(){this._cache=new s.a,this._textures={}},{getTextureWidth:function(){return this._width},getTextureHeight:function(){return this._height},bind:function(t){if(t.__currentFrameBuffer){if(t.__currentFrameBuffer===this)return;console.warn("Renderer already bound with another framebuffer. Unbind it first")}t.__currentFrameBuffer=this;var r=t.gl;r.bindFramebuffer(o,this._getFrameBufferGL(t)),this._boundRenderer=t;var e=this._cache;e.put("viewport",t.viewport);var i,n,a=!1;for(var s in this._textures){a=!0;var c=this._textures[s];c&&(i=c.texture.width,n=c.texture.height,this._doAttach(t,c.texture,s,c.target))}this._width=i,this._height=n,!a&&this.depthBuffer&&console.error("Must attach texture before bind, or renderbuffer may have incorrect width and height."),this.viewport?t.setViewport(this.viewport):t.setViewport(0,0,i,n,1);var f=e.get("attached_textures");if(f)for(var s in f)if(!this._textures[s]){var l=f[s];this._doDetach(r,s,l)}if(!e.get("depthtexture_attached")&&this.depthBuffer){e.miss("renderbuffer")&&e.put("renderbuffer",r.createRenderbuffer());var _=e.get("renderbuffer");i===e.get("renderbuffer_width")&&n===e.get("renderbuffer_height")||(r.bindRenderbuffer(u,_),r.renderbufferStorage(u,r.DEPTH_COMPONENT16,i,n),e.put("renderbuffer_width",i),e.put("renderbuffer_height",n),r.bindRenderbuffer(u,null)),e.get("renderbuffer_attached")||(r.framebufferRenderbuffer(o,h,u,_),e.put("renderbuffer_attached",!0))}},unbind:function(t){t.__currentFrameBuffer=null,t.gl.bindFramebuffer(o,null),this._boundRenderer=null,this._cache.use(t.__uid__);var r=this._cache.get("viewport");r&&t.setViewport(r),this.updateMipmap(t)},updateMipmap:function(t){var r=t.gl;for(var e in this._textures){var i=this._textures[e];if(i){var s=i.texture;if(!s.NPOT&&s.useMipmap&&s.minFilter===n.a.LINEAR_MIPMAP_LINEAR){var o="textureCube"===s.textureType?a.a.TEXTURE_CUBE_MAP:a.a.TEXTURE_2D;r.bindTexture(o,s.getWebGLTexture(t)),r.generateMipmap(o),r.bindTexture(o,null)}}}},checkStatus:function(t){return t.checkFramebufferStatus(o)},_getFrameBufferGL:function(t){var r=this._cache;return r.use(t.__uid__),r.miss("framebuffer")&&r.put("framebuffer",t.gl.createFramebuffer()),r.get("framebuffer")},attach:function(t,r,e){if(!t.width)throw new Error("The texture attached to color buffer is not a valid.");r=r||c,e=e||a.a.TEXTURE_2D;var i,n=this._boundRenderer,s=n&&n.gl;if(s){var o=this._cache;o.use(n.__uid__),i=o.get("attached_textures")}var u=this._textures[r];if(!u||u.target!==e||u.texture!==t||!i||null==i[r]){var h=!0;n&&(h=this._doAttach(n,t,r,e),this.viewport||n.setViewport(0,0,t.width,t.height,1)),h&&(this._textures[r]=this._textures[r]||{},this._textures[r].texture=t,this._textures[r].target=e)}},_doAttach:function(t,r,e,i){var n=t.gl,s=r.getWebGLTexture(t),c=this._cache.get("attached_textures");if(c&&c[e]){var f=c[e];if(f.texture===r&&f.target===i)return}e=+e;var l=!0;if(e===h||e===a.a.DEPTH_STENCIL_ATTACHMENT){if(t.getGLExtension("WEBGL_depth_texture")||(console.error("Depth texture is not supported by the browser"),l=!1),r.format!==a.a.DEPTH_COMPONENT&&r.format!==a.a.DEPTH_STENCIL&&(console.error("The texture attached to depth buffer is not a valid."),l=!1),l){var _=this._cache.get("renderbuffer");_&&(n.framebufferRenderbuffer(o,h,u,null),n.deleteRenderbuffer(_),this._cache.put("renderbuffer",!1)),this._cache.put("renderbuffer_attached",!1),this._cache.put("depthtexture_attached",!0)}}return n.framebufferTexture2D(o,e,i,s,0),c||(c={},this._cache.put("attached_textures",c)),c[e]=c[e]||{},c[e].texture=r,c[e].target=i,l},_doDetach:function(t,r,e){t.framebufferTexture2D(o,r,e,null,0);var i=this._cache.get("attached_textures");i&&i[r]&&(i[r]=null),r!==h&&r!==a.a.DEPTH_STENCIL_ATTACHMENT||this._cache.put("depthtexture_attached",!1)},detach:function(t,r){if(this._textures[t]=null,this._boundRenderer){this._cache.use(this._boundRenderer.__uid__),this._doDetach(this._boundRenderer.gl,t,r)}},dispose:function(t){var r=t.gl,e=this._cache;e.use(t.__uid__);var i=e.get("renderbuffer");i&&r.deleteRenderbuffer(i);var n=e.get("framebuffer");n&&r.deleteFramebuffer(n),e.deleteContext(t.__uid__),this._textures={}}});f.DEPTH_ATTACHMENT=h,f.COLOR_ATTACHMENT0=c,f.STENCIL_ATTACHMENT=a.a.STENCIL_ATTACHMENT,f.DEPTH_STENCIL_ATTACHMENT=a.a.DEPTH_STENCIL_ATTACHMENT,r.a=f},function(t,r,e){"use strict";function i(t){return"CANVAS"===t.nodeName||"VIDEO"===t.nodeName||t.complete}var n=e(6),a=e(2),s=e(4),o=e(19),u=o.a.isPowerOfTwo,h=["px","nx","py","ny","pz","nz"],c=n.a.extend(function(){return{image:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},pixels:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},mipmaps:[]}},{textureType:"textureCube",update:function(t){var r=t.gl;r.bindTexture(r.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture")),this.updateCommon(t);var e=this.format,i=this.type;r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,this.getAvailableWrapS()),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,this.getAvailableWrapT()),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,this.getAvailableMagFilter()),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,this.getAvailableMinFilter());var n=t.getGLExtension("EXT_texture_filter_anisotropic");if(n&&this.anisotropic>1&&r.texParameterf(r.TEXTURE_CUBE_MAP,n.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),36193===i){t.getGLExtension("OES_texture_half_float")||(i=a.a.FLOAT)}if(this.mipmaps.length)for(var s=this.width,o=this.height,u=0;u<this.mipmaps.length;u++){var h=this.mipmaps[u];this._updateTextureData(r,h,u,s,o,e,i),s/=2,o/=2}else this._updateTextureData(r,this,0,this.width,this.height,e,i),!this.NPOT&&this.useMipmap&&r.generateMipmap(r.TEXTURE_CUBE_MAP);r.bindTexture(r.TEXTURE_CUBE_MAP,null)},_updateTextureData:function(t,r,e,i,n,a,s){for(var o=0;o<6;o++){var u=h[o],c=r.image&&r.image[u];c?t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+o,e,a,a,s,c):t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+o,e,a,i,n,0,a,s,r.pixels&&r.pixels[u])}},generateMipmap:function(t){var r=t.gl;this.useMipmap&&!this.NPOT&&(r.bindTexture(r.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture")),r.generateMipmap(r.TEXTURE_CUBE_MAP))},bind:function(t){t.gl.bindTexture(t.gl.TEXTURE_CUBE_MAP,this.getWebGLTexture(t))},unbind:function(t){t.gl.bindTexture(t.gl.TEXTURE_CUBE_MAP,null)},isPowerOfTwo:function(){return this.image.px?u(this.image.px.width)&&u(this.image.px.height):u(this.width)&&u(this.height)},isRenderable:function(){return this.image.px?i(this.image.px)&&i(this.image.nx)&&i(this.image.py)&&i(this.image.ny)&&i(this.image.pz)&&i(this.image.nz):!(!this.width||!this.height)},load:function(t,r){var e=0,i=this;return s.a.each(t,function(t,n){var a=new Image;r&&(a.crossOrigin=r),a.onload=function(){e--,0===e&&(i.dirty(),i.trigger("success",i)),a.onload=null},a.onerror=function(){e--,a.onerror=null},e++,a.src=t,i.image[n]=a}),this}});Object.defineProperty(c.prototype,"width",{get:function(){return this.image&&this.image.px?this.image.px.width:this._width},set:function(t){this.image&&this.image.px?console.warn("Texture from image can't set width"):(this._width!==t&&this.dirty(),this._width=t)}}),Object.defineProperty(c.prototype,"height",{get:function(){return this.image&&this.image.px?this.image.px.height:this._height},set:function(t){this.image&&this.image.px?console.warn("Texture from image can't set height"):(this._height!==t&&this.dirty(),this._height=t)}})},function(t,r,e){"use strict";var i=!1;!function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(i=!0)}(navigator.userAgent||navigator.vendor||window.opera),r.a=i},function(t,r){t.exports="@export curl.noise\nuniform float elapsedTime;\nuniform vec2 turbulence = vec2(0.01, 0.02);\nuniform float persistence = 0.707;\nvarying vec2 v_Texcoord;\nvec3 mod289(vec3 x) {\n return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec2 mod289(vec2 x) {\n return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 permute(vec3 x) {\n return mod289(((x*34.0)+1.0)*x);\n}\nfloat snoise(vec2 v)\n{\n const vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439); vec2 i = floor(v + dot(v, C.yy) );\n vec2 x0 = v - i + dot(i, C.xx);\n vec2 i1;\n i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n vec4 x12 = x0.xyxy + C.xxzz;\n x12.xy -= i1;\n i = mod289(i); vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 )) + i.x + vec3(0.0, i1.x, 1.0 ));\n vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n m = m*m ;\n m = m*m ;\n vec3 x = 2.0 * fract(p * C.www) - 1.0;\n vec3 h = abs(x) - 0.5;\n vec3 ox = floor(x + 0.5);\n vec3 a0 = x - ox;\n m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n vec3 g;\n g.x = a0.x * x0.x + h.x * x0.y;\n g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n return 130.0 * dot(m, g);\n}\nfloat fBm_noise(vec2 x){\n float y = snoise(x);\n y += snoise(2.0 * x) * pow(persistence, 2.0);\n y += snoise(4.0 * x) * pow(persistence, 4.0);\n y += snoise(8.0 * x) * pow(persistence, 8.0);\n return y/1.875;\n}\nvoid main()\n{\n vec2 p = (v_Texcoord * 2.0 - 1.0);\n p.x += sin(elapsedTime * turbulence.x);\n p.y += cos(elapsedTime * turbulence.y);\n vec3 f = vec3(0.0);\n f.x = fBm_noise(p) * 0.5 + 0.5;\n gl_FragColor = vec4(f, 1.0);\n}\n@end\n@export curl.updateParticle\nuniform sampler2D posTexture;\nuniform sampler2D spawnTexture;\nuniform sampler2D noiseTexture;\nuniform float noiseTextureSize = 256;\nuniform float deltaTime;\nuniform bool firstFrame;\nuniform float speedScaling = 1.0;\nuniform vec4 region = vec4(0, 0, 1, 1);\nvarying vec2 v_Texcoord;\nvoid main()\n{\n highp vec4 pos = texture2D(posTexture, v_Texcoord);\n if(pos.w > 0.0 && !firstFrame){\n vec2 p = pos.xy;\n float d = 1.0 / noiseTextureSize;\n highp float f = texture2D(noiseTexture, p).x * 2.0 - 1.0;\n highp float fdx = texture2D(noiseTexture, p + vec2(d, 0)).x * 2.0 - 1.0 - f;\n highp float fdy = texture2D(noiseTexture, p + vec2(0, d)).x * 2.0 - 1.0 - f;\n vec2 v = vec2(fdy, -fdx) * 0.01 * speedScaling * noiseTextureSize;\n pos.xy += v * deltaTime;\n pos.w -= deltaTime;\n if (pos.z < 0.5) {\n pos.z = (dot(normalize(v), vec2(0.0, 1.0)) + 1.0) * 0.5;\n pos.z = pos.z * 0.5 + 0.5;\n }\n }\n else {\n pos = texture2D(spawnTexture, v_Texcoord);\n pos.z = 0.1;\n }\n gl_FragColor = pos;\n}\n@end\n@export curl.renderLines.vertex\n#define PI 3.1415926\nattribute vec3 position : POSITION;\nuniform sampler2D posTexture;\nuniform sampler2D prevPosTexture;\nuniform float size = 1.0;\nuniform vec4 vp: VIEWPORT;\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nvarying float v_Mag;\nvoid main()\n{\n vec4 p = texture2D(posTexture, position.xy);\n vec4 p2 = texture2D(prevPosTexture, position.xy);\n p.xy = p.xy * 2.0 - 1.0;\n p2.xy = p2.xy * 2.0 - 1.0;\n if (p.w > 0.0 && p.z >= 0.5) {\n vec2 dir = normalize(p.xy - p2.xy);\n vec2 norm = vec2(dir.y / vp.z, -dir.x / vp.w) * sign(position.z) * size;\n if (abs(position.z) == 2.0) {\n gl_Position = vec4(p.xy + norm, 0.0, 1.0);\n v_Mag = p.z * 2.0 - 1.0;\n }\n else {\n gl_Position = vec4(p2.xy + norm, 0.0, 1.0);\n v_Mag = p2.z * 2.0 - 1.0;\n }\n gl_Position = worldViewProjection * gl_Position;\n }\n else {\n gl_Position = vec4(100000.0, 100000.0, 100000.0, 1.0);\n }\n}\n@end\n@export curl.renderLines.fragment\nuniform vec4 color = vec4(1.0, 1.0, 1.0, 1.0);\nuniform sampler2D gradientTexture;\nuniform float colorOffset = 0;\nvarying float v_Mag;\nvoid main()\n{\n gl_FragColor = color;\n#ifdef GRADIENTTEXTURE_ENABLED\n gl_FragColor *= texture2D(gradientTexture, vec2(fract(colorOffset + v_Mag), 0.5));\n#endif\n}\n@end\n@export curl.downsample\nuniform sampler2D texture;\nuniform vec2 textureSize = vec2(512, 512);\nvarying vec2 v_Texcoord;\nvoid main()\n{\n vec4 d = vec4(-1.0, -1.0, 1.0, 1.0) / textureSize.xyxy;\n vec4 color = texture2D(texture, v_Texcoord + d.xy);\n color += texture2D(texture, v_Texcoord + d.zy);\n color += texture2D(texture, v_Texcoord + d.xw);\n color += texture2D(texture, v_Texcoord + d.zw);\n color *= 0.25;\n gl_FragColor = color;\n}\n@end\n@export curl.output\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform vec4 color = vec4(1, 1, 1, 1);\nvoid main() {\n gl_FragColor = texture2D(texture, v_Texcoord);\n gl_FragColor *= color;\n}\n@end\n"},function(t,r,e){"use strict";function i(t){return t.material}function n(t,r,e){return r.uniforms[e].value}function a(t,r,e,i){return e!==i}function s(){}function o(t,r,e){this.availableAttributes=t,this.availableAttributeSymbols=r,this.indicesBuffer=e,this.vao=null}function u(t){var r=t.createCanvas();r.width=r.height=1;var e;r.getContext("2d");this.bind=function(t){var i=t.gl,n=!e;n&&(e=i.createTexture()),i.bindTexture(i.TEXTURE_2D,e),n&&i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,r)},this.unbind=function(t){t.gl.bindTexture(t.gl.TEXTURE_2D,null)},this.isRenderable=function(){return!0}}var h=e(1),c=e(42),f=e(2),l=e(10),_=e(43),d=e(44),m=e(9),p=e(46),y=e(0),v=e.n(y);m.a.import(p.a);var E=v.a.mat4,T=v.a.vec3,g=E.create,x={},A={float:f.a.FLOAT,byte:f.a.BYTE,ubyte:f.a.UNSIGNED_BYTE,short:f.a.SHORT,ushort:f.a.UNSIGNED_SHORT},R=h.a.extend(function(){return{canvas:null,_width:100,_height:100,devicePixelRatio:window&&window.devicePixelRatio||1,clearColor:[0,0,0,0],clearBit:17664,alpha:!0,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,throwError:!0,gl:null,viewport:{},createCanvas:function(){return document.createElement("canvas")},__currentFrameBuffer:null,_viewportStack:[],_clearStack:[],_sceneRendering:null}},function(){this.canvas||(this.canvas=this.createCanvas());var t=this.canvas;try{var r={alpha:this.alpha,depth:this.depth,stencil:this.stencil,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer};if(this.gl=t.getContext("webgl",r)||t.getContext("experimental-webgl",r),!this.gl)throw new Error;this._glinfo=new c.a(this.gl),this.gl.targetRenderer&&console.error("Already created a renderer"),this.gl.targetRenderer=this,this.resize()}catch(t){throw"Error creating WebGL Context "+t}this._programMgr=new d.a(this),this._placeholderTexture=new u(this)},{resize:function(t,r){var e=this.canvas,i=this.devicePixelRatio;null!=t?(e.style.width=t+"px",e.style.height=r+"px",e.width=t*i,e.height=r*i,this._width=t,this._height=r):(this._width=e.width/i,this._height=e.height/i),this.setViewport(0,0,this._width,this._height)},getWidth:function(){return this._width},getHeight:function(){return this._height},getViewportAspect:function(){var t=this.viewport;return t.width/t.height},setDevicePixelRatio:function(t){this.devicePixelRatio=t,this.resize(this._width,this._height)},getDevicePixelRatio:function(){return this.devicePixelRatio},getGLExtension:function(t){return this._glinfo.getExtension(t)},getGLParameter:function(t){return this._glinfo.getParameter(t)},setViewport:function(t,r,e,i,n){if("object"==typeof t){var a=t;t=a.x,r=a.y,e=a.width,i=a.height,n=a.devicePixelRatio}n=n||this.devicePixelRatio,this.gl.viewport(t*n,r*n,e*n,i*n),this.viewport={x:t,y:r,width:e,height:i,devicePixelRatio:n}},saveViewport:function(){this._viewportStack.push(this.viewport)},restoreViewport:function(){this._viewportStack.length>0&&this.setViewport(this._viewportStack.pop())},saveClear:function(){this._clearStack.push({clearBit:this.clearBit,clearColor:this.clearColor})},restoreClear:function(){if(this._clearStack.length>0){var t=this._clearStack.pop();this.clearColor=t.clearColor,this.clearBit=t.clearBit}},bindSceneRendering:function(t){this._sceneRendering=t},render:function(t,r,e,i){var n=this.gl,a=this.clearColor;if(this.clearBit){n.colorMask(!0,!0,!0,!0),n.depthMask(!0);var s=this.viewport,o=!1,u=s.devicePixelRatio;(s.width!==this._width||s.height!==this._height||u&&u!==this.devicePixelRatio||s.x||s.y)&&(o=!0,n.enable(n.SCISSOR_TEST),n.scissor(s.x*u,s.y*u,s.width*u,s.height*u)),n.clearColor(a[0],a[1],a[2],a[3]),n.clear(this.clearBit),o&&n.disable(n.SCISSOR_TEST)}if(e||t.update(!1),t.updateLights(),!(r=r||t.getMainCamera()))return void console.error("Can't find camera in the scene.");r.update();var h=t.updateRenderList(r,!0);this._sceneRendering=t;var c=h.opaque,f=h.transparent,l=t.material;t.trigger("beforerender",this,t,r,h),i?(this.renderPreZ(c,t,r),n.depthFunc(n.LEQUAL)):n.depthFunc(n.LESS);for(var _=g(),d=T.create(),m=0;m<f.length;m++){var p=f[m];E.multiplyAffine(_,r.viewMatrix.array,p.worldTransform.array),T.transformMat4(d,p.position.array,_),p.__depth=d[2]}this.renderPass(c,r,{getMaterial:function(t){return l||t.material},sortCompare:this.opaqueSortCompare}),this.renderPass(f,r,{getMaterial:function(t){return l||t.material},sortCompare:this.transparentSortCompare}),t.trigger("afterrender",this,t,r,h),this._sceneRendering=null},getProgram:function(t,r,e){return r=r||t.material,this._programMgr.getProgram(t,r,e)},validateProgram:function(t){if(t.__error){var r=t.__error;if(x[t.__uid__])return;if(x[t.__uid__]=!0,this.throwError)throw new Error(r);this.trigger("error",r)}},updatePrograms:function(t,r,e){var n=e&&e.getMaterial||i;r=r||null;for(var a=0;a<t.length;a++){var s=t[a],o=n.call(this,s);if(a>0){var u=t[a-1],h=u.joints?u.joints.length:0;if((s.joints?s.joints.length:0)===h&&s.material===u.material&&s.lightGroup===u.lightGroup){s.__program=u.__program;continue}}var c=this._programMgr.getProgram(s,o,r);this.validateProgram(c),s.__program=c}},renderPass:function(t,r,e){this.trigger("beforerenderpass",this,t,r,e),e=e||{},e.getMaterial=e.getMaterial||i,e.getUniform=e.getUniform||n,e.isMaterialChanged=e.isMaterialChanged||a,e.beforeRender=e.beforeRender||s,e.afterRender=e.afterRender||s,this.updatePrograms(t,this._sceneRendering,e),e.sortCompare&&t.sort(e.sortCompare);var o=this.viewport,u=o.devicePixelRatio,h=[o.x*u,o.y*u,o.width*u,o.height*u],c=this.devicePixelRatio,f=this.__currentFrameBuffer?[this.__currentFrameBuffer.getTextureWidth(),this.__currentFrameBuffer.getTextureHeight()]:[this._width*c,this._height*c],l=[h[2],h[3]],_=Date.now();r?(E.copy(b.VIEW,r.viewMatrix.array),E.copy(b.PROJECTION,r.projectionMatrix.array),E.copy(b.VIEWINVERSE,r.worldTransform.array)):(E.identity(b.VIEW),E.identity(b.PROJECTION),E.identity(b.VIEWINVERSE)),E.multiply(b.VIEWPROJECTION,b.PROJECTION,b.VIEW),E.invert(b.PROJECTIONINVERSE,b.PROJECTION),E.invert(b.VIEWPROJECTIONINVERSE,b.VIEWPROJECTION);for(var d,m,p,y,v,T,g,x,A,R,M,I,S=this.gl,N=this._sceneRendering,O=this.getGLExtension("OES_vertex_array_object"),w=0;w<t.length;w++){var P,L=t[w],C=null!=L.worldTransform;if(!e.ifRender||e.ifRender(L)){C&&(P=L.isSkinnedMesh&&L.isSkinnedMesh()?b.IDENTITY:L.worldTransform.array);var D=L.geometry,U=e.getMaterial.call(this,L),F=L.__program,B=U.shader,V=D.__uid__+"-"+F.__uid__,X=V!==R;R=V,X&&O&&O.bindVertexArrayOES(null),C&&(E.copy(b.WORLD,P),E.multiply(b.WORLDVIEWPROJECTION,b.VIEWPROJECTION,P),E.multiplyAffine(b.WORLDVIEW,b.VIEW,P),(B.matrixSemantics.WORLDINVERSE||B.matrixSemantics.WORLDINVERSETRANSPOSE)&&E.invert(b.WORLDINVERSE,P),(B.matrixSemantics.WORLDVIEWINVERSE||B.matrixSemantics.WORLDVIEWINVERSETRANSPOSE)&&E.invert(b.WORLDVIEWINVERSE,b.WORLDVIEW),(B.matrixSemantics.WORLDVIEWPROJECTIONINVERSE||B.matrixSemantics.WORLDVIEWPROJECTIONINVERSETRANSPOSE)&&E.invert(b.WORLDVIEWPROJECTIONINVERSE,b.WORLDVIEWPROJECTION)),L.beforeRender&&L.beforeRender(this),e.beforeRender.call(this,L,U,d);var k=F!==m;k?(F.bind(this),F.setUniformOfSemantic(S,"VIEWPORT",h),F.setUniformOfSemantic(S,"WINDOW_SIZE",f),r&&(F.setUniformOfSemantic(S,"NEAR",r.near),F.setUniformOfSemantic(S,"FAR",r.far)),F.setUniformOfSemantic(S,"DEVICEPIXELRATIO",u),F.setUniformOfSemantic(S,"TIME",_),F.setUniformOfSemantic(S,"VIEWPORT_SIZE",l),N&&N.setLightUniforms(F,L.lightGroup,this)):F=m,(k||e.isMaterialChanged(L,p,U,d))&&(U.depthTest!==y&&(U.depthTest?S.enable(S.DEPTH_TEST):S.disable(S.DEPTH_TEST),y=U.depthTest),U.depthMask!==v&&(S.depthMask(U.depthMask),v=U.depthMask),U.transparent!==A&&(U.transparent?S.enable(S.BLEND):S.disable(S.BLEND),A=U.transparent),U.transparent&&(U.blend?U.blend(S):(S.blendEquationSeparate(S.FUNC_ADD,S.FUNC_ADD),S.blendFuncSeparate(S.SRC_ALPHA,S.ONE_MINUS_SRC_ALPHA,S.ONE,S.ONE_MINUS_SRC_ALPHA))),I=this._bindMaterial(L,U,F,p||null,d||null,m||null,e.getUniform),d=U);var W=B.matrixSemanticKeys;if(C)for(var G=0;G<W.length;G++){var z=W[G],q=B.matrixSemantics[z],H=b[z];if(q.isTranspose){var j=b[q.semanticNoTranspose];E.transpose(H,j)}F.setUniform(S,q.type,q.symbol,H)}L.cullFace!==g&&(g=L.cullFace,S.cullFace(g)),L.frontFace!==x&&(x=L.frontFace,S.frontFace(x)),L.culling!==T&&(T=L.culling,T?S.enable(S.CULL_FACE):S.disable(S.CULL_FACE)),this._updateSkeleton(L,F,I),X&&(M=this._bindVAO(O,B,D,F)),this._renderObject(L,M),e.afterRender(this,L),L.afterRender&&L.afterRender(this),m=F,p=L}}O&&O.bindVertexArrayOES(null),this.trigger("afterrenderpass",this,t,r,e)},getMaxJointNumber:function(){return this._glinfo.getMaxJointNumber()},_updateSkeleton:function(t,r,e){var i=this.gl,n=t.skeleton;if(n)if(n.update(),t.joints.length>this._glinfo.getMaxJointNumber()){var a=n.getSubSkinMatricesTexture(t.__uid__,t.joints);r.useTextureSlot(this,a,e),r.setUniform(i,"1i","skinMatricesTexture",e),r.setUniform(i,"1f","skinMatricesTextureSize",a.width)}else{var s=n.getSubSkinMatrices(t.__uid__,t.joints);r.setUniformOfSemantic(i,"SKIN_MATRIX",s)}},_renderObject:function(t,r){var e=this.gl,i=t.geometry,n=t.mode;if(null==n&&(n=4),r.indicesBuffer){var a=this.getGLExtension("OES_element_index_uint"),s=a&&i.indices instanceof Uint32Array,o=s?e.UNSIGNED_INT:e.UNSIGNED_SHORT;e.drawElements(n,r.indicesBuffer.count,o,0)}else e.drawArrays(n,0,i.vertexCount)},_bindMaterial:function(t,r,e,i,n,a,s){for(var o=this.gl,u=a===e,h=e.currentTextureSlot(),c=r.getEnabledUniforms(),f=r.getTextureUniforms(),l=this._placeholderTexture,_=0;_<f.length;_++){var d=f[_],m=s(t,r,d),p=r.uniforms[d].type;if("t"===p&&m)m.__slot=-1;else if("tv"===p)for(var y=0;y<m.length;y++)m[y]&&(m[y].__slot=-1)}l.__slot=-1;for(var _=0;_<c.length;_++){var d=c[_],v=r.uniforms[d],m=s(t,r,d),p=v.type;if("t"===p&&(m&&m.isRenderable()||(m=l)),n&&u){var E=s(i,n,d);if("t"===p&&(E&&E.isRenderable()||(E=l)),E===m){if("t"===v.type)e.takeCurrentTextureSlot(this,null);else if("tv"===p&&m)for(var y=0;y<m.length;y++)e.takeCurrentTextureSlot(this,null);continue}}if(null!=m)if("t"===p)if(m.__slot<0){var T=e.currentTextureSlot(),g=e.setUniform(o,"1i",d,T);g&&(e.takeCurrentTextureSlot(this,m),m.__slot=T)}else e.setUniform(o,"1i",d,m.__slot);else if(Array.isArray(m)){if(0===m.length)continue;if("tv"===p){if(!e.hasUniform(d))continue;for(var x=[],y=0;y<m.length;y++){var A=m[y];if(A.__slot<0){var T=e.currentTextureSlot();x.push(T),e.takeCurrentTextureSlot(this,A),A.__slot=T}else x.push(A.__slot)}e.setUniform(o,"1iv",d,x)}else e.setUniform(o,v.type,d,m)}else e.setUniform(o,v.type,d,m)}var R=e.currentTextureSlot();return e.resetTextureSlot(h),R},_bindVAO:function(t,r,e,i){var n=!e.dynamic,a=this.gl,s=this.__uid__+"-"+i.__uid__,u=e.__vaoCache[s];if(!u){var h=e.getBufferChunks(this);if(!h||!h.length)return;for(var c=h[0],f=c.attributeBuffers,l=c.indicesBuffer,_=[],d=[],m=0;m<f.length;m++){var p,y=f[m],v=y.name,E=y.semantic;if(E){var T=r.attributeSemantics[E];p=T&&T.symbol}else p=v;p&&i.attributes[p]&&(_.push(y),d.push(p))}u=new o(_,d,l),n&&(e.__vaoCache[s]=u)}var g=!0;t&&n&&(null==u.vao?u.vao=t.createVertexArrayOES():g=!1,t.bindVertexArrayOES(u.vao));var _=u.availableAttributes,l=u.indicesBuffer;if(g){for(var x=i.enableAttributes(this,u.availableAttributeSymbols,t&&n&&u),m=0;m<_.length;m++){var R=x[m];if(-1!==R){var y=_[m],b=y.buffer,M=y.size,I=A[y.type]||a.FLOAT;a.bindBuffer(a.ARRAY_BUFFER,b),a.vertexAttribPointer(R,M,I,!1,0,0)}}e.isUseIndices()&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,l.buffer)}return u},renderPreZ:function(t,r,e){var i=this.gl,n=this._prezMaterial||new l.a({shader:new m.a(m.a.source("clay.prez.vertex"),m.a.source("clay.prez.fragment"))});this._prezMaterial=n,i.colorMask(!1,!1,!1,!1),i.depthMask(!0),this.renderPass(t,e,{ifRender:function(t){return!t.ignorePreZ},isMaterialChanged:function(t,r){var e=t.material,i=r.material;return e.get("diffuseMap")!==i.get("diffuseMap")||(e.get("alphaCutoff")||0)!==(i.get("alphaCutoff")||0)},getUniform:function(t,r,e){if("alphaMap"===e)return t.material.get("diffuseMap");if("alphaCutoff"===e){if(t.material.isDefined("fragment","ALPHA_TEST")&&t.material.get("diffuseMap")){return t.material.get("alphaCutoff")||0}return 0}return r.get(e)},getMaterial:function(){return n},sort:this.opaqueSortCompare}),i.colorMask(!0,!0,!0,!0),i.depthMask(!0)},disposeScene:function(t){this.disposeNode(t,!0,!0),t.dispose()},disposeNode:function(t,r,e){t.getParent()&&t.getParent().remove(t);var i={};t.traverse(function(t){var n=t.material;if(t.geometry&&r&&t.geometry.dispose(this),e&&n&&!i[n.__uid__]){for(var a=n.getTextureUniforms(),s=0;s<a.length;s++){var o=a[s],u=n.uniforms[o].value,h=n.uniforms[o].type;if(u)if("t"===h)u.dispose&&u.dispose(this);else if("tv"===h)for(var c=0;c<u.length;c++)u[c]&&u[c].dispose&&u[c].dispose(this)}i[n.__uid__]=!0}t.dispose&&t.dispose(this)},this)},disposeGeometry:function(t){t.dispose(this)},disposeTexture:function(t){t.dispose(this)},disposeFrameBuffer:function(t){t.dispose(this)},dispose:function(){},screenToNDC:function(t,r,e){e||(e=new _.a),r=this._height-r;var i=this.viewport,n=e.array;return n[0]=(t-i.x)/i.width,n[0]=2*n[0]-1,n[1]=(r-i.y)/i.height,n[1]=2*n[1]-1,e}});R.opaqueSortCompare=R.prototype.opaqueSortCompare=function(t,r){return t.renderOrder===r.renderOrder?t.__program===r.__program?t.material===r.material?t.geometry.__uid__-r.geometry.__uid__:t.material.__uid__-r.material.__uid__:t.__program&&r.__program?t.__program.__uid__-r.__program.__uid__:0:t.renderOrder-r.renderOrder},R.transparentSortCompare=R.prototype.transparentSortCompare=function(t,r){return t.renderOrder===r.renderOrder?t.__depth===r.__depth?t.__program===r.__program?t.material===r.material?t.geometry.__uid__-r.geometry.__uid__:t.material.__uid__-r.material.__uid__:t.__program&&r.__program?t.__program.__uid__-r.__program.__uid__:0:t.__depth-r.__depth:t.renderOrder-r.renderOrder};var b={IDENTITY:g(),WORLD:g(),VIEW:g(),PROJECTION:g(),WORLDVIEW:g(),VIEWPROJECTION:g(),WORLDVIEWPROJECTION:g(),WORLDINVERSE:g(),VIEWINVERSE:g(),PROJECTIONINVERSE:g(),WORLDVIEWINVERSE:g(),VIEWPROJECTIONINVERSE:g(),WORLDVIEWPROJECTIONINVERSE:g(),WORLDTRANSPOSE:g(),VIEWTRANSPOSE:g(),PROJECTIONTRANSPOSE:g(),WORLDVIEWTRANSPOSE:g(),VIEWPROJECTIONTRANSPOSE:g(),WORLDVIEWPROJECTIONTRANSPOSE:g(),WORLDINVERSETRANSPOSE:g(),VIEWINVERSETRANSPOSE:g(),PROJECTIONINVERSETRANSPOSE:g(),WORLDVIEWINVERSETRANSPOSE:g(),VIEWPROJECTIONINVERSETRANSPOSE:g(),WORLDVIEWPROJECTIONINVERSETRANSPOSE:g()};R.COLOR_BUFFER_BIT=f.a.COLOR_BUFFER_BIT,R.DEPTH_BUFFER_BIT=f.a.DEPTH_BUFFER_BIT,R.STENCIL_BUFFER_BIT=f.a.STENCIL_BUFFER_BIT,r.a=R},function(t,r,e){"use strict";function i(t){function r(r){var i=t.getExtension(r);i||(i=t.getExtension("MOZ_"+r)),i||(i=t.getExtension("WEBKIT_"+r)),e[r]=i}for(var e={},i={},s=0;s<n.length;s++){r(n[s])}for(var s=0;s<a.length;s++){var o=a[s];i[o]=t.getParameter(t[o])}this.getExtension=function(t){return t in e||r(t),e[t]},this.getParameter=function(t){return i[t]},this.getMaxJointNumber=function(){return 15}}var n=["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","OES_standard_derivatives","OES_vertex_array_object","OES_element_index_uint","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","EXT_texture_filter_anisotropic","EXT_shader_texture_lod","WEBGL_draw_buffers","EXT_frag_depth","EXT_sRGB"],a=["MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE"];r.a=i},function(t,r,e){"use strict";var i=e(0),n=e.n(i),a=n.a.vec2,s=function(t,r){t=t||0,r=r||0,this.array=a.fromValues(t,r),this._dirty=!0};if(s.prototype={constructor:s,add:function(t){return a.add(this.array,this.array,t.array),this._dirty=!0,this},set:function(t,r){return this.array[0]=t,this.array[1]=r,this._dirty=!0,this},setArray:function(t){return this.array[0]=t[0],this.array[1]=t[1],this._dirty=!0,this},clone:function(){return new s(this.x,this.y)},copy:function(t){return a.copy(this.array,t.array),this._dirty=!0,this},cross:function(t,r){return a.cross(t.array,this.array,r.array),t._dirty=!0,this},dist:function(t){return a.dist(this.array,t.array)},distance:function(t){return a.distance(this.array,t.array)},div:function(t){return a.div(this.array,this.array,t.array),this._dirty=!0,this},divide:function(t){return a.divide(this.array,this.array,t.array),this._dirty=!0,this},dot:function(t){return a.dot(this.array,t.array)},len:function(){return a.len(this.array)},length:function(){return a.length(this.array)},lerp:function(t,r,e){return a.lerp(this.array,t.array,r.array,e),this._dirty=!0,this},min:function(t){return a.min(this.array,this.array,t.array),this._dirty=!0,this},max:function(t){return a.max(this.array,this.array,t.array),this._dirty=!0,this},mul:function(t){return a.mul(this.array,this.array,t.array),this._dirty=!0,this},multiply:function(t){return a.multiply(this.array,this.array,t.array),this._dirty=!0,this},negate:function(){return a.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return a.normalize(this.array,this.array),this._dirty=!0,this},random:function(t){return a.random(this.array,t),this._dirty=!0,this},scale:function(t){return a.scale(this.array,this.array,t),this._dirty=!0,this},scaleAndAdd:function(t,r){return a.scaleAndAdd(this.array,this.array,t.array,r),this._dirty=!0,this},sqrDist:function(t){return a.sqrDist(this.array,t.array)},squaredDistance:function(t){return a.squaredDistance(this.array,t.array)},sqrLen:function(){return a.sqrLen(this.array)},squaredLength:function(){return a.squaredLength(this.array)},sub:function(t){return a.sub(this.array,this.array,t.array),this._dirty=!0,this},subtract:function(t){return a.subtract(this.array,this.array,t.array),this._dirty=!0,this},transformMat2:function(t){return a.transformMat2(this.array,this.array,t.array),this._dirty=!0,this},transformMat2d:function(t){return a.transformMat2d(this.array,this.array,t.array),this._dirty=!0,this},transformMat3:function(t){return a.transformMat3(this.array,this.array,t.array),this._dirty=!0,this},transformMat4:function(t){return a.transformMat4(this.array,this.array,t.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}},Object.defineProperty){var o=s.prototype;Object.defineProperty(o,"x",{get:function(){return this.array[0]},set:function(t){this.array[0]=t,this._dirty=!0}}),Object.defineProperty(o,"y",{get:function(){return this.array[1]},set:function(t){this.array[1]=t,this._dirty=!0}})}s.add=function(t,r,e){return a.add(t.array,r.array,e.array),t._dirty=!0,t},s.set=function(t,r,e){return a.set(t.array,r,e),t._dirty=!0,t},s.copy=function(t,r){return a.copy(t.array,r.array),t._dirty=!0,t},s.cross=function(t,r,e){return a.cross(t.array,r.array,e.array),t._dirty=!0,t},s.dist=function(t,r){return a.distance(t.array,r.array)},s.distance=s.dist,s.div=function(t,r,e){return a.divide(t.array,r.array,e.array),t._dirty=!0,t},s.divide=s.div,s.dot=function(t,r){return a.dot(t.array,r.array)},s.len=function(t){return a.length(t.array)},s.lerp=function(t,r,e,i){return a.lerp(t.array,r.array,e.array,i),t._dirty=!0,t},s.min=function(t,r,e){return a.min(t.array,r.array,e.array),t._dirty=!0,t},s.max=function(t,r,e){return a.max(t.array,r.array,e.array),t._dirty=!0,t},s.mul=function(t,r,e){return a.multiply(t.array,r.array,e.array),t._dirty=!0,t},s.multiply=s.mul,s.negate=function(t,r){return a.negate(t.array,r.array),t._dirty=!0,t},s.normalize=function(t,r){return a.normalize(t.array,r.array),t._dirty=!0,t},s.random=function(t,r){return a.random(t.array,r),t._dirty=!0,t},s.scale=function(t,r,e){return a.scale(t.array,r.array,e),t._dirty=!0,t},s.scaleAndAdd=function(t,r,e,i){return a.scaleAndAdd(t.array,r.array,e.array,i),t._dirty=!0,t},s.sqrDist=function(t,r){return a.sqrDist(t.array,r.array)},s.squaredDistance=s.sqrDist,s.sqrLen=function(t){return a.sqrLen(t.array)},s.squaredLength=s.sqrLen,s.sub=function(t,r,e){return a.subtract(t.array,r.array,e.array),t._dirty=!0,t},s.subtract=s.sub,s.transformMat2=function(t,r,e){return a.transformMat2(t.array,r.array,e.array),t._dirty=!0,t},s.transformMat2d=function(t,r,e){return a.transformMat2d(t.array,r.array,e.array),t._dirty=!0,t},s.transformMat3=function(t,r,e){return a.transformMat3(t.array,r.array,e.array),t._dirty=!0,t},s.transformMat4=function(t,r,e){return a.transformMat4(t.array,r.array,e.array),t._dirty=!0,t},r.a=s},function(t,r,e){"use strict";function i(t,r,e){function i(t,e,i,a){var s="";isNaN(e)&&(e=e in r?r[e]:n[e]),isNaN(i)&&(i=i in r?r[i]:n[i]);for(var o=parseInt(e);o<parseInt(i);o++)s+="{"+a.replace(/float\s*\(\s*_idx_\s*\)/g,o.toFixed(1)).replace(/_idx_/g,o)+"}";return s}var n={};for(var a in e)n[a+"_COUNT"]=e[a];return t.replace(h,i)}function n(t,r,e){var i=[];if(r)for(var n in r){var a=r[n];a>0&&i.push("#define "+n.toUpperCase()+"_COUNT "+a)}if(e)for(var s=0;s<e.length;s++){var o=e[s];i.push("#define "+o.toUpperCase()+"_ENABLED")}for(var o in t){var u=t[o];null===u?i.push("#define "+o):i.push("#define "+o+" "+u.toString())}return i.join("\n")}function a(t){for(var r=[],e=0;e<t.length;e++)r.push("#extension GL_"+t[e]+" : enable");return r.join("\n")}function s(t){return["precision",t,"float"].join(" ")+";\n"+["precision",t,"int"].join(" ")+";\n"+["precision",t,"sampler2D"].join(" ")+";\n"}function o(t){this._renderer=t,this._cache={}}var u=e(45),h=/for\s*?\(int\s*?_idx_\s*\=\s*([\w-]+)\;\s*_idx_\s*<\s*([\w-]+);\s*_idx_\s*\+\+\s*\)\s*\{\{([\s\S]+?)(?=\}\})\}\}/g;o.prototype.getProgram=function(t,r,e){var o=this._cache,h=t.isSkinnedMesh&&t.isSkinnedMesh(),c="s"+r.shader.shaderID+"m"+r.getProgramKey();e&&(c+="se"+e.getProgramKey(t.lightGroup)),h&&(c+=","+t.joints.length);var f=o[c];if(f)return f;var l=e?e.getLightsNumbers(t.lightGroup):{},_=this._renderer,d=_.gl,m=r.getEnabledTextures(),p="";if(h){var y={SKINNING:null,JOINT_COUNT:t.joints.length};t.joints.length>_.getMaxJointNumber()&&(y.USE_SKIN_MATRICES_TEXTURE=null),p="\n"+n(y)+"\n"}var v=p+n(r.vertexDefines,l,m),E=p+n(r.fragmentDefines,l,m),T=v+"\n"+r.shader.vertex,g=["OES_standard_derivatives","EXT_shader_texture_lod"].filter(function(t){return null!=_.getGLExtension(t)});g.indexOf("EXT_shader_texture_lod")>=0&&(E+="\n#define SUPPORT_TEXTURE_LOD");var x=a(g)+"\n"+s(r.precision)+"\n"+E+"\n"+r.shader.fragment,A=i(T,r.vertexDefines,l),R=i(x,r.fragmentDefines,l),f=new u.a;f.uniformSemantics=r.shader.uniformSemantics,f.attributes=r.shader.attributes;var b=f.buildProgram(d,r.shader,A,R);return f.__error=b,o[c]=f,f},r.a=o},function(t,r,e){"use strict";function i(t){for(var r=t.split("\n"),e=0,i=r.length;e<i;e++)r[e]=e+1+": "+r[e];return r.join("\n")}function n(t,r,e){if(!t.getShaderParameter(r,t.COMPILE_STATUS))return[t.getShaderInfoLog(r),i(e)].join("\n")}var a=e(8),s=e(1),o={},u=new a.a.Float32Array(16),h=s.a.extend({uniformSemantics:{},attributes:{}},function(){this._locations={},this._textureSlot=0,this._program=null},{bind:function(t){this._textureSlot=0,t.gl.useProgram(this._program)},hasUniform:function(t){var r=this._locations[t];return null!==r&&void 0!==r},useTextureSlot:function(t,r,e){r&&(t.gl.activeTexture(t.gl.TEXTURE0+e),r.isRenderable()?r.bind(t):r.unbind(t))},currentTextureSlot:function(){return this._textureSlot},resetTextureSlot:function(t){this._textureSlot=t||0},takeCurrentTextureSlot:function(t,r){var e=this._textureSlot;return this.useTextureSlot(t,r,e),this._textureSlot++,e},setUniform:function(t,r,e,i){var n=this._locations,s=n[e];if(null===s||void 0===s)return!1;switch(r){case"m4":if(!(i instanceof Float32Array)){for(var o=0;o<i.length;o++)u[o]=i[o];i=u}t.uniformMatrix4fv(s,!1,i);break;case"2i":t.uniform2i(s,i[0],i[1]);break;case"2f":t.uniform2f(s,i[0],i[1]);break;case"3i":t.uniform3i(s,i[0],i[1],i[2]);break;case"3f":t.uniform3f(s,i[0],i[1],i[2]);break;case"4i":t.uniform4i(s,i[0],i[1],i[2],i[3]);break;case"4f":t.uniform4f(s,i[0],i[1],i[2],i[3]);break;case"1i":t.uniform1i(s,i);break;case"1f":t.uniform1f(s,i);break;case"1fv":t.uniform1fv(s,i);break;case"1iv":t.uniform1iv(s,i);break;case"2iv":t.uniform2iv(s,i);break;case"2fv":t.uniform2fv(s,i);break;case"3iv":t.uniform3iv(s,i);break;case"3fv":t.uniform3fv(s,i);break;case"4iv":t.uniform4iv(s,i);break;case"4fv":t.uniform4fv(s,i);break;case"m2":case"m2v":t.uniformMatrix2fv(s,!1,i);break;case"m3":case"m3v":t.uniformMatrix3fv(s,!1,i);break;case"m4v":if(Array.isArray(i)&&Array.isArray(i[0])){for(var h=new a.a.Float32Array(16*i.length),c=0,o=0;o<i.length;o++)for(var f=i[o],l=0;l<16;l++)h[c++]=f[l];t.uniformMatrix4fv(s,!1,h)}else t.uniformMatrix4fv(s,!1,i)}return!0},setUniformOfSemantic:function(t,r,e){var i=this.uniformSemantics[r];return!!i&&this.setUniform(t,i.type,i.symbol,e)},enableAttributes:function(t,r,e){var i,n=t.gl,a=this._program,s=this._locations;(i=e?e.__enabledAttributeList:o[t.__uid__])||(i=e?e.__enabledAttributeList=[]:o[t.__uid__]=[]);for(var u=[],h=0;h<r.length;h++){var c=r[h];if(this.attributes[c]){var f=s[c];if(null==f){if(-1===(f=n.getAttribLocation(a,c))){u[h]=-1;continue}s[c]=f}u[h]=f,i[f]?i[f]=2:i[f]=1}else u[h]=-1}for(var h=0;h<i.length;h++)switch(i[h]){case 1:n.enableVertexAttribArray(h),i[h]=3;break;case 2:i[h]=3;break;case 3:n.disableVertexAttribArray(h),i[h]=0}return u},buildProgram:function(t,r,e,i){var a=t.createShader(t.VERTEX_SHADER),s=t.createProgram();t.shaderSource(a,e),t.compileShader(a);var o=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(o,i),t.compileShader(o);var u=n(t,a,e);if(u)return u;if(u=n(t,o,i))return u;if(t.attachShader(s,a),t.attachShader(s,o),r.attributeSemantics.POSITION)t.bindAttribLocation(s,0,r.attributeSemantics.POSITION.symbol);else{var h=Object.keys(this.attributes);t.bindAttribLocation(s,0,h[0])}if(t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))return"Could not link program\nVALIDATE_STATUS: "+t.getProgramParameter(s,t.VALIDATE_STATUS)+", gl error ["+t.getError()+"]";for(var c=0;c<r.uniforms.length;c++){var f=r.uniforms[c];this._locations[f]=t.getUniformLocation(s,f)}t.deleteShader(a),t.deleteShader(o),this._program=s,this.vertexCode=e,this.fragmentCode=i}});r.a=h},function(t,r,e){"use strict";r.a="@export clay.prez.vertex\nuniform mat4 WVP : WORLDVIEWPROJECTION;\nattribute vec3 pos : POSITION;\nattribute vec2 uv : TEXCOORD_0;\n@import clay.chunk.skinning_header\nvarying vec2 v_Uv;\nvoid main()\n{\n vec3 P = pos;\n#ifdef SKINNING\n @import clay.chunk.skin_matrix\n P = (skinMatrixWS * vec4(pos, 1.0)).xyz;\n#endif\n gl_Position = WVP * vec4(P, 1.0);\n v_Uv = uv;\n}\n@end\n@export clay.prez.fragment\nuniform sampler2D alphaMap;\nuniform float alphaCutoff: 0.0;\nvarying vec2 v_Uv;\nvoid main()\n{\n if (alphaCutoff > 0.0) {\n if (texture2D(alphaMap, v_Uv).a <= alphaCutoff) {\n discard;\n }\n }\n gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n}\n@end"},function(t,r,e){"use strict";(function(t){var i=e(1),n=e(48),a="undefined"==typeof window?t:window,s=a.requestAnimationFrame||a.msRequestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||function(t){setTimeout(t,16)},o=i.a.extend(function(){return{stage:null,_clips:[],_running:!1,_time:0,_paused:!1,_pausedTime:0}},{addAnimator:function(t){t.animation=this;for(var r=t.getClips(),e=0;e<r.length;e++)this.addClip(r[e])},addClip:function(t){this._clips.indexOf(t)<0&&this._clips.push(t)},removeClip:function(t){var r=this._clips.indexOf(t);r>=0&&this._clips.splice(r,1)},removeAnimator:function(t){for(var r=t.getClips(),e=0;e<r.length;e++)this.removeClip(r[e]);t.animation=null},_update:function(){for(var t=Date.now()-this._pausedTime,r=t-this._time,e=this._clips,i=e.length,n=[],a=[],s=0;s<i;s++){var o=e[s],u=o.step(t,r,!1);u&&(n.push(u),a.push(o))}for(var s=0;s<i;)e[s]._needsRemove?(e[s]=e[i-1],e.pop(),i--):s++;i=n.length;for(var s=0;s<i;s++)a[s].fire(n[s]);this._time=t,this.trigger("frame",r),this.stage&&this.stage.render&&this.stage.render()},start:function(){function t(){r._running&&(s(t),r._paused||r._update())}var r=this;this._running=!0,this._time=Date.now(),this._pausedTime=0,s(t)},stop:function(){this._running=!1},pause:function(){this._paused||(this._pauseStart=Date.now(),this._paused=!0)},resume:function(){this._paused&&(this._pausedTime+=Date.now()-this._pauseStart,this._paused=!1)},removeClipsAll:function(){this._clips=[]},animate:function(t,r){r=r||{};var e=new n.a(t,r.loop,r.getter,r.setter,r.interpolater);return e.animation=this,e}});r.a=o}).call(r,e(14))},function(t,r,e){"use strict";function i(t,r){return t[r]}function n(t,r,e){t[r]=e}function a(t,r,e){return(r-t)*e+t}function s(t,r,e,i,n){var s=t.length;if(1==n)for(var o=0;o<s;o++)i[o]=a(t[o],r[o],e);else for(var u=t[0].length,o=0;o<s;o++)for(var h=0;h<u;h++)i[o][h]=a(t[o][h],r[o][h],e)}function o(t){return void 0!==t&&("string"!=typeof t&&"number"==typeof t.length)}function u(t){if(o(t)){var r=t.length;if(o(t[0])){for(var e=[],i=0;i<r;i++)e.push(v.call(t[i]));return e}return v.call(t)}return t}function h(t,r,e,i,n,a,s,o,u){var h=t.length;if(1==u)for(var f=0;f<h;f++)o[f]=c(t[f],r[f],e[f],i[f],n,a,s);else for(var l=t[0].length,f=0;f<h;f++)for(var _=0;_<l;_++)o[f][_]=c(t[f][_],r[f][_],e[f][_],i[f][_],n,a,s)}function c(t,r,e,i,n,a,s){var o=.5*(e-t),u=.5*(i-r);return(2*(r-e)+o+u)*s+(-3*(r-e)-2*o-u)*a+o*n+r}function f(t,r,e){var i=t.length,n=r.length;if(i!==n){if(i>n)t.length=n;else for(var a=i;a<n;a++)t.push(1===e?r[a]:v.call(r[a]))}for(var s=t[0]&&t[0].length,a=0;a<t.length;a++)if(1===e)isNaN(t[a])&&(t[a]=r[a]);else for(var o=0;o<s;o++)isNaN(t[a][o])&&(t[a][o]=r[a][o])}function l(t,r,e){if(t===r)return!0;var i=t.length;if(i!==r.length)return!1;if(1===e){for(var n=0;n<i;n++)if(t[n]!==r[n])return!1}else for(var a=t[0].length,n=0;n<i;n++)for(var s=0;s<a;s++)if(t[n][s]!==r[n][s])return!1;return!0}function _(t,r,e,i,n,u,_){var d=t._getter,m=t._setter,y="spline"===r,v=i.length;if(v){var E=i[0].value,T=o(E),g=T&&o(E[0])?2:1;i.sort(function(t,r){return t.time-r.time});for(var x=[],A=[],R=[],b=i[0].value,M=!0,I=0;I<v;I++){x.push(i[I].time/_);var S=i[I].value;T&&l(S,b,g)||!T&&S===b||(M=!1),b=S,A.push(S),R.push(i[I].easing)}if(!M){for(var N=A[v-1],I=0;I<v-1;I++)T?f(A[I],N,g):isNaN(A[I])&&!isNaN(N)&&(A[I]=N);T&&f(d(t._target,n),N,g);var O,I,w,P,L,C,D,U=0,F=0,B=function(t,r){if(r<F){for(O=Math.min(U+1,v-1),I=O;I>=0&&!(x[I]<=r);I--);I=Math.min(I,v-2)}else{for(I=U;I<v&&!(x[I]>r);I++);I=Math.min(I-1,v-2)}U=I,F=r;var e=x[I+1]-x[I];0!==e&&(w=(r-x[I])/e,w=Math.max(Math.min(1,w),0),w=R[I+1](w),y?(L=A[I],P=A[0===I?I:I-1],C=A[I>v-2?v-1:I+1],D=A[I>v-3?v-1:I+2],u?m(t,n,u(d(t,n),P,L,C,D,w)):T?h(P,L,C,D,w,w*w,w*w*w,d(t,n),g):m(t,n,c(P,L,C,D,w,w*w,w*w*w))):u?m(t,n,u(d(t,n),A[I],A[I+1],w)):T?s(A[I],A[I+1],w,d(t,n),g):m(t,n,a(A[I],A[I+1],w)))},V=new p.a({target:t._target,life:_,loop:t._loop,delay:t._delay,onframe:B,onfinish:e});return r&&"spline"!==r&&V.setEasing(r),V}}}function d(t,r,e,a,s){this._tracks={},this._target=t,this._loop=r||!1,this._getter=e||i,this._setter=a||n,this._interpolater=s||null,this._delay=0,this._doneList=[],this._onframeList=[],this._clipList=[],this._maxTime=0,this._lastKFTime=0}function m(t){return t}var p=e(49),y=e(20),v=Array.prototype.slice;d.prototype={constructor:d,when:function(t,r,e){this._maxTime=Math.max(t,this._maxTime),e=("function"==typeof e?e:y.a[e])||m;for(var i in r)this._tracks[i]||(this._tracks[i]=[],0!==t&&this._tracks[i].push({time:0,value:u(this._getter(this._target,i)),easing:e})),this._tracks[i].push({time:parseInt(t),value:r[i],easing:e});return this},then:function(t,r,e){return this.when(t+this._lastKFTime,r,e),this._lastKFTime+=t,this},during:function(t){return this._onframeList.push(t),this},_doneCallback:function(){this._tracks={},this._clipList.length=0;for(var t=this._doneList,r=t.length,e=0;e<r;e++)t[e].call(this)},start:function(t){var r,e=this,i=0,n=function(){0===--i&&e._doneCallback()},a=0;for(var s in this._tracks){var o=_(this,t,n,this._tracks[s],s,e._interpolater,e._maxTime);o&&(a=Math.max(a,o.life),this._clipList.push(o),i++,this.animation&&this.animation.addClip(o),r=o)}if(r){var u=r.onframe;r.onframe=function(t,r){u(t,r);for(var i=0;i<e._onframeList.length;i++)e._onframeList[i](t,r)}}return i||this._doneCallback(),this},stop:function(){for(var t=0;t<this._clipList.length;t++){var r=this._clipList[t];this.animation.removeClip(r)}this._clipList=[]},delay:function(t){return this._delay=t,this},done:function(t){return t&&this._doneList.push(t),this},getClips:function(){return this._clipList}},r.a=d},function(t,r,e){"use strict";function i(){}var n=e(20),a=function(t){t=t||{},this.name=t.name||"",this.target=t.target,this.life=t.life||1e3,this.delay=t.delay||0,this.gap=t.gap||0,this.playbackRate=t.playbackRate||1,this._initialized=!1,this._elapsedTime=0,this._loop=null!=t.loop&&t.loop,this.setLoop(this._loop),null!=t.easing&&this.setEasing(t.easing),this.onframe=t.onframe||i,this.onfinish=t.onfinish||i,this.onrestart=t.onrestart||i,this._paused=!1};a.prototype={gap:0,life:0,delay:0,setLoop:function(t){this._loop=t,t&&(this._loopRemained="number"==typeof t?t:1/0)},setEasing:function(t){"string"==typeof t&&(t=n.a[t]),this.easing=t},step:function(t,r,e){if(this._initialized||(this._startTime=t+this.delay,this._initialized=!0),null!=this._currentTime&&(r=t-this._currentTime),this._currentTime=t,this._paused)return"paused";if(!(t<this._startTime)){this._elapse(t,r);var i=Math.min(this._elapsedTime/this.life,1);if(!(i<0)){var n;return n=this.easing?this.easing(i):i,e||this.fire("frame",n),1===i?this._loop&&this._loopRemained>0?(this._restartInLoop(t),this._loopRemained--,"restart"):(this._needsRemove=!0,"finish"):null}}},setTime:function(t){return this.step(t+this._startTime)},restart:function(t){var r=0;t&&(this._elapse(t),r=this._elapsedTime%this.life),t=t||Date.now(),this._startTime=t-r+this.delay,this._elapsedTime=0,this._needsRemove=!1,this._paused=!1},getElapsedTime:function(){return this._elapsedTime},_restartInLoop:function(t){this._startTime=t+this.gap,this._elapsedTime=0},_elapse:function(t,r){this._elapsedTime+=r*this.playbackRate},fire:function(t,r){var e="on"+t;this[e]&&this[e](this.target,r)},clone:function(){var t=new this.constructor;return t.name=this.name,t._loop=this._loop,t._loopRemained=this._loopRemained,t.life=this.life,t.gap=this.gap,t.delay=this.delay,t},pause:function(){this._paused=!0},resume:function(){this._paused=!1}},a.prototype.constructor=a,r.a=a}]);